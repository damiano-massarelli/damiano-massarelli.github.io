(()=>{"use strict";var t={376:(t,e,n)=>{function r(t,e){var n=t.__state.conversionName.toString(),r=Math.round(t.r),a=Math.round(t.g),o=Math.round(t.b),i=t.a,s=Math.round(t.h),l=t.s.toFixed(1),c=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var u=t.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===n?"rgb("+r+","+a+","+o+")":"CSS_RGBA"===n?"rgba("+r+","+a+","+o+","+i+")":"HEX"===n?"0x"+t.hex.toString(16):"RGB_ARRAY"===n?"["+r+","+a+","+o+"]":"RGBA_ARRAY"===n?"["+r+","+a+","+o+","+i+"]":"RGB_OBJ"===n?"{r:"+r+",g:"+a+",b:"+o+"}":"RGBA_OBJ"===n?"{r:"+r+",g:"+a+",b:"+o+",a:"+i+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+",a:"+i+"}":"unknown format"}n.r(e),n.d(e,{GUI:()=>ht,color:()=>lt,controllers:()=>ct,default:()=>ft,dom:()=>ut,gui:()=>dt});var a=Array.prototype.forEach,o=Array.prototype.slice,i={BREAK:{},extend:function(t){return this.each(o.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(e[n])||(t[n]=e[n])}.bind(this))}),this),t},defaults:function(t){return this.each(o.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(t[n])&&(t[n]=e[n])}.bind(this))}),this),t},compose:function(){var t=o.call(arguments);return function(){for(var e=o.call(arguments),n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},each:function(t,e,n){if(t)if(a&&t.forEach&&t.forEach===a)t.forEach(e,n);else if(t.length===t.length+0){var r,o=void 0;for(o=0,r=t.length;o<r;o++)if(o in t&&e.call(n,t[o],o)===this.BREAK)return}else for(var i in t)if(e.call(n,t[i],i)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,n){var r=void 0;return function(){var a=this,o=arguments,i=n||!r;clearTimeout(r),r=setTimeout((function(){r=null,n||t.apply(a,o)}),e),i&&t.apply(a,o)}},toArray:function(t){return t.toArray?t.toArray():o.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return t instanceof Function}},s=[{litmus:i.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:r},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:r},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:r},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:r}}},{litmus:i.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:i.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:i.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(i.isNumber(t.r)&&i.isNumber(t.g)&&i.isNumber(t.b)&&i.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(i.isNumber(t.r)&&i.isNumber(t.g)&&i.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(i.isNumber(t.h)&&i.isNumber(t.s)&&i.isNumber(t.v)&&i.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(i.isNumber(t.h)&&i.isNumber(t.s)&&i.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],l=void 0,c=void 0,u=function(){c=!1;var t=arguments.length>1?i.toArray(arguments):arguments[0];return i.each(s,(function(e){if(e.litmus(t))return i.each(e.conversions,(function(e,n){if(l=e.read(t),!1===c&&!1!==l)return c=l,l.conversionName=n,l.conversion=e,i.BREAK})),i.BREAK})),c},d=void 0,h={hsv_to_rgb:function(t,e,n){var r=Math.floor(t/60)%6,a=t/60-Math.floor(t/60),o=n*(1-e),i=n*(1-a*e),s=n*(1-(1-a)*e),l=[[n,s,o],[i,n,o],[o,n,s],[o,i,n],[s,o,n],[n,o,i]][r];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(t,e,n){var r=Math.min(t,e,n),a=Math.max(t,e,n),o=a-r,i=void 0;return 0===a?{h:NaN,s:0,v:0}:(i=t===a?(e-n)/o:e===a?2+(n-t)/o:4+(t-e)/o,(i/=6)<0&&(i+=1),{h:360*i,s:o/a,v:a/255})},rgb_to_hex:function(t,e,n){var r=this.hex_with_component(0,2,t);return r=this.hex_with_component(r,1,e),this.hex_with_component(r,0,n)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,n){return n<<(d=8*e)|t&~(255<<d)}},f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},m=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),v=function t(e,n,r){null===e&&(e=Function.prototype);var a=Object.getOwnPropertyDescriptor(e,n);if(void 0===a){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,r)}if("value"in a)return a.value;var i=a.get;return void 0!==i?i.call(r):void 0},_=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},b=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},g=function(){function t(){if(p(this,t),this.__state=u.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return m(t,[{key:"toString",value:function(){return r(this)}},{key:"toHexString",value:function(){return r(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function M(t,e,n){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space||g.recalculateRGB(this,e,n),this.__state[e]},set:function(t){"RGB"!==this.__state.space&&(g.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=t}})}function y(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space||g.recalculateHSV(this),this.__state[e]},set:function(t){"HSV"!==this.__state.space&&(g.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}g.recalculateRGB=function(t,e,n){if("HEX"===t.__state.space)t.__state[e]=h.component_from_hex(t.__state.hex,n);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");i.extend(t.__state,h.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},g.recalculateHSV=function(t){var e=h.rgb_to_hsv(t.r,t.g,t.b);i.extend(t.__state,{s:e.s,v:e.v}),i.isNaN(e.h)?i.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},g.COMPONENTS=["r","g","b","h","s","v","hex","a"],M(g.prototype,"r",2),M(g.prototype,"g",1),M(g.prototype,"b",0),y(g.prototype,"h"),y(g.prototype,"s"),y(g.prototype,"v"),Object.defineProperty(g.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(g.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=h.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var x=function(){function t(e,n){p(this,t),this.initialValue=e[n],this.domElement=document.createElement("div"),this.object=e,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return m(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),w={};i.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){i.each(t,(function(t){w[t]=e}))}));var E=/(\d+(\.\d+)?)px/;function S(t){if("0"===t||i.isUndefined(t))return 0;var e=t.match(E);return i.isNull(e)?0:parseFloat(e[1])}var A={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,n){var r=n,a=e;i.isUndefined(a)&&(a=!0),i.isUndefined(r)&&(r=!0),t.style.position="absolute",a&&(t.style.left=0,t.style.right=0),r&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,n,r){var a=n||{},o=w[e];if(!o)throw new Error("Event type "+e+" not supported.");var s=document.createEvent(o);switch(o){case"MouseEvents":var l=a.x||a.clientX||0,c=a.y||a.clientY||0;s.initMouseEvent(e,a.bubbles||!1,a.cancelable||!0,window,a.clickCount||1,0,0,l,c,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var u=s.initKeyboardEvent||s.initKeyEvent;i.defaults(a,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),u(e,a.bubbles||!1,a.cancelable,window,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.keyCode,a.charCode);break;default:s.initEvent(e,a.bubbles||!1,a.cancelable||!0)}i.defaults(s,r),t.dispatchEvent(s)},bind:function(t,e,n,r){var a=r||!1;return t.addEventListener?t.addEventListener(e,n,a):t.attachEvent&&t.attachEvent("on"+e,n),A},unbind:function(t,e,n,r){var a=r||!1;return t.removeEventListener?t.removeEventListener(e,n,a):t.detachEvent&&t.detachEvent("on"+e,n),A},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var n=t.className.split(/ +/);-1===n.indexOf(e)&&(n.push(e),t.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return A},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var n=t.className.split(/ +/),r=n.indexOf(e);-1!==r&&(n.splice(r,1),t.className=n.join(" "))}else t.className=void 0;return A},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return S(e["border-left-width"])+S(e["border-right-width"])+S(e["padding-left"])+S(e["padding-right"])+S(e.width)},getHeight:function(t){var e=getComputedStyle(t);return S(e["border-top-width"])+S(e["border-bottom-width"])+S(e["padding-top"])+S(e["padding-bottom"])+S(e.height)},getOffset:function(t){var e=t,n={left:0,top:0};if(e.offsetParent)do{n.left+=e.offsetLeft,n.top+=e.offsetTop,e=e.offsetParent}while(e);return n},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},C=function(t){function e(t,n){p(this,e);var r=b(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),a=r;return r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox"),A.bind(r.__checkbox,"change",(function(){a.setValue(!a.__prev)}),!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return _(e,t),m(e,[{key:"setValue",value:function(t){var n=v(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),v(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(x),P=function(t){function e(t,n,r){p(this,e);var a=b(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=r,s=a;if(a.__select=document.createElement("select"),i.isArray(o)){var l={};i.each(o,(function(t){l[t]=t})),o=l}return i.each(o,(function(t,e){var n=document.createElement("option");n.innerHTML=e,n.setAttribute("value",t),s.__select.appendChild(n)})),a.updateDisplay(),A.bind(a.__select,"change",(function(){var t=this.options[this.selectedIndex].value;s.setValue(t)})),a.domElement.appendChild(a.__select),a}return _(e,t),m(e,[{key:"setValue",value:function(t){var n=v(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return A.isActive(this.__select)?this:(this.__select.value=this.getValue(),v(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(x),k=function(t){function e(t,n){p(this,e);var r=b(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),a=r;function o(){a.setValue(a.__input.value)}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),A.bind(r.__input,"keyup",o),A.bind(r.__input,"change",o),A.bind(r.__input,"blur",(function(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())})),A.bind(r.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return _(e,t),m(e,[{key:"updateDisplay",value:function(){return A.isActive(this.__input)||(this.__input.value=this.getValue()),v(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(x);function O(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var T=function(t){function e(t,n,r){p(this,e);var a=b(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=r||{};return a.__min=o.min,a.__max=o.max,a.__step=o.step,i.isUndefined(a.__step)?0===a.initialValue?a.__impliedStep=1:a.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(a.initialValue))/Math.LN10))/10:a.__impliedStep=a.__step,a.__precision=O(a.__impliedStep),a}return _(e,t),m(e,[{key:"setValue",value:function(t){var n=t;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),v(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=O(t),this}}]),e}(x),R=function(t){function e(t,n,r){p(this,e);var a=b(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r));a.__truncationSuspended=!1;var o=a,s=void 0;function l(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function c(t){var e=s-t.clientY;o.setValue(o.getValue()+e*o.__impliedStep),s=t.clientY}function u(){A.unbind(window,"mousemove",c),A.unbind(window,"mouseup",u),l()}return a.__input=document.createElement("input"),a.__input.setAttribute("type","text"),A.bind(a.__input,"change",(function(){var t=parseFloat(o.__input.value);i.isNaN(t)||o.setValue(t)})),A.bind(a.__input,"blur",(function(){l()})),A.bind(a.__input,"mousedown",(function(t){A.bind(window,"mousemove",c),A.bind(window,"mouseup",u),s=t.clientY})),A.bind(a.__input,"keydown",(function(t){13===t.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,l())})),a.updateDisplay(),a.domElement.appendChild(a.__input),a}return _(e,t),m(e,[{key:"updateDisplay",value:function(){var t,n,r;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),n=this.__precision,r=Math.pow(10,n),Math.round(t*r)/r),v(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(T);function V(t,e,n,r,a){return r+(t-e)/(n-e)*(a-r)}var B=function(t){function e(t,n,r,a,o){p(this,e);var i=b(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,{min:r,max:a,step:o})),s=i;function l(t){t.preventDefault();var e=s.__background.getBoundingClientRect();return s.setValue(V(t.clientX,e.left,e.right,s.__min,s.__max)),!1}function c(){A.unbind(window,"mousemove",l),A.unbind(window,"mouseup",c),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function u(t){var e=t.touches[0].clientX,n=s.__background.getBoundingClientRect();s.setValue(V(e,n.left,n.right,s.__min,s.__max))}function d(){A.unbind(window,"touchmove",u),A.unbind(window,"touchend",d),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return i.__background=document.createElement("div"),i.__foreground=document.createElement("div"),A.bind(i.__background,"mousedown",(function(t){document.activeElement.blur(),A.bind(window,"mousemove",l),A.bind(window,"mouseup",c),l(t)})),A.bind(i.__background,"touchstart",(function(t){1===t.touches.length&&(A.bind(window,"touchmove",u),A.bind(window,"touchend",d),u(t))})),A.addClass(i.__background,"slider"),A.addClass(i.__foreground,"slider-fg"),i.updateDisplay(),i.__background.appendChild(i.__foreground),i.domElement.appendChild(i.__background),i}return _(e,t),m(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",v(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(T),L=function(t){function e(t,n,r){p(this,e);var a=b(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=a;return a.__button=document.createElement("div"),a.__button.innerHTML=void 0===r?"Fire":r,A.bind(a.__button,"click",(function(t){return t.preventDefault(),o.fire(),!1})),A.addClass(a.__button,"button"),a.domElement.appendChild(a.__button),a}return _(e,t),m(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(x),D=function(t){function e(t,n){p(this,e);var r=b(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));r.__color=new g(r.getValue()),r.__temp=new g(0);var a=r;r.domElement=document.createElement("div"),A.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",A.bind(r.__input,"keydown",(function(t){13===t.keyCode&&f.call(this)})),A.bind(r.__input,"blur",f),A.bind(r.__selector,"mousedown",(function(){A.addClass(this,"drag").bind(window,"mouseup",(function(){A.removeClass(a.__selector,"drag")}))})),A.bind(r.__selector,"touchstart",(function(){A.addClass(this,"drag").bind(window,"touchend",(function(){A.removeClass(a.__selector,"drag")}))}));var o,s=document.createElement("div");function l(t){v(t),A.bind(window,"mousemove",v),A.bind(window,"touchmove",v),A.bind(window,"mouseup",d),A.bind(window,"touchend",d)}function c(t){_(t),A.bind(window,"mousemove",_),A.bind(window,"touchmove",_),A.bind(window,"mouseup",h),A.bind(window,"touchend",h)}function d(){A.unbind(window,"mousemove",v),A.unbind(window,"touchmove",v),A.unbind(window,"mouseup",d),A.unbind(window,"touchend",d),m()}function h(){A.unbind(window,"mousemove",_),A.unbind(window,"touchmove",_),A.unbind(window,"mouseup",h),A.unbind(window,"touchend",h),m()}function f(){var t=u(this.value);!1!==t?(a.__color.__state=t,a.setValue(a.__color.toOriginal())):this.value=a.__color.toString()}function m(){a.__onFinishChange&&a.__onFinishChange.call(a,a.__color.toOriginal())}function v(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=a.__saturation_field.getBoundingClientRect(),n=t.touches&&t.touches[0]||t,r=n.clientX,o=n.clientY,i=(r-e.left)/(e.right-e.left),s=1-(o-e.top)/(e.bottom-e.top);return s>1?s=1:s<0&&(s=0),i>1?i=1:i<0&&(i=0),a.__color.v=s,a.__color.s=i,a.setValue(a.__color.toOriginal()),!1}function _(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=a.__hue_field.getBoundingClientRect(),n=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return n>1?n=1:n<0&&(n=0),a.__color.h=360*n,a.setValue(a.__color.toOriginal()),!1}return i.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),i.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),i.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),i.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),i.extend(s.style,{width:"100%",height:"100%",background:"none"}),N(s,"top","rgba(0,0,0,0)","#000"),i.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(o=r.__hue_field).style.background="",o.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",o.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),A.bind(r.__saturation_field,"mousedown",l),A.bind(r.__saturation_field,"touchstart",l),A.bind(r.__field_knob,"mousedown",l),A.bind(r.__field_knob,"touchstart",l),A.bind(r.__hue_field,"mousedown",c),A.bind(r.__hue_field,"touchstart",c),r.__saturation_field.appendChild(s),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}return _(e,t),m(e,[{key:"updateDisplay",value:function(){var t=u(this.getValue());if(!1!==t){var e=!1;i.each(g.COMPONENTS,(function(n){if(!i.isUndefined(t[n])&&!i.isUndefined(this.__color.__state[n])&&t[n]!==this.__color.__state[n])return e=!0,{}}),this),e&&i.extend(this.__color.__state,t)}i.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,r=255-n;i.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,N(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),i.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),e}(x),F=["-moz-","-o-","-webkit-","-ms-",""];function N(t,e,n,r){t.style.background="",i.each(F,(function(a){t.style.cssText+="background: "+a+"linear-gradient("+e+", "+n+" 0%, "+r+" 100%); "}))}var z=function(t,e){var n=t[e];return i.isArray(arguments[2])||i.isObject(arguments[2])?new P(t,e,arguments[2]):i.isNumber(n)?i.isNumber(arguments[2])&&i.isNumber(arguments[3])?i.isNumber(arguments[4])?new B(t,e,arguments[2],arguments[3],arguments[4]):new B(t,e,arguments[2],arguments[3]):i.isNumber(arguments[4])?new R(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new R(t,e,{min:arguments[2],max:arguments[3]}):i.isString(n)?new k(t,e):i.isFunction(n)?new L(t,e,""):i.isBoolean(n)?new C(t,e):null},I=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},j=function(){function t(){p(this,t),this.backgroundElement=document.createElement("div"),i.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),A.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),i.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;A.bind(this.backgroundElement,"click",(function(){e.hide()}))}return m(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),i.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",A.unbind(t.domElement,"webkitTransitionEnd",e),A.unbind(t.domElement,"transitionend",e),A.unbind(t.domElement,"oTransitionEnd",e)};A.bind(this.domElement,"webkitTransitionEnd",e),A.bind(this.domElement,"transitionend",e),A.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-A.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-A.getHeight(this.domElement)/2+"px"}}]),t}();!function(t,e){var n=e||document,r=document.createElement("style");r.type="text/css",r.innerHTML=t;var a=n.getElementsByTagName("head")[0];try{a.appendChild(r)}catch(t){}}(function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var G="Default",H=function(){try{return!!window.localStorage}catch(t){return!1}}(),U=void 0,q=!0,W=void 0,Y=!1,X=[],Q=function t(e){var n=this,r=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),A.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=i.defaults(r,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),r=i.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),i.isUndefined(r.load)?r.load={preset:G}:r.preset&&(r.load.preset=r.preset),i.isUndefined(r.parent)&&r.hideable&&X.push(this),r.resizable=i.isUndefined(r.parent)&&r.resizable,r.autoPlace&&i.isUndefined(r.scrollable)&&(r.scrollable=!0);var a,o=H&&"true"===localStorage.getItem(et(0,"isLocal")),s=void 0,l=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(t){n.parent?n.getRoot().preset=t:r.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),n.revert()}},width:{get:function(){return r.width},set:function(t){r.width=t,ot(n,t)}},name:{get:function(){return r.name},set:function(t){r.name=t,l&&(l.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(e){r.closed=e,r.closed?A.addClass(n.__ul,t.CLASS_CLOSED):A.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return o},set:function(t){H&&(o=t,t?A.bind(window,"unload",s):A.unbind(window,"unload",s),localStorage.setItem(et(0,"isLocal"),t))}}}),i.isUndefined(r.parent)){if(this.closed=r.closed||!1,A.addClass(this.domElement,t.CLASS_MAIN),A.makeSelectable(this.domElement,!1),H&&o){n.useLocalStorage=!0;var c=localStorage.getItem(et(0,"gui"));c&&(r.load=JSON.parse(c))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,A.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),r.closeOnTop?(A.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(A.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),A.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===r.closed&&(r.closed=!0);var u=document.createTextNode(r.name);A.addClass(u,"controller-name"),l=K(n,u),A.addClass(this.__ul,t.CLASS_CLOSED),A.addClass(l,"title"),A.bind(l,"click",(function(t){return t.preventDefault(),n.closed=!n.closed,!1})),r.closed||(this.closed=!1)}r.autoPlace&&(i.isUndefined(r.parent)&&(q&&(W=document.createElement("div"),A.addClass(W,"dg"),A.addClass(W,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(W),q=!1),W.appendChild(this.domElement),A.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||ot(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},A.bind(window,"resize",this.__resizeHandler),A.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),A.bind(this.__ul,"transitionend",this.__resizeHandler),A.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&at(this),s=function(){H&&"true"===localStorage.getItem(et(0,"isLocal"))&&localStorage.setItem(et(0,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=s,r.parent||((a=n.getRoot()).width+=1,i.defer((function(){a.width-=1})))};function K(t,e,n){var r=document.createElement("li");return e&&r.appendChild(e),n?t.__ul.insertBefore(r,n):t.__ul.appendChild(r),t.onResize(),r}function J(t){A.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&A.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function Z(t,e){var n=t.__preset_select[t.__preset_select.selectedIndex];n.innerHTML=e?n.value+"*":n.value}function $(t,e){var n=t.getRoot(),r=n.__rememberedObjects.indexOf(e.object);if(-1!==r){var a=n.__rememberedObjectIndecesToControllers[r];if(void 0===a&&(a={},n.__rememberedObjectIndecesToControllers[r]=a),a[e.property]=e,n.load&&n.load.remembered){var o=n.load.remembered,i=void 0;if(o[t.preset])i=o[t.preset];else{if(!o[G])return;i=o[G]}if(i[r]&&void 0!==i[r][e.property]){var s=i[r][e.property];e.initialValue=s,e.setValue(s)}}}}function tt(t,e,n,r){if(void 0===e[n])throw new Error('Object "'+e+'" has no property "'+n+'"');var a=void 0;if(r.color)a=new D(e,n);else{var o=[e,n].concat(r.factoryArgs);a=z.apply(t,o)}r.before instanceof x&&(r.before=r.before.__li),$(t,a),A.addClass(a.domElement,"c");var s=document.createElement("span");A.addClass(s,"property-name"),s.innerHTML=a.property;var l=document.createElement("div");l.appendChild(s),l.appendChild(a.domElement);var c=K(t,l,r.before);return A.addClass(c,Q.CLASS_CONTROLLER_ROW),a instanceof D?A.addClass(c,"color"):A.addClass(c,f(a.getValue())),function(t,e,n){if(n.__li=e,n.__gui=t,i.extend(n,{options:function(e){if(arguments.length>1){var r=n.__li.nextElementSibling;return n.remove(),tt(t,n.object,n.property,{before:r,factoryArgs:[i.toArray(arguments)]})}if(i.isArray(e)||i.isObject(e)){var a=n.__li.nextElementSibling;return n.remove(),tt(t,n.object,n.property,{before:a,factoryArgs:[e]})}},name:function(t){return n.__li.firstElementChild.firstElementChild.innerHTML=t,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof B){var r=new R(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});i.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=n[t],a=r[t];n[t]=r[t]=function(){var t=Array.prototype.slice.call(arguments);return a.apply(r,t),e.apply(n,t)}})),A.addClass(e,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof R){var a=function(e){if(i.isNumber(n.__min)&&i.isNumber(n.__max)){var r=n.__li.firstElementChild.firstElementChild.innerHTML,a=n.__gui.__listening.indexOf(n)>-1;n.remove();var o=tt(t,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return o.name(r),a&&o.listen(),o}return e};n.min=i.compose(a,n.min),n.max=i.compose(a,n.max)}else n instanceof C?(A.bind(e,"click",(function(){A.fakeEvent(n.__checkbox,"click")})),A.bind(n.__checkbox,"click",(function(t){t.stopPropagation()}))):n instanceof L?(A.bind(e,"click",(function(){A.fakeEvent(n.__button,"click")})),A.bind(e,"mouseover",(function(){A.addClass(n.__button,"hover")})),A.bind(e,"mouseout",(function(){A.removeClass(n.__button,"hover")}))):n instanceof D&&(A.addClass(e,"color"),n.updateDisplay=i.compose((function(t){return e.style.borderLeftColor=n.__color.toString(),t}),n.updateDisplay),n.updateDisplay());n.setValue=i.compose((function(e){return t.getRoot().__preset_select&&n.isModified()&&Z(t.getRoot(),!0),e}),n.setValue)}(t,c,a),t.__controllers.push(a),a}function et(t,e){return document.location.href+"."+e}function nt(t,e,n){var r=document.createElement("option");r.innerHTML=e,r.value=e,t.__preset_select.appendChild(r),n&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function rt(t,e){e.style.display=t.useLocalStorage?"block":"none"}function at(t){var e=void 0;function n(n){return n.preventDefault(),t.width+=e-n.clientX,t.onResize(),e=n.clientX,!1}function r(){A.removeClass(t.__closeButton,Q.CLASS_DRAG),A.unbind(window,"mousemove",n),A.unbind(window,"mouseup",r)}function a(a){return a.preventDefault(),e=a.clientX,A.addClass(t.__closeButton,Q.CLASS_DRAG),A.bind(window,"mousemove",n),A.bind(window,"mouseup",r),!1}t.__resize_handle=document.createElement("div"),i.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),A.bind(t.__resize_handle,"mousedown",a),A.bind(t.__closeButton,"mousedown",a),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function ot(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function it(t,e){var n={};return i.each(t.__rememberedObjects,(function(r,a){var o={},s=t.__rememberedObjectIndecesToControllers[a];i.each(s,(function(t,n){o[n]=e?t.initialValue:t.getValue()})),n[a]=o})),n}function st(t){0!==t.length&&I.call(window,(function(){st(t)})),i.each(t,(function(t){t.updateDisplay()}))}Q.toggleHide=function(){Y=!Y,i.each(X,(function(t){t.domElement.style.display=Y?"none":""}))},Q.CLASS_AUTO_PLACE="a",Q.CLASS_AUTO_PLACE_CONTAINER="ac",Q.CLASS_MAIN="main",Q.CLASS_CONTROLLER_ROW="cr",Q.CLASS_TOO_TALL="taller-than-window",Q.CLASS_CLOSED="closed",Q.CLASS_CLOSE_BUTTON="close-button",Q.CLASS_CLOSE_TOP="close-top",Q.CLASS_CLOSE_BOTTOM="close-bottom",Q.CLASS_DRAG="drag",Q.DEFAULT_WIDTH=245,Q.TEXT_CLOSED="Close Controls",Q.TEXT_OPEN="Open Controls",Q._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||Q.toggleHide()},A.bind(window,"keydown",Q._keydownHandler,!1),i.extend(Q.prototype,{add:function(t,e){return tt(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return tt(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;i.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&W.removeChild(this.domElement);var t=this;i.each(this.__folders,(function(e){t.removeFolder(e)})),A.unbind(window,"keydown",Q._keydownHandler,!1),J(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var n=new Q(e);this.__folders[t]=n;var r=K(this,n.domElement);return A.addClass(r,"folder"),n},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],J(t);var e=this;i.each(t.__folders,(function(e){t.removeFolder(e)})),i.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=A.getOffset(t.__ul).top,n=0;i.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(n+=A.getHeight(e))})),window.innerHeight-e-20<n?(A.addClass(t.domElement,Q.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(A.removeClass(t.domElement,Q.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&i.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:i.debounce((function(){this.onResize()}),50),remember:function(){if(i.isUndefined(U)&&((U=new j).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;i.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&function(t){var e=t.__save_row=document.createElement("li");A.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),A.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",A.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",A.addClass(r,"button"),A.addClass(r,"save");var a=document.createElement("span");a.innerHTML="New",A.addClass(a,"button"),A.addClass(a,"save-as");var o=document.createElement("span");o.innerHTML="Revert",A.addClass(o,"button"),A.addClass(o,"revert");var s=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?i.each(t.load.remembered,(function(e,n){nt(t,n,n===t.preset)})):nt(t,G,!1),A.bind(s,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(s),e.appendChild(n),e.appendChild(r),e.appendChild(a),e.appendChild(o),H){var l=document.getElementById("dg-local-explain"),c=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(et(0,"isLocal"))&&c.setAttribute("checked","checked"),rt(t,l),A.bind(c,"change",(function(){t.useLocalStorage=!t.useLocalStorage,rt(t,l)}))}var u=document.getElementById("dg-new-constructor");A.bind(u,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||U.hide()})),A.bind(n,"click",(function(){u.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),U.show(),u.focus(),u.select()})),A.bind(r,"click",(function(){t.save()})),A.bind(a,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),A.bind(o,"click",(function(){t.revert()}))}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&ot(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=it(this)),t.folders={},i.each(this.__folders,(function(e,n){t.folders[n]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=it(this),Z(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[G]=it(this,!0)),this.load.remembered[t]=it(this),this.preset=t,nt(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){i.each(this.__controllers,(function(e){this.getRoot().load.remembered?$(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),i.each(this.__folders,(function(t){t.revert(t)})),t||Z(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&st(this.__listening)},updateDisplay:function(){i.each(this.__controllers,(function(t){t.updateDisplay()})),i.each(this.__folders,(function(t){t.updateDisplay()}))}});var lt={Color:g,math:h,interpret:u},ct={Controller:x,BooleanController:C,OptionController:P,StringController:k,NumberController:T,NumberControllerBox:R,NumberControllerSlider:B,FunctionController:L,ColorController:D},ut={dom:A},dt={GUI:Q},ht=Q;const ft={color:lt,controllers:ct,dom:ut,gui:dt,GUI:Q}},538:(t,e,n)=>{n.r(e),n.d(e,{glMatrix:()=>r,mat2:()=>a,mat2d:()=>o,mat3:()=>i,mat4:()=>s,quat:()=>u,quat2:()=>d,vec2:()=>h,vec3:()=>l,vec4:()=>c});var r={};n.r(r),n.d(r,{ARRAY_TYPE:()=>p,EPSILON:()=>f,RANDOM:()=>m,equals:()=>g,setMatrixArrayType:()=>v,toRadian:()=>b});var a={};n.r(a),n.d(a,{LDU:()=>F,add:()=>N,adjoint:()=>P,clone:()=>y,copy:()=>x,create:()=>M,determinant:()=>k,equals:()=>j,exactEquals:()=>I,frob:()=>D,fromRotation:()=>V,fromScaling:()=>B,fromValues:()=>E,identity:()=>w,invert:()=>C,mul:()=>U,multiply:()=>O,multiplyScalar:()=>G,multiplyScalarAndAdd:()=>H,rotate:()=>T,scale:()=>R,set:()=>S,str:()=>L,sub:()=>q,subtract:()=>z,transpose:()=>A});var o={};n.r(o),n.d(o,{add:()=>ct,clone:()=>Y,copy:()=>X,create:()=>W,determinant:()=>$,equals:()=>pt,exactEquals:()=>ft,frob:()=>lt,fromRotation:()=>at,fromScaling:()=>ot,fromTranslation:()=>it,fromValues:()=>K,identity:()=>Q,invert:()=>Z,mul:()=>mt,multiply:()=>tt,multiplyScalar:()=>dt,multiplyScalarAndAdd:()=>ht,rotate:()=>et,scale:()=>nt,set:()=>J,str:()=>st,sub:()=>vt,subtract:()=>ut,translate:()=>rt});var i={};n.r(i),n.d(i,{add:()=>jt,adjoint:()=>At,clone:()=>gt,copy:()=>Mt,create:()=>_t,determinant:()=>Ct,equals:()=>Wt,exactEquals:()=>qt,frob:()=>It,fromMat2d:()=>Lt,fromMat4:()=>bt,fromQuat:()=>Dt,fromRotation:()=>Vt,fromScaling:()=>Bt,fromTranslation:()=>Rt,fromValues:()=>yt,identity:()=>wt,invert:()=>St,mul:()=>Yt,multiply:()=>Pt,multiplyScalar:()=>Ht,multiplyScalarAndAdd:()=>Ut,normalFromMat4:()=>Ft,projection:()=>Nt,rotate:()=>Ot,scale:()=>Tt,set:()=>xt,str:()=>zt,sub:()=>Xt,subtract:()=>Gt,translate:()=>kt,transpose:()=>Et});var s={};n.r(s),n.d(s,{add:()=>Ne,adjoint:()=>re,clone:()=>Kt,copy:()=>Jt,create:()=>Qt,determinant:()=>ae,equals:()=>He,exactEquals:()=>Ge,frob:()=>Fe,fromQuat:()=>Se,fromQuat2:()=>ge,fromRotation:()=>pe,fromRotationTranslation:()=>be,fromRotationTranslationScale:()=>we,fromRotationTranslationScaleOrigin:()=>Ee,fromScaling:()=>fe,fromTranslation:()=>he,fromValues:()=>Zt,fromXRotation:()=>me,fromYRotation:()=>ve,fromZRotation:()=>_e,frustum:()=>Ae,getRotation:()=>xe,getScaling:()=>ye,getTranslation:()=>Me,identity:()=>te,invert:()=>ne,lookAt:()=>Be,mul:()=>Ue,multiply:()=>oe,multiplyScalar:()=>Ie,multiplyScalarAndAdd:()=>je,ortho:()=>Re,orthoNO:()=>Te,orthoZO:()=>Ve,perspective:()=>Pe,perspectiveFromFieldOfView:()=>Oe,perspectiveNO:()=>Ce,perspectiveZO:()=>ke,rotate:()=>le,rotateX:()=>ce,rotateY:()=>ue,rotateZ:()=>de,scale:()=>se,set:()=>$t,str:()=>De,sub:()=>qe,subtract:()=>ze,targetTo:()=>Le,translate:()=>ie,transpose:()=>ee});var l={};n.r(l),n.d(l,{add:()=>Ze,angle:()=>Pn,bezier:()=>Mn,ceil:()=>nn,clone:()=>Ye,copy:()=>Ke,create:()=>We,cross:()=>_n,dist:()=>Fn,distance:()=>un,div:()=>Dn,divide:()=>en,dot:()=>vn,equals:()=>Rn,exactEquals:()=>Tn,floor:()=>rn,forEach:()=>jn,fromValues:()=>Qe,hermite:()=>gn,inverse:()=>pn,len:()=>zn,length:()=>Xe,lerp:()=>bn,max:()=>on,min:()=>an,mul:()=>Ln,multiply:()=>tn,negate:()=>fn,normalize:()=>mn,random:()=>yn,rotateX:()=>Sn,rotateY:()=>An,rotateZ:()=>Cn,round:()=>sn,scale:()=>ln,scaleAndAdd:()=>cn,set:()=>Je,sqrDist:()=>Nn,sqrLen:()=>In,squaredDistance:()=>dn,squaredLength:()=>hn,str:()=>On,sub:()=>Bn,subtract:()=>$e,transformMat3:()=>wn,transformMat4:()=>xn,transformQuat:()=>En,zero:()=>kn});var c={};n.r(c),n.d(c,{add:()=>Yn,ceil:()=>Jn,clone:()=>Hn,copy:()=>qn,create:()=>Gn,cross:()=>hr,dist:()=>Er,distance:()=>ar,div:()=>wr,divide:()=>Kn,dot:()=>dr,equals:()=>Mr,exactEquals:()=>gr,floor:()=>Zn,forEach:()=>Pr,fromValues:()=>Un,inverse:()=>cr,len:()=>Ar,length:()=>ir,lerp:()=>fr,max:()=>tr,min:()=>$n,mul:()=>xr,multiply:()=>Qn,negate:()=>lr,normalize:()=>ur,random:()=>pr,round:()=>er,scale:()=>nr,scaleAndAdd:()=>rr,set:()=>Wn,sqrDist:()=>Sr,sqrLen:()=>Cr,squaredDistance:()=>or,squaredLength:()=>sr,str:()=>br,sub:()=>yr,subtract:()=>Xn,transformMat4:()=>mr,transformQuat:()=>vr,zero:()=>_r});var u={};n.r(u),n.d(u,{add:()=>oa,calculateW:()=>Nr,clone:()=>ea,conjugate:()=>qr,copy:()=>ra,create:()=>kr,dot:()=>la,equals:()=>va,exactEquals:()=>ma,exp:()=>zr,fromEuler:()=>Yr,fromMat3:()=>Wr,fromValues:()=>na,getAngle:()=>Vr,getAxisAngle:()=>Rr,identity:()=>Or,invert:()=>Ur,len:()=>da,length:()=>ua,lerp:()=>ca,ln:()=>Ir,mul:()=>ia,multiply:()=>Br,normalize:()=>pa,pow:()=>jr,random:()=>Hr,rotateX:()=>Lr,rotateY:()=>Dr,rotateZ:()=>Fr,rotationTo:()=>_a,scale:()=>sa,set:()=>aa,setAxes:()=>ga,setAxisAngle:()=>Tr,slerp:()=>Gr,sqlerp:()=>ba,sqrLen:()=>fa,squaredLength:()=>ha,str:()=>Xr});var d={};n.r(d),n.d(d,{add:()=>Ha,clone:()=>ya,conjugate:()=>Ka,copy:()=>Pa,create:()=>Ma,dot:()=>Ya,equals:()=>ao,exactEquals:()=>ro,fromMat4:()=>Ca,fromRotation:()=>Aa,fromRotationTranslation:()=>Ea,fromRotationTranslationValues:()=>wa,fromTranslation:()=>Sa,fromValues:()=>xa,getDual:()=>Ra,getReal:()=>Ta,getTranslation:()=>La,identity:()=>ka,invert:()=>Qa,len:()=>Za,length:()=>Ja,lerp:()=>Xa,mul:()=>qa,multiply:()=>Ua,normalize:()=>eo,rotateAroundAxis:()=>Ga,rotateByQuatAppend:()=>Ia,rotateByQuatPrepend:()=>ja,rotateX:()=>Fa,rotateY:()=>Na,rotateZ:()=>za,scale:()=>Wa,set:()=>Oa,setDual:()=>Ba,setReal:()=>Va,sqrLen:()=>to,squaredLength:()=>$a,str:()=>no,translate:()=>Da});var h={};n.r(h),n.d(h,{add:()=>uo,angle:()=>No,ceil:()=>mo,clone:()=>io,copy:()=>lo,create:()=>oo,cross:()=>Oo,dist:()=>Yo,distance:()=>xo,div:()=>Wo,divide:()=>po,dot:()=>ko,equals:()=>Go,exactEquals:()=>jo,floor:()=>vo,forEach:()=>Ko,fromValues:()=>so,inverse:()=>Co,len:()=>Ho,length:()=>Eo,lerp:()=>To,max:()=>bo,min:()=>_o,mul:()=>qo,multiply:()=>fo,negate:()=>Ao,normalize:()=>Po,random:()=>Ro,rotate:()=>Fo,round:()=>go,scale:()=>Mo,scaleAndAdd:()=>yo,set:()=>co,sqrDist:()=>Xo,sqrLen:()=>Qo,squaredDistance:()=>wo,squaredLength:()=>So,str:()=>Io,sub:()=>Uo,subtract:()=>ho,transformMat2:()=>Vo,transformMat2d:()=>Bo,transformMat3:()=>Lo,transformMat4:()=>Do,zero:()=>zo});var f=1e-6,p="undefined"!=typeof Float32Array?Float32Array:Array,m=Math.random;function v(t){p=t}var _=Math.PI/180;function b(t){return t*_}function g(t,e){return Math.abs(t-e)<=f*Math.max(1,Math.abs(t),Math.abs(e))}function M(){var t=new p(4);return p!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function y(t){var e=new p(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function x(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function w(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function E(t,e,n,r){var a=new p(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=r,a}function S(t,e,n,r,a){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t}function A(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function C(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=n*o-a*r;return i?(i=1/i,t[0]=o*i,t[1]=-r*i,t[2]=-a*i,t[3]=n*i,t):null}function P(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t}function k(t){return t[0]*t[3]-t[2]*t[1]}function O(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=n[0],l=n[1],c=n[2],u=n[3];return t[0]=r*s+o*l,t[1]=a*s+i*l,t[2]=r*c+o*u,t[3]=a*c+i*u,t}function T(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=r*l+o*s,t[1]=a*l+i*s,t[2]=r*-s+o*l,t[3]=a*-s+i*l,t}function R(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=n[0],l=n[1];return t[0]=r*s,t[1]=a*s,t[2]=o*l,t[3]=i*l,t}function V(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t}function B(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function L(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function D(t){return Math.hypot(t[0],t[1],t[2],t[3])}function F(t,e,n,r){return t[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-t[2]*n[1],[t,e,n]}function N(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function z(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function I(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function j(t,e){var n=t[0],r=t[1],a=t[2],o=t[3],i=e[0],s=e[1],l=e[2],c=e[3];return Math.abs(n-i)<=f*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-s)<=f*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-l)<=f*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(o-c)<=f*Math.max(1,Math.abs(o),Math.abs(c))}function G(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function H(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var U=O,q=z;function W(){var t=new p(6);return p!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function Y(t){var e=new p(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function X(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Q(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function K(t,e,n,r,a,o){var i=new p(6);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i[4]=a,i[5]=o,i}function J(t,e,n,r,a,o,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=o,t[5]=i,t}function Z(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],s=e[5],l=n*o-r*a;return l?(l=1/l,t[0]=o*l,t[1]=-r*l,t[2]=-a*l,t[3]=n*l,t[4]=(a*s-o*i)*l,t[5]=(r*i-n*s)*l,t):null}function $(t){return t[0]*t[3]-t[1]*t[2]}function tt(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=e[4],l=e[5],c=n[0],u=n[1],d=n[2],h=n[3],f=n[4],p=n[5];return t[0]=r*c+o*u,t[1]=a*c+i*u,t[2]=r*d+o*h,t[3]=a*d+i*h,t[4]=r*f+o*p+s,t[5]=a*f+i*p+l,t}function et(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=e[4],l=e[5],c=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*c,t[1]=a*u+i*c,t[2]=r*-c+o*u,t[3]=a*-c+i*u,t[4]=s,t[5]=l,t}function nt(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=e[4],l=e[5],c=n[0],u=n[1];return t[0]=r*c,t[1]=a*c,t[2]=o*u,t[3]=i*u,t[4]=s,t[5]=l,t}function rt(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=e[4],l=e[5],c=n[0],u=n[1];return t[0]=r,t[1]=a,t[2]=o,t[3]=i,t[4]=r*c+o*u+s,t[5]=a*c+i*u+l,t}function at(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=-n,t[3]=r,t[4]=0,t[5]=0,t}function ot(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function it(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function st(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function lt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function ct(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t}function ut(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}function dt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t}function ht(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t}function ft(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function pt(t,e){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],s=t[5],l=e[0],c=e[1],u=e[2],d=e[3],h=e[4],p=e[5];return Math.abs(n-l)<=f*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-c)<=f*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(a-u)<=f*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(o-d)<=f*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(i-h)<=f*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(s-p)<=f*Math.max(1,Math.abs(s),Math.abs(p))}var mt=tt,vt=ut;function _t(){var t=new p(9);return p!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function bt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function gt(t){var e=new p(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Mt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function yt(t,e,n,r,a,o,i,s,l){var c=new p(9);return c[0]=t,c[1]=e,c[2]=n,c[3]=r,c[4]=a,c[5]=o,c[6]=i,c[7]=s,c[8]=l,c}function xt(t,e,n,r,a,o,i,s,l,c){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=o,t[5]=i,t[6]=s,t[7]=l,t[8]=c,t}function wt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Et(t,e){if(t===e){var n=e[1],r=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function St(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],s=e[5],l=e[6],c=e[7],u=e[8],d=u*i-s*c,h=-u*o+s*l,f=c*o-i*l,p=n*d+r*h+a*f;return p?(p=1/p,t[0]=d*p,t[1]=(-u*r+a*c)*p,t[2]=(s*r-a*i)*p,t[3]=h*p,t[4]=(u*n-a*l)*p,t[5]=(-s*n+a*o)*p,t[6]=f*p,t[7]=(-c*n+r*l)*p,t[8]=(i*n-r*o)*p,t):null}function At(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],s=e[5],l=e[6],c=e[7],u=e[8];return t[0]=i*u-s*c,t[1]=a*c-r*u,t[2]=r*s-a*i,t[3]=s*l-o*u,t[4]=n*u-a*l,t[5]=a*o-n*s,t[6]=o*c-i*l,t[7]=r*l-n*c,t[8]=n*i-r*o,t}function Ct(t){var e=t[0],n=t[1],r=t[2],a=t[3],o=t[4],i=t[5],s=t[6],l=t[7],c=t[8];return e*(c*o-i*l)+n*(-c*a+i*s)+r*(l*a-o*s)}function Pt(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=e[8],h=n[0],f=n[1],p=n[2],m=n[3],v=n[4],_=n[5],b=n[6],g=n[7],M=n[8];return t[0]=h*r+f*i+p*c,t[1]=h*a+f*s+p*u,t[2]=h*o+f*l+p*d,t[3]=m*r+v*i+_*c,t[4]=m*a+v*s+_*u,t[5]=m*o+v*l+_*d,t[6]=b*r+g*i+M*c,t[7]=b*a+g*s+M*u,t[8]=b*o+g*l+M*d,t}function kt(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=e[8],h=n[0],f=n[1];return t[0]=r,t[1]=a,t[2]=o,t[3]=i,t[4]=s,t[5]=l,t[6]=h*r+f*i+c,t[7]=h*a+f*s+u,t[8]=h*o+f*l+d,t}function Ot(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=e[8],h=Math.sin(n),f=Math.cos(n);return t[0]=f*r+h*i,t[1]=f*a+h*s,t[2]=f*o+h*l,t[3]=f*i-h*r,t[4]=f*s-h*a,t[5]=f*l-h*o,t[6]=c,t[7]=u,t[8]=d,t}function Tt(t,e,n){var r=n[0],a=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Rt(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Vt(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Bt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Lt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Dt(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=n+n,s=r+r,l=a+a,c=n*i,u=r*i,d=r*s,h=a*i,f=a*s,p=a*l,m=o*i,v=o*s,_=o*l;return t[0]=1-d-p,t[3]=u-_,t[6]=h+v,t[1]=u+_,t[4]=1-c-p,t[7]=f-m,t[2]=h-v,t[5]=f+m,t[8]=1-c-d,t}function Ft(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],s=e[5],l=e[6],c=e[7],u=e[8],d=e[9],h=e[10],f=e[11],p=e[12],m=e[13],v=e[14],_=e[15],b=n*s-r*i,g=n*l-a*i,M=n*c-o*i,y=r*l-a*s,x=r*c-o*s,w=a*c-o*l,E=u*m-d*p,S=u*v-h*p,A=u*_-f*p,C=d*v-h*m,P=d*_-f*m,k=h*_-f*v,O=b*k-g*P+M*C+y*A-x*S+w*E;return O?(O=1/O,t[0]=(s*k-l*P+c*C)*O,t[1]=(l*A-i*k-c*S)*O,t[2]=(i*P-s*A+c*E)*O,t[3]=(a*P-r*k-o*C)*O,t[4]=(n*k-a*A+o*S)*O,t[5]=(r*A-n*P-o*E)*O,t[6]=(m*w-v*x+_*y)*O,t[7]=(v*M-p*w-_*g)*O,t[8]=(p*x-m*M+_*b)*O,t):null}function Nt(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function zt(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function It(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function jt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function Gt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function Ht(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function Ut(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function qt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Wt(t,e){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=e[0],h=e[1],p=e[2],m=e[3],v=e[4],_=e[5],b=e[6],g=e[7],M=e[8];return Math.abs(n-d)<=f*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(r-h)<=f*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(a-p)<=f*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-m)<=f*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(i-v)<=f*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(s-_)<=f*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(l-b)<=f*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-g)<=f*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(u-M)<=f*Math.max(1,Math.abs(u),Math.abs(M))}var Yt=Pt,Xt=Gt;function Qt(){var t=new p(16);return p!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Kt(t){var e=new p(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Jt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Zt(t,e,n,r,a,o,i,s,l,c,u,d,h,f,m,v){var _=new p(16);return _[0]=t,_[1]=e,_[2]=n,_[3]=r,_[4]=a,_[5]=o,_[6]=i,_[7]=s,_[8]=l,_[9]=c,_[10]=u,_[11]=d,_[12]=h,_[13]=f,_[14]=m,_[15]=v,_}function $t(t,e,n,r,a,o,i,s,l,c,u,d,h,f,p,m,v){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=o,t[5]=i,t[6]=s,t[7]=l,t[8]=c,t[9]=u,t[10]=d,t[11]=h,t[12]=f,t[13]=p,t[14]=m,t[15]=v,t}function te(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ee(t,e){if(t===e){var n=e[1],r=e[2],a=e[3],o=e[6],i=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=a,t[13]=i,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function ne(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],s=e[5],l=e[6],c=e[7],u=e[8],d=e[9],h=e[10],f=e[11],p=e[12],m=e[13],v=e[14],_=e[15],b=n*s-r*i,g=n*l-a*i,M=n*c-o*i,y=r*l-a*s,x=r*c-o*s,w=a*c-o*l,E=u*m-d*p,S=u*v-h*p,A=u*_-f*p,C=d*v-h*m,P=d*_-f*m,k=h*_-f*v,O=b*k-g*P+M*C+y*A-x*S+w*E;return O?(O=1/O,t[0]=(s*k-l*P+c*C)*O,t[1]=(a*P-r*k-o*C)*O,t[2]=(m*w-v*x+_*y)*O,t[3]=(h*x-d*w-f*y)*O,t[4]=(l*A-i*k-c*S)*O,t[5]=(n*k-a*A+o*S)*O,t[6]=(v*M-p*w-_*g)*O,t[7]=(u*w-h*M+f*g)*O,t[8]=(i*P-s*A+c*E)*O,t[9]=(r*A-n*P-o*E)*O,t[10]=(p*x-m*M+_*b)*O,t[11]=(d*M-u*x-f*b)*O,t[12]=(s*S-i*C-l*E)*O,t[13]=(n*C-r*S+a*E)*O,t[14]=(m*g-p*y-v*b)*O,t[15]=(u*y-d*g+h*b)*O,t):null}function re(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=e[4],s=e[5],l=e[6],c=e[7],u=e[8],d=e[9],h=e[10],f=e[11],p=e[12],m=e[13],v=e[14],_=e[15];return t[0]=s*(h*_-f*v)-d*(l*_-c*v)+m*(l*f-c*h),t[1]=-(r*(h*_-f*v)-d*(a*_-o*v)+m*(a*f-o*h)),t[2]=r*(l*_-c*v)-s*(a*_-o*v)+m*(a*c-o*l),t[3]=-(r*(l*f-c*h)-s*(a*f-o*h)+d*(a*c-o*l)),t[4]=-(i*(h*_-f*v)-u*(l*_-c*v)+p*(l*f-c*h)),t[5]=n*(h*_-f*v)-u*(a*_-o*v)+p*(a*f-o*h),t[6]=-(n*(l*_-c*v)-i*(a*_-o*v)+p*(a*c-o*l)),t[7]=n*(l*f-c*h)-i*(a*f-o*h)+u*(a*c-o*l),t[8]=i*(d*_-f*m)-u*(s*_-c*m)+p*(s*f-c*d),t[9]=-(n*(d*_-f*m)-u*(r*_-o*m)+p*(r*f-o*d)),t[10]=n*(s*_-c*m)-i*(r*_-o*m)+p*(r*c-o*s),t[11]=-(n*(s*f-c*d)-i*(r*f-o*d)+u*(r*c-o*s)),t[12]=-(i*(d*v-h*m)-u*(s*v-l*m)+p*(s*h-l*d)),t[13]=n*(d*v-h*m)-u*(r*v-a*m)+p*(r*h-a*d),t[14]=-(n*(s*v-l*m)-i*(r*v-a*m)+p*(r*l-a*s)),t[15]=n*(s*h-l*d)-i*(r*h-a*d)+u*(r*l-a*s),t}function ae(t){var e=t[0],n=t[1],r=t[2],a=t[3],o=t[4],i=t[5],s=t[6],l=t[7],c=t[8],u=t[9],d=t[10],h=t[11],f=t[12],p=t[13],m=t[14],v=t[15];return(e*i-n*o)*(d*v-h*m)-(e*s-r*o)*(u*v-h*p)+(e*l-a*o)*(u*m-d*p)+(n*s-r*i)*(c*v-h*f)-(n*l-a*i)*(c*m-d*f)+(r*l-a*s)*(c*p-u*f)}function oe(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=e[8],h=e[9],f=e[10],p=e[11],m=e[12],v=e[13],_=e[14],b=e[15],g=n[0],M=n[1],y=n[2],x=n[3];return t[0]=g*r+M*s+y*d+x*m,t[1]=g*a+M*l+y*h+x*v,t[2]=g*o+M*c+y*f+x*_,t[3]=g*i+M*u+y*p+x*b,g=n[4],M=n[5],y=n[6],x=n[7],t[4]=g*r+M*s+y*d+x*m,t[5]=g*a+M*l+y*h+x*v,t[6]=g*o+M*c+y*f+x*_,t[7]=g*i+M*u+y*p+x*b,g=n[8],M=n[9],y=n[10],x=n[11],t[8]=g*r+M*s+y*d+x*m,t[9]=g*a+M*l+y*h+x*v,t[10]=g*o+M*c+y*f+x*_,t[11]=g*i+M*u+y*p+x*b,g=n[12],M=n[13],y=n[14],x=n[15],t[12]=g*r+M*s+y*d+x*m,t[13]=g*a+M*l+y*h+x*v,t[14]=g*o+M*c+y*f+x*_,t[15]=g*i+M*u+y*p+x*b,t}function ie(t,e,n){var r,a,o,i,s,l,c,u,d,h,f,p,m=n[0],v=n[1],_=n[2];return e===t?(t[12]=e[0]*m+e[4]*v+e[8]*_+e[12],t[13]=e[1]*m+e[5]*v+e[9]*_+e[13],t[14]=e[2]*m+e[6]*v+e[10]*_+e[14],t[15]=e[3]*m+e[7]*v+e[11]*_+e[15]):(r=e[0],a=e[1],o=e[2],i=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=e[8],h=e[9],f=e[10],p=e[11],t[0]=r,t[1]=a,t[2]=o,t[3]=i,t[4]=s,t[5]=l,t[6]=c,t[7]=u,t[8]=d,t[9]=h,t[10]=f,t[11]=p,t[12]=r*m+s*v+d*_+e[12],t[13]=a*m+l*v+h*_+e[13],t[14]=o*m+c*v+f*_+e[14],t[15]=i*m+u*v+p*_+e[15]),t}function se(t,e,n){var r=n[0],a=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function le(t,e,n,r){var a,o,i,s,l,c,u,d,h,p,m,v,_,b,g,M,y,x,w,E,S,A,C,P,k=r[0],O=r[1],T=r[2],R=Math.hypot(k,O,T);return R<f?null:(k*=R=1/R,O*=R,T*=R,a=Math.sin(n),i=1-(o=Math.cos(n)),s=e[0],l=e[1],c=e[2],u=e[3],d=e[4],h=e[5],p=e[6],m=e[7],v=e[8],_=e[9],b=e[10],g=e[11],M=k*k*i+o,y=O*k*i+T*a,x=T*k*i-O*a,w=k*O*i-T*a,E=O*O*i+o,S=T*O*i+k*a,A=k*T*i+O*a,C=O*T*i-k*a,P=T*T*i+o,t[0]=s*M+d*y+v*x,t[1]=l*M+h*y+_*x,t[2]=c*M+p*y+b*x,t[3]=u*M+m*y+g*x,t[4]=s*w+d*E+v*S,t[5]=l*w+h*E+_*S,t[6]=c*w+p*E+b*S,t[7]=u*w+m*E+g*S,t[8]=s*A+d*C+v*P,t[9]=l*A+h*C+_*P,t[10]=c*A+p*C+b*P,t[11]=u*A+m*C+g*P,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function ce(t,e,n){var r=Math.sin(n),a=Math.cos(n),o=e[4],i=e[5],s=e[6],l=e[7],c=e[8],u=e[9],d=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*a+c*r,t[5]=i*a+u*r,t[6]=s*a+d*r,t[7]=l*a+h*r,t[8]=c*a-o*r,t[9]=u*a-i*r,t[10]=d*a-s*r,t[11]=h*a-l*r,t}function ue(t,e,n){var r=Math.sin(n),a=Math.cos(n),o=e[0],i=e[1],s=e[2],l=e[3],c=e[8],u=e[9],d=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*a-c*r,t[1]=i*a-u*r,t[2]=s*a-d*r,t[3]=l*a-h*r,t[8]=o*r+c*a,t[9]=i*r+u*a,t[10]=s*r+d*a,t[11]=l*r+h*a,t}function de(t,e,n){var r=Math.sin(n),a=Math.cos(n),o=e[0],i=e[1],s=e[2],l=e[3],c=e[4],u=e[5],d=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*a+c*r,t[1]=i*a+u*r,t[2]=s*a+d*r,t[3]=l*a+h*r,t[4]=c*a-o*r,t[5]=u*a-i*r,t[6]=d*a-s*r,t[7]=h*a-l*r,t}function he(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function fe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pe(t,e,n){var r,a,o,i=n[0],s=n[1],l=n[2],c=Math.hypot(i,s,l);return c<f?null:(i*=c=1/c,s*=c,l*=c,r=Math.sin(e),o=1-(a=Math.cos(e)),t[0]=i*i*o+a,t[1]=s*i*o+l*r,t[2]=l*i*o-s*r,t[3]=0,t[4]=i*s*o-l*r,t[5]=s*s*o+a,t[6]=l*s*o+i*r,t[7]=0,t[8]=i*l*o+s*r,t[9]=s*l*o-i*r,t[10]=l*l*o+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function me(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ve(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _e(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function be(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=r+r,l=a+a,c=o+o,u=r*s,d=r*l,h=r*c,f=a*l,p=a*c,m=o*c,v=i*s,_=i*l,b=i*c;return t[0]=1-(f+m),t[1]=d+b,t[2]=h-_,t[3]=0,t[4]=d-b,t[5]=1-(u+m),t[6]=p+v,t[7]=0,t[8]=h+_,t[9]=p-v,t[10]=1-(u+f),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function ge(t,e){var n=new p(3),r=-e[0],a=-e[1],o=-e[2],i=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=r*r+a*a+o*o+i*i;return d>0?(n[0]=2*(s*i+u*r+l*o-c*a)/d,n[1]=2*(l*i+u*a+c*r-s*o)/d,n[2]=2*(c*i+u*o+s*a-l*r)/d):(n[0]=2*(s*i+u*r+l*o-c*a),n[1]=2*(l*i+u*a+c*r-s*o),n[2]=2*(c*i+u*o+s*a-l*r)),be(t,e,n),t}function Me(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function ye(t,e){var n=e[0],r=e[1],a=e[2],o=e[4],i=e[5],s=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.hypot(n,r,a),t[1]=Math.hypot(o,i,s),t[2]=Math.hypot(l,c,u),t}function xe(t,e){var n=new p(3);ye(n,e);var r=1/n[0],a=1/n[1],o=1/n[2],i=e[0]*r,s=e[1]*a,l=e[2]*o,c=e[4]*r,u=e[5]*a,d=e[6]*o,h=e[8]*r,f=e[9]*a,m=e[10]*o,v=i+u+m,_=0;return v>0?(_=2*Math.sqrt(v+1),t[3]=.25*_,t[0]=(d-f)/_,t[1]=(h-l)/_,t[2]=(s-c)/_):i>u&&i>m?(_=2*Math.sqrt(1+i-u-m),t[3]=(d-f)/_,t[0]=.25*_,t[1]=(s+c)/_,t[2]=(h+l)/_):u>m?(_=2*Math.sqrt(1+u-i-m),t[3]=(h-l)/_,t[0]=(s+c)/_,t[1]=.25*_,t[2]=(d+f)/_):(_=2*Math.sqrt(1+m-i-u),t[3]=(s-c)/_,t[0]=(h+l)/_,t[1]=(d+f)/_,t[2]=.25*_),t}function we(t,e,n,r){var a=e[0],o=e[1],i=e[2],s=e[3],l=a+a,c=o+o,u=i+i,d=a*l,h=a*c,f=a*u,p=o*c,m=o*u,v=i*u,_=s*l,b=s*c,g=s*u,M=r[0],y=r[1],x=r[2];return t[0]=(1-(p+v))*M,t[1]=(h+g)*M,t[2]=(f-b)*M,t[3]=0,t[4]=(h-g)*y,t[5]=(1-(d+v))*y,t[6]=(m+_)*y,t[7]=0,t[8]=(f+b)*x,t[9]=(m-_)*x,t[10]=(1-(d+p))*x,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Ee(t,e,n,r,a){var o=e[0],i=e[1],s=e[2],l=e[3],c=o+o,u=i+i,d=s+s,h=o*c,f=o*u,p=o*d,m=i*u,v=i*d,_=s*d,b=l*c,g=l*u,M=l*d,y=r[0],x=r[1],w=r[2],E=a[0],S=a[1],A=a[2],C=(1-(m+_))*y,P=(f+M)*y,k=(p-g)*y,O=(f-M)*x,T=(1-(h+_))*x,R=(v+b)*x,V=(p+g)*w,B=(v-b)*w,L=(1-(h+m))*w;return t[0]=C,t[1]=P,t[2]=k,t[3]=0,t[4]=O,t[5]=T,t[6]=R,t[7]=0,t[8]=V,t[9]=B,t[10]=L,t[11]=0,t[12]=n[0]+E-(C*E+O*S+V*A),t[13]=n[1]+S-(P*E+T*S+B*A),t[14]=n[2]+A-(k*E+R*S+L*A),t[15]=1,t}function Se(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=n+n,s=r+r,l=a+a,c=n*i,u=r*i,d=r*s,h=a*i,f=a*s,p=a*l,m=o*i,v=o*s,_=o*l;return t[0]=1-d-p,t[1]=u+_,t[2]=h-v,t[3]=0,t[4]=u-_,t[5]=1-c-p,t[6]=f+m,t[7]=0,t[8]=h+v,t[9]=f-m,t[10]=1-c-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ae(t,e,n,r,a,o,i){var s=1/(n-e),l=1/(a-r),c=1/(o-i);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*l,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(a+r)*l,t[10]=(i+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=i*o*2*c,t[15]=0,t}function Ce(t,e,n,r,a){var o,i=1/Math.tan(e/2);return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(o=1/(r-a),t[10]=(a+r)*o,t[14]=2*a*r*o):(t[10]=-1,t[14]=-2*r),t}var Pe=Ce;function ke(t,e,n,r,a){var o,i=1/Math.tan(e/2);return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=a&&a!==1/0?(o=1/(r-a),t[10]=a*o,t[14]=a*r*o):(t[10]=-1,t[14]=-r),t}function Oe(t,e,n,r){var a=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),i=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),l=2/(i+s),c=2/(a+o);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(i-s)*l*.5,t[9]=(a-o)*c*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function Te(t,e,n,r,a,o,i){var s=1/(e-n),l=1/(r-a),c=1/(o-i);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(a+r)*l,t[14]=(i+o)*c,t[15]=1,t}var Re=Te;function Ve(t,e,n,r,a,o,i){var s=1/(e-n),l=1/(r-a),c=1/(o-i);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=c,t[11]=0,t[12]=(e+n)*s,t[13]=(a+r)*l,t[14]=o*c,t[15]=1,t}function Be(t,e,n,r){var a,o,i,s,l,c,u,d,h,p,m=e[0],v=e[1],_=e[2],b=r[0],g=r[1],M=r[2],y=n[0],x=n[1],w=n[2];return Math.abs(m-y)<f&&Math.abs(v-x)<f&&Math.abs(_-w)<f?te(t):(u=m-y,d=v-x,h=_-w,a=g*(h*=p=1/Math.hypot(u,d,h))-M*(d*=p),o=M*(u*=p)-b*h,i=b*d-g*u,(p=Math.hypot(a,o,i))?(a*=p=1/p,o*=p,i*=p):(a=0,o=0,i=0),s=d*i-h*o,l=h*a-u*i,c=u*o-d*a,(p=Math.hypot(s,l,c))?(s*=p=1/p,l*=p,c*=p):(s=0,l=0,c=0),t[0]=a,t[1]=s,t[2]=u,t[3]=0,t[4]=o,t[5]=l,t[6]=d,t[7]=0,t[8]=i,t[9]=c,t[10]=h,t[11]=0,t[12]=-(a*m+o*v+i*_),t[13]=-(s*m+l*v+c*_),t[14]=-(u*m+d*v+h*_),t[15]=1,t)}function Le(t,e,n,r){var a=e[0],o=e[1],i=e[2],s=r[0],l=r[1],c=r[2],u=a-n[0],d=o-n[1],h=i-n[2],f=u*u+d*d+h*h;f>0&&(u*=f=1/Math.sqrt(f),d*=f,h*=f);var p=l*h-c*d,m=c*u-s*h,v=s*d-l*u;return(f=p*p+m*m+v*v)>0&&(p*=f=1/Math.sqrt(f),m*=f,v*=f),t[0]=p,t[1]=m,t[2]=v,t[3]=0,t[4]=d*v-h*m,t[5]=h*p-u*v,t[6]=u*m-d*p,t[7]=0,t[8]=u,t[9]=d,t[10]=h,t[11]=0,t[12]=a,t[13]=o,t[14]=i,t[15]=1,t}function De(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Fe(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Ne(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function ze(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function Ie(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function je(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function Ge(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function He(t,e){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=t[9],h=t[10],p=t[11],m=t[12],v=t[13],_=t[14],b=t[15],g=e[0],M=e[1],y=e[2],x=e[3],w=e[4],E=e[5],S=e[6],A=e[7],C=e[8],P=e[9],k=e[10],O=e[11],T=e[12],R=e[13],V=e[14],B=e[15];return Math.abs(n-g)<=f*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(r-M)<=f*Math.max(1,Math.abs(r),Math.abs(M))&&Math.abs(a-y)<=f*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(o-x)<=f*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(i-w)<=f*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(s-E)<=f*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(l-S)<=f*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-A)<=f*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(u-C)<=f*Math.max(1,Math.abs(u),Math.abs(C))&&Math.abs(d-P)<=f*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(h-k)<=f*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(p-O)<=f*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(m-T)<=f*Math.max(1,Math.abs(m),Math.abs(T))&&Math.abs(v-R)<=f*Math.max(1,Math.abs(v),Math.abs(R))&&Math.abs(_-V)<=f*Math.max(1,Math.abs(_),Math.abs(V))&&Math.abs(b-B)<=f*Math.max(1,Math.abs(b),Math.abs(B))}var Ue=oe,qe=ze;function We(){var t=new p(3);return p!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ye(t){var e=new p(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Xe(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function Qe(t,e,n){var r=new p(3);return r[0]=t,r[1]=e,r[2]=n,r}function Ke(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Je(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function Ze(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function $e(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function tn(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function en(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function nn(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function rn(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function an(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function on(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function sn(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function ln(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function cn(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function un(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2];return Math.hypot(n,r,a)}function dn(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2];return n*n+r*r+a*a}function hn(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function fn(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function pn(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function mn(t,e){var n=e[0],r=e[1],a=e[2],o=n*n+r*r+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function vn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function _n(t,e,n){var r=e[0],a=e[1],o=e[2],i=n[0],s=n[1],l=n[2];return t[0]=a*l-o*s,t[1]=o*i-r*l,t[2]=r*s-a*i,t}function bn(t,e,n,r){var a=e[0],o=e[1],i=e[2];return t[0]=a+r*(n[0]-a),t[1]=o+r*(n[1]-o),t[2]=i+r*(n[2]-i),t}function gn(t,e,n,r,a,o){var i=o*o,s=i*(2*o-3)+1,l=i*(o-2)+o,c=i*(o-1),u=i*(3-2*o);return t[0]=e[0]*s+n[0]*l+r[0]*c+a[0]*u,t[1]=e[1]*s+n[1]*l+r[1]*c+a[1]*u,t[2]=e[2]*s+n[2]*l+r[2]*c+a[2]*u,t}function Mn(t,e,n,r,a,o){var i=1-o,s=i*i,l=o*o,c=s*i,u=3*o*s,d=3*l*i,h=l*o;return t[0]=e[0]*c+n[0]*u+r[0]*d+a[0]*h,t[1]=e[1]*c+n[1]*u+r[1]*d+a[1]*h,t[2]=e[2]*c+n[2]*u+r[2]*d+a[2]*h,t}function yn(t,e){e=e||1;var n=2*m()*Math.PI,r=2*m()-1,a=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*a,t[1]=Math.sin(n)*a,t[2]=r*e,t}function xn(t,e,n){var r=e[0],a=e[1],o=e[2],i=n[3]*r+n[7]*a+n[11]*o+n[15];return i=i||1,t[0]=(n[0]*r+n[4]*a+n[8]*o+n[12])/i,t[1]=(n[1]*r+n[5]*a+n[9]*o+n[13])/i,t[2]=(n[2]*r+n[6]*a+n[10]*o+n[14])/i,t}function wn(t,e,n){var r=e[0],a=e[1],o=e[2];return t[0]=r*n[0]+a*n[3]+o*n[6],t[1]=r*n[1]+a*n[4]+o*n[7],t[2]=r*n[2]+a*n[5]+o*n[8],t}function En(t,e,n){var r=n[0],a=n[1],o=n[2],i=n[3],s=e[0],l=e[1],c=e[2],u=a*c-o*l,d=o*s-r*c,h=r*l-a*s,f=a*h-o*d,p=o*u-r*h,m=r*d-a*u,v=2*i;return u*=v,d*=v,h*=v,f*=2,p*=2,m*=2,t[0]=s+u+f,t[1]=l+d+p,t[2]=c+h+m,t}function Sn(t,e,n,r){var a=[],o=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],o[0]=a[0],o[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),o[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function An(t,e,n,r){var a=[],o=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],o[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),o[1]=a[1],o[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Cn(t,e,n,r){var a=[],o=[];return a[0]=e[0]-n[0],a[1]=e[1]-n[1],a[2]=e[2]-n[2],o[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),o[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),o[2]=a[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Pn(t,e){var n=t[0],r=t[1],a=t[2],o=e[0],i=e[1],s=e[2],l=Math.sqrt(n*n+r*r+a*a)*Math.sqrt(o*o+i*i+s*s),c=l&&vn(t,e)/l;return Math.acos(Math.min(Math.max(c,-1),1))}function kn(t){return t[0]=0,t[1]=0,t[2]=0,t}function On(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Tn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Rn(t,e){var n=t[0],r=t[1],a=t[2],o=e[0],i=e[1],s=e[2];return Math.abs(n-o)<=f*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-i)<=f*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(a-s)<=f*Math.max(1,Math.abs(a),Math.abs(s))}var Vn,Bn=$e,Ln=tn,Dn=en,Fn=un,Nn=dn,zn=Xe,In=hn,jn=(Vn=We(),function(t,e,n,r,a,o){var i,s;for(e||(e=3),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,i=n;i<s;i+=e)Vn[0]=t[i],Vn[1]=t[i+1],Vn[2]=t[i+2],a(Vn,Vn,o),t[i]=Vn[0],t[i+1]=Vn[1],t[i+2]=Vn[2];return t});function Gn(){var t=new p(4);return p!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Hn(t){var e=new p(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Un(t,e,n,r){var a=new p(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=r,a}function qn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Wn(t,e,n,r,a){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t}function Yn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function Xn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function Qn(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Kn(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function Jn(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Zn(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function $n(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t}function tr(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t}function er(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function nr(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function rr(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}function ar(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2],o=e[3]-t[3];return Math.hypot(n,r,a,o)}function or(t,e){var n=e[0]-t[0],r=e[1]-t[1],a=e[2]-t[2],o=e[3]-t[3];return n*n+r*r+a*a+o*o}function ir(t){var e=t[0],n=t[1],r=t[2],a=t[3];return Math.hypot(e,n,r,a)}function sr(t){var e=t[0],n=t[1],r=t[2],a=t[3];return e*e+n*n+r*r+a*a}function lr(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function cr(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function ur(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=n*n+r*r+a*a+o*o;return i>0&&(i=1/Math.sqrt(i)),t[0]=n*i,t[1]=r*i,t[2]=a*i,t[3]=o*i,t}function dr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function hr(t,e,n,r){var a=n[0]*r[1]-n[1]*r[0],o=n[0]*r[2]-n[2]*r[0],i=n[0]*r[3]-n[3]*r[0],s=n[1]*r[2]-n[2]*r[1],l=n[1]*r[3]-n[3]*r[1],c=n[2]*r[3]-n[3]*r[2],u=e[0],d=e[1],h=e[2],f=e[3];return t[0]=d*c-h*l+f*s,t[1]=-u*c+h*i-f*o,t[2]=u*l-d*i+f*a,t[3]=-u*s+d*o-h*a,t}function fr(t,e,n,r){var a=e[0],o=e[1],i=e[2],s=e[3];return t[0]=a+r*(n[0]-a),t[1]=o+r*(n[1]-o),t[2]=i+r*(n[2]-i),t[3]=s+r*(n[3]-s),t}function pr(t,e){var n,r,a,o,i,s;e=e||1;do{i=(n=2*m()-1)*n+(r=2*m()-1)*r}while(i>=1);do{s=(a=2*m()-1)*a+(o=2*m()-1)*o}while(s>=1);var l=Math.sqrt((1-i)/s);return t[0]=e*n,t[1]=e*r,t[2]=e*a*l,t[3]=e*o*l,t}function mr(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3];return t[0]=n[0]*r+n[4]*a+n[8]*o+n[12]*i,t[1]=n[1]*r+n[5]*a+n[9]*o+n[13]*i,t[2]=n[2]*r+n[6]*a+n[10]*o+n[14]*i,t[3]=n[3]*r+n[7]*a+n[11]*o+n[15]*i,t}function vr(t,e,n){var r=e[0],a=e[1],o=e[2],i=n[0],s=n[1],l=n[2],c=n[3],u=c*r+s*o-l*a,d=c*a+l*r-i*o,h=c*o+i*a-s*r,f=-i*r-s*a-l*o;return t[0]=u*c+f*-i+d*-l-h*-s,t[1]=d*c+f*-s+h*-i-u*-l,t[2]=h*c+f*-l+u*-s-d*-i,t[3]=e[3],t}function _r(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function br(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function gr(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Mr(t,e){var n=t[0],r=t[1],a=t[2],o=t[3],i=e[0],s=e[1],l=e[2],c=e[3];return Math.abs(n-i)<=f*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-s)<=f*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-l)<=f*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(o-c)<=f*Math.max(1,Math.abs(o),Math.abs(c))}var yr=Xn,xr=Qn,wr=Kn,Er=ar,Sr=or,Ar=ir,Cr=sr,Pr=function(){var t=Gn();return function(e,n,r,a,o,i){var s,l;for(n||(n=4),r||(r=0),l=a?Math.min(a*n+r,e.length):e.length,s=r;s<l;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,i),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}();function kr(){var t=new p(4);return p!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Or(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Tr(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function Rr(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return r>f?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function Vr(t,e){var n=la(t,e);return Math.acos(2*n*n-1)}function Br(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=n[0],l=n[1],c=n[2],u=n[3];return t[0]=r*u+i*s+a*c-o*l,t[1]=a*u+i*l+o*s-r*c,t[2]=o*u+i*c+r*l-a*s,t[3]=i*u-r*s-a*l-o*c,t}function Lr(t,e,n){n*=.5;var r=e[0],a=e[1],o=e[2],i=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=r*l+i*s,t[1]=a*l+o*s,t[2]=o*l-a*s,t[3]=i*l-r*s,t}function Dr(t,e,n){n*=.5;var r=e[0],a=e[1],o=e[2],i=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=r*l-o*s,t[1]=a*l+i*s,t[2]=o*l+r*s,t[3]=i*l-a*s,t}function Fr(t,e,n){n*=.5;var r=e[0],a=e[1],o=e[2],i=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=r*l+a*s,t[1]=a*l-r*s,t[2]=o*l+i*s,t[3]=i*l-o*s,t}function Nr(t,e){var n=e[0],r=e[1],a=e[2];return t[0]=n,t[1]=r,t[2]=a,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-a*a)),t}function zr(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=Math.sqrt(n*n+r*r+a*a),s=Math.exp(o),l=i>0?s*Math.sin(i)/i:0;return t[0]=n*l,t[1]=r*l,t[2]=a*l,t[3]=s*Math.cos(i),t}function Ir(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=Math.sqrt(n*n+r*r+a*a),s=i>0?Math.atan2(i,o)/i:0;return t[0]=n*s,t[1]=r*s,t[2]=a*s,t[3]=.5*Math.log(n*n+r*r+a*a+o*o),t}function jr(t,e,n){return Ir(t,e),sa(t,t,n),zr(t,t),t}function Gr(t,e,n,r){var a,o,i,s,l,c=e[0],u=e[1],d=e[2],h=e[3],p=n[0],m=n[1],v=n[2],_=n[3];return(o=c*p+u*m+d*v+h*_)<0&&(o=-o,p=-p,m=-m,v=-v,_=-_),1-o>f?(a=Math.acos(o),i=Math.sin(a),s=Math.sin((1-r)*a)/i,l=Math.sin(r*a)/i):(s=1-r,l=r),t[0]=s*c+l*p,t[1]=s*u+l*m,t[2]=s*d+l*v,t[3]=s*h+l*_,t}function Hr(t){var e=m(),n=m(),r=m(),a=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=a*Math.sin(2*Math.PI*n),t[1]=a*Math.cos(2*Math.PI*n),t[2]=o*Math.sin(2*Math.PI*r),t[3]=o*Math.cos(2*Math.PI*r),t}function Ur(t,e){var n=e[0],r=e[1],a=e[2],o=e[3],i=n*n+r*r+a*a+o*o,s=i?1/i:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-a*s,t[3]=o*s,t}function qr(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Wr(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[3*a+a]&&(a=2);var o=(a+1)%3,i=(a+2)%3;n=Math.sqrt(e[3*a+a]-e[3*o+o]-e[3*i+i]+1),t[a]=.5*n,n=.5/n,t[3]=(e[3*o+i]-e[3*i+o])*n,t[o]=(e[3*o+a]+e[3*a+o])*n,t[i]=(e[3*i+a]+e[3*a+i])*n}return t}function Yr(t,e,n,r){var a=.5*Math.PI/180;e*=a,n*=a,r*=a;var o=Math.sin(e),i=Math.cos(e),s=Math.sin(n),l=Math.cos(n),c=Math.sin(r),u=Math.cos(r);return t[0]=o*l*u-i*s*c,t[1]=i*s*u+o*l*c,t[2]=i*l*c-o*s*u,t[3]=i*l*u+o*s*c,t}function Xr(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Qr,Kr,Jr,Zr,$r,ta,ea=Hn,na=Un,ra=qn,aa=Wn,oa=Yn,ia=Br,sa=nr,la=dr,ca=fr,ua=ir,da=ua,ha=sr,fa=ha,pa=ur,ma=gr,va=Mr,_a=(Qr=We(),Kr=Qe(1,0,0),Jr=Qe(0,1,0),function(t,e,n){var r=vn(e,n);return r<-.999999?(_n(Qr,Kr,e),zn(Qr)<1e-6&&_n(Qr,Jr,e),mn(Qr,Qr),Tr(t,Qr,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(_n(Qr,e,n),t[0]=Qr[0],t[1]=Qr[1],t[2]=Qr[2],t[3]=1+r,pa(t,t))}),ba=(Zr=kr(),$r=kr(),function(t,e,n,r,a,o){return Gr(Zr,e,a,o),Gr($r,n,r,o),Gr(t,Zr,$r,2*o*(1-o)),t}),ga=(ta=_t(),function(t,e,n,r){return ta[0]=n[0],ta[3]=n[1],ta[6]=n[2],ta[1]=r[0],ta[4]=r[1],ta[7]=r[2],ta[2]=-e[0],ta[5]=-e[1],ta[8]=-e[2],pa(t,Wr(t,ta))});function Ma(){var t=new p(8);return p!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function ya(t){var e=new p(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function xa(t,e,n,r,a,o,i,s){var l=new p(8);return l[0]=t,l[1]=e,l[2]=n,l[3]=r,l[4]=a,l[5]=o,l[6]=i,l[7]=s,l}function wa(t,e,n,r,a,o,i){var s=new p(8);s[0]=t,s[1]=e,s[2]=n,s[3]=r;var l=.5*a,c=.5*o,u=.5*i;return s[4]=l*r+c*n-u*e,s[5]=c*r+u*t-l*n,s[6]=u*r+l*e-c*t,s[7]=-l*t-c*e-u*n,s}function Ea(t,e,n){var r=.5*n[0],a=.5*n[1],o=.5*n[2],i=e[0],s=e[1],l=e[2],c=e[3];return t[0]=i,t[1]=s,t[2]=l,t[3]=c,t[4]=r*c+a*l-o*s,t[5]=a*c+o*i-r*l,t[6]=o*c+r*s-a*i,t[7]=-r*i-a*s-o*l,t}function Sa(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t}function Aa(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Ca(t,e){var n=kr();xe(n,e);var r=new p(3);return Me(r,e),Ea(t,n,r),t}function Pa(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function ka(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Oa(t,e,n,r,a,o,i,s,l){return t[0]=e,t[1]=n,t[2]=r,t[3]=a,t[4]=o,t[5]=i,t[6]=s,t[7]=l,t}var Ta=ra;function Ra(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var Va=ra;function Ba(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function La(t,e){var n=e[4],r=e[5],a=e[6],o=e[7],i=-e[0],s=-e[1],l=-e[2],c=e[3];return t[0]=2*(n*c+o*i+r*l-a*s),t[1]=2*(r*c+o*s+a*i-n*l),t[2]=2*(a*c+o*l+n*s-r*i),t}function Da(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=.5*n[0],l=.5*n[1],c=.5*n[2],u=e[4],d=e[5],h=e[6],f=e[7];return t[0]=r,t[1]=a,t[2]=o,t[3]=i,t[4]=i*s+a*c-o*l+u,t[5]=i*l+o*s-r*c+d,t[6]=i*c+r*l-a*s+h,t[7]=-r*s-a*l-o*c+f,t}function Fa(t,e,n){var r=-e[0],a=-e[1],o=-e[2],i=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=s*i+u*r+l*o-c*a,h=l*i+u*a+c*r-s*o,f=c*i+u*o+s*a-l*r,p=u*i-s*r-l*a-c*o;return Lr(t,e,n),r=t[0],a=t[1],o=t[2],i=t[3],t[4]=d*i+p*r+h*o-f*a,t[5]=h*i+p*a+f*r-d*o,t[6]=f*i+p*o+d*a-h*r,t[7]=p*i-d*r-h*a-f*o,t}function Na(t,e,n){var r=-e[0],a=-e[1],o=-e[2],i=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=s*i+u*r+l*o-c*a,h=l*i+u*a+c*r-s*o,f=c*i+u*o+s*a-l*r,p=u*i-s*r-l*a-c*o;return Dr(t,e,n),r=t[0],a=t[1],o=t[2],i=t[3],t[4]=d*i+p*r+h*o-f*a,t[5]=h*i+p*a+f*r-d*o,t[6]=f*i+p*o+d*a-h*r,t[7]=p*i-d*r-h*a-f*o,t}function za(t,e,n){var r=-e[0],a=-e[1],o=-e[2],i=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=s*i+u*r+l*o-c*a,h=l*i+u*a+c*r-s*o,f=c*i+u*o+s*a-l*r,p=u*i-s*r-l*a-c*o;return Fr(t,e,n),r=t[0],a=t[1],o=t[2],i=t[3],t[4]=d*i+p*r+h*o-f*a,t[5]=h*i+p*a+f*r-d*o,t[6]=f*i+p*o+d*a-h*r,t[7]=p*i-d*r-h*a-f*o,t}function Ia(t,e,n){var r=n[0],a=n[1],o=n[2],i=n[3],s=e[0],l=e[1],c=e[2],u=e[3];return t[0]=s*i+u*r+l*o-c*a,t[1]=l*i+u*a+c*r-s*o,t[2]=c*i+u*o+s*a-l*r,t[3]=u*i-s*r-l*a-c*o,s=e[4],l=e[5],c=e[6],u=e[7],t[4]=s*i+u*r+l*o-c*a,t[5]=l*i+u*a+c*r-s*o,t[6]=c*i+u*o+s*a-l*r,t[7]=u*i-s*r-l*a-c*o,t}function ja(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=n[0],l=n[1],c=n[2],u=n[3];return t[0]=r*u+i*s+a*c-o*l,t[1]=a*u+i*l+o*s-r*c,t[2]=o*u+i*c+r*l-a*s,t[3]=i*u-r*s-a*l-o*c,s=n[4],l=n[5],c=n[6],u=n[7],t[4]=r*u+i*s+a*c-o*l,t[5]=a*u+i*l+o*s-r*c,t[6]=o*u+i*c+r*l-a*s,t[7]=i*u-r*s-a*l-o*c,t}function Ga(t,e,n,r){if(Math.abs(r)<f)return Pa(t,e);var a=Math.hypot(n[0],n[1],n[2]);r*=.5;var o=Math.sin(r),i=o*n[0]/a,s=o*n[1]/a,l=o*n[2]/a,c=Math.cos(r),u=e[0],d=e[1],h=e[2],p=e[3];t[0]=u*c+p*i+d*l-h*s,t[1]=d*c+p*s+h*i-u*l,t[2]=h*c+p*l+u*s-d*i,t[3]=p*c-u*i-d*s-h*l;var m=e[4],v=e[5],_=e[6],b=e[7];return t[4]=m*c+b*i+v*l-_*s,t[5]=v*c+b*s+_*i-m*l,t[6]=_*c+b*l+m*s-v*i,t[7]=b*c-m*i-v*s-_*l,t}function Ha(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t}function Ua(t,e,n){var r=e[0],a=e[1],o=e[2],i=e[3],s=n[4],l=n[5],c=n[6],u=n[7],d=e[4],h=e[5],f=e[6],p=e[7],m=n[0],v=n[1],_=n[2],b=n[3];return t[0]=r*b+i*m+a*_-o*v,t[1]=a*b+i*v+o*m-r*_,t[2]=o*b+i*_+r*v-a*m,t[3]=i*b-r*m-a*v-o*_,t[4]=r*u+i*s+a*c-o*l+d*b+p*m+h*_-f*v,t[5]=a*u+i*l+o*s-r*c+h*b+p*v+f*m-d*_,t[6]=o*u+i*c+r*l-a*s+f*b+p*_+d*v-h*m,t[7]=i*u-r*s-a*l-o*c+p*b-d*m-h*v-f*_,t}var qa=Ua;function Wa(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t}var Ya=la;function Xa(t,e,n,r){var a=1-r;return Ya(e,n)<0&&(r=-r),t[0]=e[0]*a+n[0]*r,t[1]=e[1]*a+n[1]*r,t[2]=e[2]*a+n[2]*r,t[3]=e[3]*a+n[3]*r,t[4]=e[4]*a+n[4]*r,t[5]=e[5]*a+n[5]*r,t[6]=e[6]*a+n[6]*r,t[7]=e[7]*a+n[7]*r,t}function Qa(t,e){var n=$a(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t}function Ka(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var Ja=ua,Za=Ja,$a=ha,to=$a;function eo(t,e){var n=$a(e);if(n>0){n=Math.sqrt(n);var r=e[0]/n,a=e[1]/n,o=e[2]/n,i=e[3]/n,s=e[4],l=e[5],c=e[6],u=e[7],d=r*s+a*l+o*c+i*u;t[0]=r,t[1]=a,t[2]=o,t[3]=i,t[4]=(s-r*d)/n,t[5]=(l-a*d)/n,t[6]=(c-o*d)/n,t[7]=(u-i*d)/n}return t}function no(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function ro(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function ao(t,e){var n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],s=t[5],l=t[6],c=t[7],u=e[0],d=e[1],h=e[2],p=e[3],m=e[4],v=e[5],_=e[6],b=e[7];return Math.abs(n-u)<=f*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-d)<=f*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(a-h)<=f*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(o-p)<=f*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(i-m)<=f*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(s-v)<=f*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(l-_)<=f*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-b)<=f*Math.max(1,Math.abs(c),Math.abs(b))}function oo(){var t=new p(2);return p!=Float32Array&&(t[0]=0,t[1]=0),t}function io(t){var e=new p(2);return e[0]=t[0],e[1]=t[1],e}function so(t,e){var n=new p(2);return n[0]=t,n[1]=e,n}function lo(t,e){return t[0]=e[0],t[1]=e[1],t}function co(t,e,n){return t[0]=e,t[1]=n,t}function uo(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function ho(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function fo(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function po(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function mo(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function vo(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function _o(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function bo(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function go(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Mo(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function yo(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t}function xo(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function wo(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function Eo(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function So(t){var e=t[0],n=t[1];return e*e+n*n}function Ao(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Co(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Po(t,e){var n=e[0],r=e[1],a=n*n+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t}function ko(t,e){return t[0]*e[0]+t[1]*e[1]}function Oo(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t}function To(t,e,n,r){var a=e[0],o=e[1];return t[0]=a+r*(n[0]-a),t[1]=o+r*(n[1]-o),t}function Ro(t,e){e=e||1;var n=2*m()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t}function Vo(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[2]*a,t[1]=n[1]*r+n[3]*a,t}function Bo(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[2]*a+n[4],t[1]=n[1]*r+n[3]*a+n[5],t}function Lo(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[3]*a+n[6],t[1]=n[1]*r+n[4]*a+n[7],t}function Do(t,e,n){var r=e[0],a=e[1];return t[0]=n[0]*r+n[4]*a+n[12],t[1]=n[1]*r+n[5]*a+n[13],t}function Fo(t,e,n,r){var a=e[0]-n[0],o=e[1]-n[1],i=Math.sin(r),s=Math.cos(r);return t[0]=a*s-o*i+n[0],t[1]=a*i+o*s+n[1],t}function No(t,e){var n=t[0],r=t[1],a=e[0],o=e[1],i=Math.sqrt(n*n+r*r)*Math.sqrt(a*a+o*o),s=i&&(n*a+r*o)/i;return Math.acos(Math.min(Math.max(s,-1),1))}function zo(t){return t[0]=0,t[1]=0,t}function Io(t){return"vec2("+t[0]+", "+t[1]+")"}function jo(t,e){return t[0]===e[0]&&t[1]===e[1]}function Go(t,e){var n=t[0],r=t[1],a=e[0],o=e[1];return Math.abs(n-a)<=f*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=f*Math.max(1,Math.abs(r),Math.abs(o))}var Ho=Eo,Uo=ho,qo=fo,Wo=po,Yo=xo,Xo=wo,Qo=So,Ko=function(){var t=oo();return function(e,n,r,a,o,i){var s,l;for(n||(n=2),r||(r=0),l=a?Math.min(a*n+r,e.length):e.length,s=r;s<l;s+=n)t[0]=e[s],t[1]=e[s+1],o(t,t,i),e[s]=t[0],e[s+1]=t[1];return e}}()},915:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.cube=e.torus=e.cone=e.sphere=void 0;const r=n(538);e.sphere=(t,e,n)=>{const r=[],a=[],o=[],i=[],s=[];for(let l=0;l<n;++l){const c=-Math.PI/2+Math.PI*(l/(n-1)),u=t*Math.sin(c);for(let d=0;d<=e;++d){const h=2*Math.PI*(d/e),f=t*Math.cos(c)*Math.cos(h),p=t*Math.cos(c)*Math.sin(h);r.push(f,u,p),a.push(f/t,u/t,p/t),o.push(1-d/e,l/(n-1));const m=2*Math.PI*((d+1)/e),v=t*Math.cos(c)*Math.cos(m),_=t*Math.cos(c)*Math.sin(m),b=Math.sqrt((v-f)*(v-f)+(_-p)*(_-p));i.push((v-f)/b,0,(_-p)/b),d!=e&&l!=n-1&&s.push(d+l*(e+1),d+(l+1)*(e+1),d+1+l*(e+1),d+1+l*(e+1),d+(l+1)*(e+1),d+1+(l+1)*(e+1))}}return{positions:r,normals:a,uvs:o,tangents:i,indices:s}},e.cone=(t,e)=>{const n=[],a=[],o=[],i=[],s=[];e=Math.floor(e);const l=2*Math.PI/e;for(let r=0;r<e;++r){const c=t*Math.cos(l*r),u=t*Math.sin(l*r);n.push(c,-.5,u),a.push(0,-1,0),o.push((c+1)/2,(u+1)/2),i.push(1,0,0),s.push((r+1)%e,e,r)}n.push(0,-.5,0),a.push(0,-1,0),o.push(.5,.5),i.push(1,0,0);const c=Math.sin(Math.PI/2-Math.atan2(1,t)),u=e+1;for(let d=0;d<=e;++d){const h=Math.cos(l*d),f=Math.sin(l*d),p=t*h,m=t*f,v=t*Math.cos(l*(d+1)),_=t*Math.sin(l*(d+1));n.push(p,-.5,m),n.push(0,.5,0);const b=r.vec3.fromValues(h,c,f);r.vec3.normalize(b,b),a.push(...b),a.push(0,1,0);const g=r.vec3.fromValues(v-p,0,_-m);r.vec3.normalize(g,g),i.push(...g),i.push(...g),o.push(d/e,1),o.push(.5,.5),d!=e&&s.push(2*d+u,2*d+1+u,2*d+2+u)}return{positions:n,normals:a,uvs:o,tangents:i,indices:s}},e.torus=(t,e,n,a)=>{const o=[],i=[],s=[],l=[],c=[],u=2*Math.PI/n;for(let d=0;d<=n;++d){const h=t*Math.cos(u*d),f=t*Math.sin(u*d),p=t*Math.cos((d+1)*u),m=t*Math.sin((d+1)*u),v=r.vec3.fromValues(h,0,f),_=r.vec3.fromValues(p-h,0,m-f);r.vec3.normalize(_,_);const b=r.vec3.fromValues(0,1,0),g=r.vec3.create();r.vec3.cross(g,_,b);for(let t=0;t<=a;++t){const u=2*Math.PI/a,h=r.vec3.create(),f=r.vec3.create(),p=e*Math.sin(t*u),m=e*Math.cos(t*u);r.vec3.scale(h,g,p),r.vec3.scale(f,b,m);const M=r.vec3.clone(h);r.vec3.add(M,M,f);const y=r.vec3.clone(v);if(r.vec3.add(y,y,M),o.push(...y),r.vec3.normalize(M,M),i.push(...M),s.push(d/n,t/a),l.push(..._),0!=d&&0!=t){const e=d*(a+1)+t;c.push(e-1,e-a-1,e,e-a-2,e-a-1,e-1)}}}return{positions:o,normals:i,uvs:s,tangents:l,indices:c}},e.cube=()=>{const t=[-1,-1,1,0,0,1,1,-1,1,0,0,1,1,1,1,0,0,1,-1,1,1,0,0,1,-1,-1,-1,0,0,-1,-1,1,-1,0,0,-1,1,1,-1,0,0,-1,1,-1,-1,0,0,-1,-1,1,-1,0,1,0,-1,1,1,0,1,0,1,1,1,0,1,0,1,1,-1,0,1,0,-1,-1,-1,0,-1,0,1,-1,-1,0,-1,0,1,-1,1,0,-1,0,-1,-1,1,0,-1,0,1,-1,-1,1,0,0,1,1,-1,1,0,0,1,1,1,1,0,0,1,-1,1,1,0,0,-1,-1,-1,-1,0,0,-1,-1,1,-1,0,0,-1,1,1,-1,0,0,-1,1,-1,-1,0,0],e=[],n=[];for(let r=0;r<t.length;r+=6)e.push(...t.slice(r,r+3)),n.push(...t.slice(r+3,r+6));return{positions:e,normals:n,indices:[0,1,2,0,2,3,4,5,6,4,6,7,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}}},887:function(t,e,n){var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),a=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&r(e,t,n);return a(e,t),e},i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(a,o){function i(t){try{l(r.next(t))}catch(t){o(t)}}function s(t){try{l(r.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,s)}l((r=r.apply(t,e||[])).next())}))},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.run=void 0;const l=n(915),c=n(969),u=s(n(10)),d=o(n(376)),h=n(538);function f(t){const e={entries:new Map,structSize:0};let n=0,r=0;for(let a of t){const t=a[0],o=a[1],i=a[2];n=Math.max(n,o),r%o!=0&&(r=Math.ceil(r/o)*o),null!=i&&e.entries.set(i,r),r+=t}return e.structSize=Math.ceil(r/n)*n,e}e.run=function(){return i(this,void 0,void 0,(function*(){const t=new d.GUI;if(!("gpu"in navigator))return;const{device:e,canvas:n,context:r,presentationSize:a,presentationFormat:o}=yield function(t,e){return i(this,void 0,void 0,(function*(){const t=document.getElementById("canvas-wegbpu"),e=t.getContext("webgpu"),n=yield navigator.gpu.requestAdapter(),r=yield n.requestDevice(),a=[1*t.clientWidth,1*t.clientHeight];t.width=a[0],t.height=a[1];const o=navigator.gpu.getPreferredCanvasFormat();return console.log(o),null==e||e.configure({device:r,format:o,alphaMode:"opaque"}),{device:r,canvas:t,context:e,presentationSize:a,presentationFormat:o}}))}(),s=e.createShaderModule({label:"shader module",code:u.default});let p=e.createTexture({size:a,format:o,usage:GPUTextureUsage.RENDER_ATTACHMENT,sampleCount:4}),m=e.createTexture({label:"depth buffer",size:a,format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT,sampleCount:4});const v=e.createRenderPipeline({layout:"auto",label:"background pipeline",vertex:{module:s,entryPoint:"mainVSBackground"},multisample:{count:4},fragment:{module:s,entryPoint:"mainFSBackground",targets:[{format:o}]},primitive:{topology:"triangle-strip"}}),_=e.createBindGroupLayout({label:"render bind group layout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:3,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:4,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:5,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,texture:{sampleType:"depth"}},{binding:6,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,sampler:{type:"comparison"}}]}),b=e.createBindGroupLayout({label:"render bind group for shaow casting",entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:4,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]}),g={label:"render pipeline",layout:e.createPipelineLayout({label:"boid render pipeline layout",bindGroupLayouts:[_]}),vertex:{module:s,entryPoint:"mainVS",buffers:[{arrayStride:8*Float32Array.BYTES_PER_ELEMENT,stepMode:"instance",attributes:[{shaderLocation:0,offset:0,format:"float32x4"},{shaderLocation:1,offset:4*Float32Array.BYTES_PER_ELEMENT,format:"float32x4"}]},{arrayStride:3*Float32Array.BYTES_PER_ELEMENT,stepMode:"vertex",attributes:[{shaderLocation:2,format:"float32x3",offset:0}]},{arrayStride:3*Float32Array.BYTES_PER_ELEMENT,stepMode:"vertex",attributes:[{shaderLocation:3,format:"float32x3",offset:0}]}]},multisample:{count:4},fragment:{module:s,entryPoint:"mainFS",targets:[{format:o}]},primitive:{topology:"triangle-list",cullMode:"back"},depthStencil:{format:"depth24plus-stencil8",depthWriteEnabled:!0,depthCompare:"less",stencilFront:{compare:"always",depthFailOp:"keep",failOp:"keep",passOp:"replace"},stencilReadMask:255,stencilWriteMask:255}},M=e.createRenderPipeline(g);g.vertex.entryPoint="mainVSOutline",g.fragment.entryPoint="mainFSOutline",g.depthStencil={format:"depth24plus-stencil8",depthWriteEnabled:!0,depthCompare:"always",stencilFront:{compare:"not-equal",depthFailOp:"keep",failOp:"keep",passOp:"keep"},stencilReadMask:255,stencilWriteMask:0};const y=e.createRenderPipeline(g);g.vertex.entryPoint="mainVSShadow",g.fragment=void 0,g.label="boids render pipeline shadow",g.multisample=void 0,g.depthStencil={depthWriteEnabled:!0,depthCompare:"less",format:"depth32float"},g.layout=e.createPipelineLayout({bindGroupLayouts:[b]});const x=e.createRenderPipeline(g),w={label:"render pipeline box",layout:e.createPipelineLayout({label:"box pipeline layout",bindGroupLayouts:[_]}),vertex:{module:s,entryPoint:"mainVSBox",buffers:[{arrayStride:3*Float32Array.BYTES_PER_ELEMENT,stepMode:"vertex",attributes:[{shaderLocation:0,format:"float32x3",offset:0}]},{arrayStride:3*Float32Array.BYTES_PER_ELEMENT,stepMode:"vertex",attributes:[{shaderLocation:1,format:"float32x3",offset:0}]}]},multisample:{count:4},fragment:{module:s,entryPoint:"mainFSBox",targets:[{format:o,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"dst-alpha"}}}]},primitive:{topology:"triangle-list",cullMode:"front"},depthStencil:{format:"depth24plus-stencil8",depthWriteEnabled:!1,depthCompare:"less"}},E=e.createRenderPipeline(w);w.primitive.cullMode="back";const S=e.createRenderPipeline(w),A=e.createComputePipeline({layout:"auto",label:"compute pipeline",compute:{module:s,entryPoint:"mainCS"}}),{positions:C,normals:P,indices:k}=(0,l.cone)(.4,20),O=e.createBuffer({label:"cone vertex pos buffer",size:C.length*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0});new Float32Array(O.getMappedRange()).set(C),O.unmap();const T=e.createBuffer({label:"cone vertex normal buffer",size:P.length*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0});new Float32Array(T.getMappedRange()).set(P),T.unmap();const R=e.createBuffer({label:"cone index buffer",size:k.length*Uint32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.INDEX,mappedAtCreation:!0});new Uint32Array(R.getMappedRange()).set(k),R.unmap();const{positions:V,normals:B,indices:L}=(0,l.cube)(),D=e.createBuffer({label:"cone vertex pos buffer",size:V.length*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0});new Float32Array(D.getMappedRange()).set(V),D.unmap();const F=e.createBuffer({label:"cone vertex normal buffer",size:B.length*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0});new Float32Array(F.getMappedRange()).set(B),F.unmap();const N=e.createBuffer({label:"cone index buffer",size:L.length*Uint32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.INDEX,mappedAtCreation:!0});new Uint32Array(N.getMappedRange()).set(L),N.unmap();const z={deltaT:4.375,cohesionDistance:2,separationDistance:1.2,alignmentDistance:1.15,cohesionScale:.28,separationScale:.28,alignmentScale:.98,boxWidth:20,boxHeight:12,showOutline:!1,freeCamera:!1,meta:{deltaT:{min:0,max:10},cohesionDistance:{min:0,max:3},separationDistance:{min:0,max:3},alignmentDistance:{min:0,max:3},cohesionScale:{min:0,max:2},separationScale:{min:0,max:2},alignmentScale:{min:0,max:2},boxWidth:{max:20,min:8},boxHeight:{max:14,min:4},freeCamera:{toolTip:"Once selected click on the viewport to control the camera with WASD + mouse. Esc to exit"}}};Object.keys(z).forEach((e=>{var n,r,a,o;if("meta"!==e){const i=t.add(z,e,null===(n=z.meta[e])||void 0===n?void 0:n.min,null===(r=z.meta[e])||void 0===r?void 0:r.max);i.onChange(j),i.domElement.parentElement.setAttribute("title",null!==(o=null===(a=z.meta[e])||void 0===a?void 0:a.toolTip)&&void 0!==o?o:"")}}));const I=e.createBuffer({label:"simulation params buffer",size:36,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});function j(){e.queue.writeBuffer(I,Float32Array.BYTES_PER_ELEMENT,new Float32Array([z.cohesionDistance,z.separationDistance,z.alignmentDistance,z.cohesionScale,z.separationScale,z.alignmentScale,z.boxWidth,z.boxHeight]))}j();const G=h.vec4.fromValues(z.boxWidth/2,1.5*z.boxHeight,z.boxWidth/1.5,0),H=h.vec4.create();h.vec4.negate(H,G),h.vec4.normalize(H,H);const U=h.mat4.create();{const t=h.mat4.create();h.mat4.lookAt(t,G,h.vec3.fromValues(0,0,0),h.vec3.fromValues(0,1,0));const e=h.mat4.create();h.mat4.orthoZO(e,-1.75*z.boxWidth,1.75*z.boxWidth,-1.75*z.boxWidth,1.75*z.boxWidth,0,5*z.boxHeight),h.mat4.mul(U,e,t)}const q={viewProjection:U,position:G,direction:H,color:h.vec4.fromValues(.8,.8,.8,1),ambientIntensity:.5},W=e.createBuffer({label:"light data buffer",size:f([[64,16],[16,16],[16,16],[16,16],[4,4]]).structSize,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Float32Array(W.getMappedRange()).set([...q.viewProjection,...q.position,...q.direction,...q.color,q.ambientIntensity]),W.unmap();const Y=550,X=new Float32Array(4400);for(let t=0;t<Y;++t)X[8*t+0]=z.boxWidth*(2*Math.random()-1),X[8*t+1]=z.boxHeight*(2*Math.random()-1),X[8*t+2]=z.boxWidth*(2*Math.random()-1),X[8*t+3]=0,X[8*t+4]=2*Math.random()-1,X[8*t+5]=2*Math.random()-1,X[8*t+6]=2*Math.random()-1,X[8*t+7]=0;const Q=new Array(2),K=new Array(2);for(let t=0;t<2;++t)Q[t]=e.createBuffer({label:`particle buffer ${t}`,size:X.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE,mappedAtCreation:!0}),new Float32Array(Q[t].getMappedRange()).set(X),Q[t].unmap();const J=e.createBuffer({label:"cameraBuffer",size:f([[64,16],[16,16],[6,8],[4,4]]).structSize,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,mappedAtCreation:!1}),{shadowMapTextureView:Z,shadowMapSampler:$}=yield function(t,e){return i(this,void 0,void 0,(function*(){return{shadowMapTextureView:t.createTexture({label:"shadow map texture",format:"depth32float",size:[1024,1024,1],usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}).createView(),shadowMapSampler:t.createSampler({label:"shadow map sampler",compare:"less",magFilter:"linear",minFilter:"linear"})}}))}(e),tt=e.createBindGroup({label:"render bind group",layout:_,entries:[{binding:0,resource:{buffer:I}},{binding:3,resource:{buffer:J}},{binding:4,resource:{buffer:W}},{binding:5,resource:Z},{binding:6,resource:$}]}),et=e.createBindGroup({label:"render bind group shadow",layout:b,entries:[{binding:0,resource:{buffer:I}},{binding:4,resource:{buffer:W}}]}),nt=e.createBindGroup({label:"render bind ground bg",layout:v.getBindGroupLayout(0),entries:[{binding:3,resource:{buffer:J}}]});for(let t=0;t<2;++t)K[t]=e.createBindGroup({label:`particle bind group ${t}`,layout:A.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:I}},{binding:1,resource:{buffer:Q[t]}},{binding:2,resource:{buffer:Q[(t+1)%2]}}]});const rt=new c.FreeControlledCamera(n,2*Math.PI/5,a[0]/a[1]);rt.moveSpeed=5;const at=new c.TurnTableCamera(2*Math.PI/5,a[0]/a[1]);at.activate(),at.rotationPivot=h.vec3.fromValues(0,1.25*z.boxHeight,0),at.rotatationRadius=2*Math.max(z.boxWidth,z.boxHeight),at.rotationSpeed=.25;let ot=at,it=0,st=0,lt=n.clientWidth,ct=n.clientHeight;requestAnimationFrame((function t(a){const i=Math.min(a-st,66)/1e3;if(st=a,e.queue.writeBuffer(I,0,new Float32Array([i*z.deltaT])),lt!==n.clientWidth||ct!=n.clientHeight){const t=1,r=[n.clientWidth*t,n.clientHeight*t];n.width=r[0],n.height=r[1],p.destroy(),p=e.createTexture({size:r,format:o,usage:GPUTextureUsage.RENDER_ATTACHMENT,sampleCount:4}),m.destroy(),m=e.createTexture({size:r,format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT,sampleCount:4}),lt=n.clientWidth,ct=n.clientHeight,at.aspectRatio=r[0]/r[1],rt.aspectRatio=r[0]/r[1]}at.lookAt=h.vec3.fromValues(0,-z.boxHeight/1.5,0),z.freeCamera?(ot!==rt&&rt.copyTransform(at),ot.deactivate(),ot=rt,ot.activate()):(ot.deactivate(),ot=at,ot.activate()),e.queue.writeBuffer(J,0,new Float32Array([...ot.updateAndGetViewProjectionMatrix(i),...ot.position,0,...ot.rotation,ot.fovY]));const s=e.createCommandEncoder();{const t=s.beginComputePass();t.setPipeline(A),t.setBindGroup(0,K[it%2]),t.dispatchWorkgroups(Math.ceil(8.59375)),t.end()}{const t=s.beginRenderPass({colorAttachments:[],depthStencilAttachment:{view:Z,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});t.setPipeline(x),t.setVertexBuffer(0,Q[(it+1)%2]),t.setVertexBuffer(1,O),t.setVertexBuffer(2,T),t.setIndexBuffer(R,"uint32"),t.setBindGroup(0,et),t.drawIndexed(k.length,Y),t.end()}{const t=s.beginRenderPass({colorAttachments:[{loadOp:"clear",clearValue:[0,0,0,1],storeOp:"store",view:p.createView(),resolveTarget:r.getCurrentTexture().createView()}]});t.setPipeline(v),t.setBindGroup(0,nt),t.draw(4),t.end()}{const t=s.beginRenderPass({colorAttachments:[{loadOp:"load",storeOp:"store",view:p.createView(),resolveTarget:r.getCurrentTexture().createView()}],depthStencilAttachment:{view:m.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store",stencilClearValue:0,stencilStoreOp:"store",stencilLoadOp:"clear"}});t.setPipeline(M),t.setVertexBuffer(0,Q[(it+1)%2]),t.setVertexBuffer(1,O),t.setVertexBuffer(2,T),t.setIndexBuffer(R,"uint32"),t.setBindGroup(0,tt),t.setStencilReference(1),t.drawIndexed(k.length,Y),t.end()}if(z.showOutline){const t=s.beginRenderPass({colorAttachments:[{loadOp:"load",clearValue:[0,0,0,1],storeOp:"store",view:p.createView(),resolveTarget:r.getCurrentTexture().createView()}],depthStencilAttachment:{view:m.createView(),depthClearValue:1,depthLoadOp:"load",depthStoreOp:"store",stencilClearValue:0,stencilStoreOp:"store",stencilLoadOp:"load"}});t.setPipeline(y),t.setVertexBuffer(0,Q[(it+1)%2]),t.setVertexBuffer(1,O),t.setVertexBuffer(2,T),t.setIndexBuffer(R,"uint32"),t.setBindGroup(0,tt),t.setStencilReference(1),t.drawIndexed(k.length,Y),t.end()}{const t=s.beginRenderPass({colorAttachments:[{loadOp:"load",clearValue:[0,0,0,1],storeOp:"store",view:p.createView(),resolveTarget:r.getCurrentTexture().createView()}],depthStencilAttachment:{view:m.createView(),depthClearValue:1,depthLoadOp:"load",depthStoreOp:"store",stencilClearValue:0,stencilStoreOp:"store",stencilLoadOp:"clear"}});t.setPipeline(E),t.setBindGroup(0,tt),t.setVertexBuffer(0,D),t.setVertexBuffer(1,F),t.setIndexBuffer(N,"uint32"),t.drawIndexed(L.length,1),t.setPipeline(S),t.drawIndexed(L.length,1),t.end()}e.queue.submit([s.finish()]),++it,requestAnimationFrame(t)}))}))}},969:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TurnTableCamera=e.FreeControlledCamera=e.Camera=void 0;const r=n(538);class a{constructor(t,e,n=.1,a=1e3){this.position=[0,0,0],this.rotationDeg=[0,0,0],this.rotationQuat=r.quat.create(),this.projectionMatrix=r.mat4.create(),this.fovY=t,this.near=n,this.far=a,r.mat4.perspectiveZO(this.projectionMatrix,t,e,n,a)}set aspectRatio(t){r.mat4.perspectiveZO(this.projectionMatrix,this.fovY,t,this.near,this.far)}activate(){}deactivate(){}get rotation(){return[...this.rotationDeg]}set rotation(t){this.rotationDeg=[...t],r.quat.fromEuler(this.rotationQuat,...t)}copyTransform(t){this.rotation=t.rotation,this.position=r.vec3.clone(t.position)}getUpRightMatrix(){const t=r.mat3.create();return r.mat3.fromQuat(t,this.rotationQuat),t}getViewMatrix(){const t=r.mat4.create();r.mat4.fromQuat(t,this.rotationQuat),r.mat4.transpose(t,t);const e=r.vec3.create();return r.vec3.negate(e,this.position),r.mat4.translate(t,t,e),t}getViewProjectionMatrix(){const t=r.mat4.create();return r.mat4.mul(t,this.projectionMatrix,this.getViewMatrix()),t}}e.Camera=a,e.FreeControlledCamera=class extends a{constructor(t,e,n,r=.1,a=1e3){super(e,n,r,a),this.moveSpeed=.1,this.rotationSpeed=.1,this.rotateOnlyIfFocussed=!0,this.state={forward:0,right:0},this.hasFocus=!1,this.canvas=t,this.lockMouseOnClickHandle=this.lockMouseOnClick.bind(this),t.setAttribute("tabindex","0");const o=t=>{if(t.repeat)return;const e="keydown"===t.type?1:-1;"w"===t.key&&e*this.state.forward>=0&&(this.state.forward-=e*this.moveSpeed),"s"===t.key&&e*this.state.forward<=0&&(this.state.forward+=e*this.moveSpeed),"d"===t.key&&e*this.state.right<=0&&(this.state.right+=e*this.moveSpeed),"a"===t.key&&e*this.state.right>=0&&(this.state.right-=e*this.moveSpeed)};t.addEventListener("keyup",o,!0),t.addEventListener("keydown",o,!0),t.addEventListener("mousemove",(t=>{if(this.hasFocus||!this.rotateOnlyIfFocussed){const e=this.rotation;e[1]-=t.movementX*this.rotationSpeed,e[0]-=t.movementY*this.rotationSpeed,this.rotation=e}}),!1),document.addEventListener("pointerlockchange",(()=>{this.hasFocus=document.pointerLockElement===t}))}lockMouseOnClick(){this.canvas.requestPointerLock()}activate(){this.canvas.addEventListener("click",this.lockMouseOnClickHandle)}deactivate(){this.canvas.removeEventListener("click",this.lockMouseOnClickHandle)}updateAndGetViewMatrix(t){const e=this.getUpRightMatrix(),n=[e[6],e[7],e[8]],a=[e[0],e[1],e[2]];return r.vec3.scale(n,n,this.state.forward*t),r.vec3.scale(a,a,this.state.right*t),r.vec3.add(a,a,n),r.vec3.add(this.position,this.position,a),this.getViewMatrix()}updateAndGetViewProjectionMatrix(t){return this.updateAndGetViewMatrix(t),this.getViewProjectionMatrix()}},e.TurnTableCamera=class extends a{constructor(t,e,n=.1,a=1e3){super(t,e,n,a),this.rotationPivot=r.vec3.fromValues(0,10,0),this.rotationSpeed=.01,this.rotatationRadius=30,this.lookAt=r.vec3.fromValues(0,0,0),this.angleRad=0}updateAndGetViewMatrix(t){this.angleRad+=this.rotationSpeed*t,this.position[0]=this.rotatationRadius*Math.sin(this.angleRad),this.position[2]=this.rotatationRadius*Math.cos(this.angleRad),this.position[1]=this.rotationPivot[1];const e=this.rotation;e[1]=180*this.angleRad/Math.PI;const n=r.vec3.create();r.vec3.sub(n,this.lookAt,this.position),r.vec3.normalize(n,n);const a=r.vec3.fromValues(0,1,0),o=r.vec3.create();r.vec3.cross(o,n,a);const i=r.vec3.create();r.vec3.cross(i,o,n),r.vec3.normalize(i,i);const s=-Math.acos(r.vec3.dot(i,a));return e[0]=180*s/Math.PI,this.rotation=e,this.getViewMatrix()}updateAndGetViewProjectionMatrix(t){return this.updateAndGetViewMatrix(t),this.getViewProjectionMatrix()}}},10:(t,e,n)=>{n.r(e),n.d(e,{default:()=>r});const r='struct Particle {\r\n    pos: vec4<f32>,  // 0\r\n    vel: vec4<f32>,  // 16\r\n                     // 32\r\n};\r\n\r\nstruct SimParams {\r\n    deltaT: f32,            // 0 \r\n    rule1Distance: f32,     // 4\r\n    rule2Distance: f32,     // 8\r\n    rule3Distance: f32,     // 12\r\n    rule1Scale: f32,        // 16\r\n    rule2Scale: f32,        // 20\r\n    rule3Scale: f32,        // 24\r\n    boxWidth: f32,          // 28\r\n    boxHeight: f32,         // 32\r\n                            // 36\r\n};\r\n\r\nstruct Particles {\r\n    particles: array<Particle>,\r\n};\r\n\r\nstruct CameraData {\r\n    viewProjectionMatrix: mat4x4<f32>, // 0\r\n    position: vec4<f32>,               // 64\r\n    rotation: vec3<f32>,               // 80\r\n    fovYRad: f32,                      // 92\r\n                                       // 96\r\n};\r\n\r\nstruct LightData {\r\n    viewProjectionMatrix: mat4x4<f32>, // 0\r\n    position: vec4<f32>,               // 64\r\n    direction: vec4<f32>,              // 80\r\n    color: vec4<f32>,                  // 96\r\n    ambientIntensity: f32,             // 112\r\n                                       // 116\r\n};\r\n\r\nstruct Material {\r\n    color: vec4<f32>,        // 0\r\n    shininess: f32,          // 16\r\n    specularIntensity: f32,  // 20\r\n};\r\n\r\n// from https://www.shadertoy.com/view/4djSRW\r\nfn hash13(input: vec3<f32>) -> f32 {\r\n\tvar p3  = fract(input * .1031);\r\n    p3 += dot(p3, p3.zyx + 31.32);\r\n    return fract((p3.x + p3.y) * p3.z);\r\n}\r\n\r\nfn computeLight(light: LightData, material: Material, cameraPosition: vec3<f32>, position: vec3<f32>, normal: vec3<f32>, visibility: f32, shadowAttenuation: f32) -> vec4<f32> {\r\n    let shadow = mix(shadowAttenuation, 1.0, visibility);\r\n    let N: vec3<f32> = normalize(normal.xyz);\r\n    let L: vec3<f32> = normalize(-light.direction.xyz);\r\n    let V: vec3<f32> = normalize(cameraPosition.xyz - position.xyz);\r\n    let H: vec3<f32> = normalize(L + V);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    let kD: f32 = shadow * NdotL + light.ambientIntensity;\r\n    var kSEnabled = 0.0;\r\n\r\n    let R = reflect(-L, N);\r\n    if (NdotL > 0.0 && dot(V, N) > 0.0) {\r\n        kSEnabled = 1.0;\r\n    }\r\n    var alpha = material.color.a;\r\n    let kS: f32 = shadow * kSEnabled * material.specularIntensity * pow(max(dot(H, N), 0.0), material.shininess);\r\n    alpha = mix(alpha, 1.0, kS);\r\n    let finalColor = material.color.rgb * light.color.rgb * kD + light.color.rgb * kS;\r\n    let noise = hash13(position);\r\n\r\n    // also add some noise/dither to avoid banding artifacts \r\n    return vec4<f32>(finalColor, alpha) + mix(-0.5/255.0, 0.5/255.0, noise);\r\n};\r\n\r\n@group(0)\r\n@binding(0)\r\nvar<uniform> params: SimParams;\r\n\r\n@group(0)\r\n@binding(1)\r\nvar<storage, read> particlesA: Particles;\r\n\r\n@group(0)\r\n@binding(2)\r\nvar<storage, read_write> particlesB: Particles;\r\n\r\n@group(0)\r\n@binding(3)\r\nvar<uniform> cameraData: CameraData;\r\n\r\n@group(0)\r\n@binding(4)\r\nvar<uniform> lightData: LightData;\r\n\r\n@group(0)\r\n@binding(5) \r\nvar shadowMap: texture_depth_2d;\r\n\r\n@group(0) \r\n@binding(6) \r\nvar shadowSampler: sampler_comparison;\r\n\r\n@compute\r\n@workgroup_size(64)\r\nfn mainCS(@builtin(global_invocation_id) globalInvocationID: vec3<u32>) {\r\n    let index: u32 = globalInvocationID.x;\r\n\r\n    if (index >= arrayLength(&particlesA.particles)) {\r\n        return;\r\n    }\r\n\r\n    // normalX, normalY, normalZ, distance from origin\r\n    let planes = array<vec4<f32>, 6>(\r\n        vec4<f32>( 1.0,  0.0,  0.0, -params.boxWidth), // left\r\n        vec4<f32>(-1.0,  0.0,  0.0, -params.boxWidth), // right\r\n        vec4<f32>( 0.0, -1.0,  0.0, -params.boxHeight), // top\r\n        vec4<f32>( 0.0,  1.0,  0.0, -params.boxHeight), // bottom\r\n        vec4<f32>( 0.0,  0.0, -1.0, -params.boxWidth), // front\r\n        vec4<f32>( 0.0,  0.0,  1.0, -params.boxWidth), // back\r\n    );\r\n\r\n    var vPos: vec3<f32> = particlesA.particles[index].pos.xyz;\r\n    var vVel: vec3<f32> = particlesA.particles[index].vel.xyz;\r\n\r\n    var cMass = vec3<f32>(0.0, 0.0, 0.0);\r\n    var cVel = vec3<f32>(0.0, 0.0, 0.0);\r\n    var colVel = vec3<f32>(0.0, 0.0, 0.0);\r\n    var cMassCount: u32 = 0u;\r\n    var cVelCount: u32 = 0u;\r\n    var pos: vec3<f32>;\r\n    var vel: vec3<f32>;\r\n\r\n    for (var i: u32 = 0u; i < arrayLength(&particlesA.particles); i = i + 1u) {\r\n\r\n        if (i == index) {\r\n            continue;\r\n        }\r\n\r\n        pos = particlesA.particles[i].pos.xyz;\r\n        vel = particlesA.particles[i].vel.xyz;\r\n\r\n        // rule 1: cohesion, steer towards center of mass of\r\n        // local flockmates\r\n        if (distance(pos, vPos) < params.rule1Distance) {\r\n            cMass = cMass + pos;\r\n            cMassCount = cMassCount + 1u;\r\n        }\r\n\r\n        // rule2: separation, steer to avoid crowding local flockmates\r\n        if (distance(pos, vPos) < params.rule2Distance) {\r\n            // additional push intensity to avoid compenetration\r\n            let additionalIntensity = mix(4.0, 1.0, distance(pos, vPos) / params.rule2Distance);\r\n            // push away this boid based on the position \r\n            // of the neighbours.\r\n            colVel = colVel + additionalIntensity * (vPos - pos);\r\n        }\r\n\r\n        // rule3: alignment, steer towards the average heading of local flockmates\r\n        if (distance(pos, vPos) < params.rule3Distance) {\r\n            cVel = cVel + vel;\r\n            cVelCount = cVelCount + 1u;\r\n        }\r\n    }\r\n\r\n    if (cMassCount > 0u) {\r\n        let temp = f32(cMassCount);\r\n        // this will be added to the particle\'s vel.\r\n        // steers the particle towards the center of mass\r\n        cMass = (cMass / vec3<f32>(temp, temp, temp)) - vPos;\r\n    }\r\n    if (cVelCount > 0u) {\r\n        let temp = f32(cVelCount);\r\n        cVel = cVel / vec3<f32>(temp, temp, temp);\r\n    }\r\n\r\n    vVel = vVel + params.deltaT * ((cMass * params.rule1Scale) + (colVel * params.rule2Scale) +\r\n        (cVel * params.rule3Scale));\r\n    \r\n    // fishy "random"\r\n    //let offset = 0.1 * vec3<f32>(cos(vPos.x * 5.0 + f32(index) / 10.), sin(vPos.y * 5.0 + f32(index) / 10.), cos(vPos.z * 5.0 + f32(index) / 10.));\r\n    //vVel = vVel + offset * 0.1;\r\n    \r\n    var d = normalize(vVel);\r\n\r\n    for (var j: u32 = 0u; j < 6u; j = j + 1u) {\r\n        let n = planes[j].xyz;\r\n        let o = planes[j].w;\r\n        let dist = abs(dot(vPos, n) - o);\r\n        \r\n        let maxDist = 6.0;\r\n        let minDist = 1.0;\r\n\r\n        if (dist < maxDist) {\r\n            var intensity = 1.0 - (dist - minDist) / (maxDist - minDist);\r\n            intensity = pow(clamp(intensity, 0.0, 1.0), 0.5);\r\n            var directionIntensity = 1.4;\r\n            if (dot(vVel, n) > 0.0) { // reduce repulsion intensity if the boid is going in the direction of the plane normal\r\n                directionIntensity = directionIntensity / 2.5;\r\n            }\r\n            if (dist < minDist) {\r\n                // boids are too close to the plane, increase repulsion intensity\r\n                directionIntensity = directionIntensity * 10.0 * (minDist - dist) / minDist;\r\n            }\r\n\r\n            d = normalize(d + params.deltaT * directionIntensity * intensity * n);\r\n            \r\n            if (dist <= 0.1) {\r\n                d = n; // make sure boids do not go outside the box\r\n            }\r\n        }\r\n    }\r\n\r\n    // clamp velocity\r\n    vVel = d * clamp(length(vVel), 0.3, 1.0);\r\n\r\n    // move the particle\r\n    vPos = vPos + (vVel * params.deltaT);\r\n    vPos = clamp(vPos, vec3<f32>(-params.boxWidth, -params.boxHeight, -params.boxWidth), vec3<f32>(params.boxWidth, params.boxHeight, params.boxWidth));\r\n\r\n    // write new calculated data\r\n    particlesB.particles[index].pos = vec4<f32>(vPos, 0.0);\r\n    particlesB.particles[index].vel = vec4<f32>(vVel, 0.0);\r\n}\r\n\r\nstruct VSOutBoids {\r\n    @builtin(position)\r\n    pos: vec4<f32>,\r\n\r\n    @location(0)\r\n    wsPos: vec4<f32>,\r\n\r\n    @location(1)\r\n    wsNormal: vec4<f32>,\r\n\r\n    @location(2)\r\n    col: vec4<f32>,\r\n\r\n    // xy texel position, z: depth from light\r\n    @location(3)\r\n    shadowMapCoords: vec3<f32>,\r\n};\r\n\r\nfn getBoidWorldMatrix(position: vec3<f32>, velocity: vec3<f32>) -> mat4x4<f32> {\r\n    // y points towards velocity\r\n    let up = normalize(velocity);\r\n    let right = normalize(cross(up, vec3<f32>(0.0, 0.0, 1.0)));\r\n    let forward = normalize(cross(right, up));\r\n\r\n    let worldMatrix = mat4x4<f32>(\r\n        vec4<f32>(right, 0.0),\r\n        vec4<f32>(up, 0.0),\r\n        vec4<f32>(forward, 0.0),\r\n        vec4<f32>(position, 1.0)\r\n    );\r\n\r\n    return worldMatrix;\r\n}\r\n\r\nfn getVisibility(shadowMapCoords: vec3<f32>) -> f32 {\r\n    let pcfResolution = 1;\r\n\r\n    var visibility: f32 = 0.0;\r\n    let offset = 1.0 / vec2<f32>(textureDimensions(shadowMap));\r\n    for (var i = -pcfResolution; i <= pcfResolution; i = i + 1) {\r\n        for (var j = -pcfResolution; j <= pcfResolution; j = j + 1) {\r\n            visibility = visibility + textureSampleCompare(\r\n                shadowMap,\r\n                shadowSampler,\r\n                shadowMapCoords.xy + vec2<f32>(f32(i), f32(j)) * offset, shadowMapCoords.z - 0.007\r\n            );\r\n        }\r\n    }\r\n\r\n    if (all(shadowMapCoords.xy <= vec2<f32>(1.0, 1.0)) && all(shadowMapCoords.xy >= vec2<f32>(0.0, 0.0))) {\r\n        visibility = visibility / f32((pcfResolution + pcfResolution + 1) * (pcfResolution + pcfResolution + 1));\r\n    } else {\r\n        visibility = 1.0;\r\n    }\r\n\r\n    return visibility;\r\n}\r\n\r\n@vertex\r\nfn mainVS(@location(0) a_particlePos : vec3<f32>,\r\n             @location(1) a_particleVel : vec3<f32>,\r\n             @location(2) a_pos : vec3<f32>,\r\n             @location(3) a_norm: vec3<f32>) -> VSOutBoids {\r\n\r\n    let worldMatrix = getBoidWorldMatrix(a_particlePos, a_particleVel);\r\n\r\n    var output: VSOutBoids;\r\n    let wsPosition = worldMatrix * vec4<f32>(a_pos, 1.0);\r\n    let wsNormal = worldMatrix * vec4<f32>(a_norm, 0.0); // this is ok since there is no scale\r\n\r\n    var shadowProjection = lightData.viewProjectionMatrix * wsPosition;\r\n    shadowProjection = shadowProjection / shadowProjection.w;\r\n\r\n    output.shadowMapCoords = vec3<f32>(shadowProjection.xy * vec2<f32>(0.5, -0.5) + vec2<f32>(0.5, 0.5), shadowProjection.z);\r\n\r\n    output.pos = cameraData.viewProjectionMatrix * wsPosition;\r\n    output.wsPos = wsPosition;\r\n    output.wsNormal = wsNormal;\r\n    output.col = vec4<f32>((a_particleVel + 1.0) / 2.0, 1.0);\r\n    return output;\r\n}\r\n\r\n@vertex\r\nfn mainVSShadow(@location(0) a_particlePos : vec3<f32>,\r\n             @location(1) a_particleVel : vec3<f32>,\r\n             @location(2) a_pos : vec3<f32>,\r\n             @location(3) a_norm: vec3<f32>) -> @builtin(position) vec4<f32> {\r\n    \r\n    // y points towards velocity\r\n    let up = normalize(a_particleVel);\r\n    let right = normalize(cross(up, vec3<f32>(0.0, 0.0, 1.0)));\r\n    let forward = normalize(cross(right, up));\r\n\r\n    let worldMatrix = getBoidWorldMatrix(a_particlePos, a_particleVel);\r\n\r\n    let wsPosition = worldMatrix * vec4<f32>(a_pos, 1.0);\r\n\r\n    return lightData.viewProjectionMatrix * wsPosition;\r\n}\r\n\r\n@fragment\r\nfn mainFS(in: VSOutBoids) -> @location(0) vec4<f32> {\r\n    var material: Material;\r\n    material.color = in.col;\r\n    material.shininess = 12.0;\r\n    material.specularIntensity = 0.3;\r\n    return computeLight(lightData, material, cameraData.position.xyz, in.wsPos.xyz, in.wsNormal.xyz, getVisibility(in.shadowMapCoords), 0.0);\r\n}\r\n\r\n@vertex\r\nfn mainVSOutline(@location(0) a_particlePos : vec3<f32>,\r\n             @location(1) a_particleVel : vec3<f32>,\r\n             @location(2) a_pos : vec3<f32>,\r\n             @location(3) a_norm: vec3<f32>) -> @builtin(position) vec4<f32> {\r\n  \r\n  // y points towards velocity\r\n  let up = normalize(a_particleVel);\r\n  let right = normalize(cross(up, vec3<f32>(0.0, 0.0, 1.0)));\r\n  let forward = normalize(cross(right, up));\r\n\r\n  let worldMatrix = mat4x4<f32>(\r\n      vec4<f32>(right, 0.0),\r\n      vec4<f32>(up, 0.0),\r\n      vec4<f32>(forward, 0.0),\r\n      vec4<f32>(a_particlePos, 1.0)\r\n  );\r\n\r\n  // tweak scale on the y axis to make the cone outline\r\n  // look better\r\n  var sy: f32 = 1.35;\r\n  if (a_pos.y > 0.0)\r\n  {\r\n      sy = 2.0;\r\n  }\r\n\r\n  let scale = mat4x4<f32>(\r\n      vec4<f32>(1.5, 0.0, 0.0, 0.0),\r\n      vec4<f32>(0.0, sy, 0.0, 0.0),\r\n      vec4<f32>(0.0, 0.0, 1.5, 0.0),\r\n      vec4<f32>(0.0, 0.0, 0.0, 1.0)\r\n  );\r\n\r\n  return cameraData.viewProjectionMatrix * worldMatrix * scale * vec4<f32>(a_pos, 1.0);\r\n}\r\n\r\n@fragment\r\nfn mainFSOutline() -> @location(0) vec4<f32> {\r\n    return vec4<f32>(0.68, 0.85, 0.9, 1.0);\r\n}\r\n\r\nstruct BoxData {\r\n    @builtin(position)\r\n    position: vec4<f32>,\r\n\r\n    @location(0)\r\n    wsPos: vec4<f32>,\r\n\r\n    @location(1)\r\n    wsNormal: vec3<f32>,\r\n\r\n    // xy texel position, z: depth from light\r\n    @location(3)\r\n    shadowMapCoords: vec3<f32>,\r\n};\r\n\r\n@vertex\r\nfn mainVSBox(@location(0) a_pos : vec3<f32>,\r\n             @location(1) a_norm: vec3<f32>) -> BoxData {\r\n    let scale = mat4x4<f32>(\r\n        params.boxWidth, 0.0,            0.0,            0.0,\r\n        0.0,            params.boxHeight, 0.0,            0.0,\r\n        0.0,            0.0,            params.boxWidth, 0.0,\r\n        0.0,            0.0,            0.0,            1.0\r\n    );\r\n \r\n    var out: BoxData;\r\n    out.wsPos = scale * vec4<f32>(a_pos, 1.0);\r\n    var shadowProjection = lightData.viewProjectionMatrix * out.wsPos;\r\n\r\n    out.shadowMapCoords = vec3<f32>(shadowProjection.xy * vec2<f32>(0.5, -0.5) + vec2<f32>(0.5, 0.5), shadowProjection.z);\r\n    out.position = cameraData.viewProjectionMatrix * out.wsPos;\r\n    out.wsNormal = a_norm;\r\n    return out;\r\n}\r\n\r\n@fragment\r\nfn mainFSBox(in: BoxData, @builtin(front_facing) frontFacing: bool) -> @location(0) vec4<f32> {\r\n    var material: Material;\r\n    material.color = vec4<f32>(.8, .8, .8, 0.1);\r\n    material.specularIntensity = 1.;\r\n    var wsNormal = in.wsNormal;\r\n\r\n    var shadowAttenuation = 0.5;\r\n    // use a different color for the cube base\r\n    if (in.wsNormal.y < -0.5) {\r\n        material.color = vec4<f32>(0.15, 0.15, 0.15, 1.0);\r\n        material.specularIntensity = 0.1;\r\n\r\n        if (frontFacing) {\r\n            shadowAttenuation = 1.0; // hide shadow when looking at the base from below\r\n        }\r\n        else {\r\n            wsNormal = -wsNormal;\r\n        }\r\n    }\r\n    else {\r\n        // make sure the normal always points towards the light source\r\n        if (dot(-lightData.direction.xyz, in.wsNormal) < 0.0) {\r\n            wsNormal = -wsNormal;\r\n        }\r\n    }\r\n\r\n    material.shininess = 10.0;\r\n    return computeLight(lightData, material, cameraData.position.xyz, in.wsPos.xyz, wsNormal, getVisibility(in.shadowMapCoords), shadowAttenuation);\r\n}\r\n\r\nstruct BackgroundData {\r\n    @builtin(position)\r\n    position: vec4<f32>,\r\n\r\n    @location(0)\r\n    color: vec4<f32>,\r\n};\r\n\r\n@vertex\r\nfn mainVSBackground(@builtin(vertex_index) vertexIndex: u32) -> BackgroundData {\r\n    var screenQuad = array<vec2<f32>, 4>(\r\n            vec2<f32>(-1.0, -1.0),\r\n            vec2<f32>(1.0, -1.0),\r\n            vec2<f32>(-1.0, 1.0),\r\n            vec2<f32>(1.0, 1.0));\r\n\r\n    var out: BackgroundData;\r\n    out.position = vec4<f32>(screenQuad[vertexIndex], 0.0, 1.0);\r\n\r\n    let fovYDeg = cameraData.fovYRad * 180.0 / 3.14; \r\n    let orbitPitchBlend = sin((cameraData.rotation.x + (out.position.y * fovYDeg/2.0)) * 3.14 / 180.0) * 0.5 + 0.5;\r\n    out.color = mix(vec4<f32>(0.08, 0.1, 0.54, 1.0), vec4<f32>(0.16, 0.24, 0.74, 1.0) * 3.5, orbitPitchBlend);\r\n    return out;\r\n}\r\n\r\n@fragment\r\nfn mainFSBackground(in: BackgroundData) -> @location(0) vec4<f32> {\r\n    return in.color;\r\n}'}},e={};function n(r){var a=e[r];if(void 0!==a)return a.exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,n),o.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{const t=n(887);navigator.gpu?(0,t.run)():document.getElementById("webgpu-available").innerText="Looks like webgpu is not available :("})()})();
//# sourceMappingURL=main.bundle.js.map