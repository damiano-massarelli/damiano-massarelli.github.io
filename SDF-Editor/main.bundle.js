(()=>{"use strict";var e={887:(e,t,n)=>{n.r(t),n.d(t,{glMatrix:()=>r,mat2:()=>a,mat2d:()=>i,mat3:()=>s,mat4:()=>o,quat:()=>l,quat2:()=>f,vec2:()=>h,vec3:()=>c,vec4:()=>u});var r={};n.r(r),n.d(r,{ARRAY_TYPE:()=>v,EPSILON:()=>d,RANDOM:()=>m,equals:()=>b,setMatrixArrayType:()=>M,toRadian:()=>g});var a={};n.r(a),n.d(a,{LDU:()=>D,add:()=>R,adjoint:()=>I,clone:()=>x,copy:()=>S,create:()=>y,determinant:()=>V,equals:()=>G,exactEquals:()=>j,frob:()=>_,fromRotation:()=>C,fromScaling:()=>U,fromValues:()=>w,identity:()=>P,invert:()=>z,mul:()=>k,multiply:()=>B,multiplyScalar:()=>q,multiplyScalarAndAdd:()=>Y,rotate:()=>L,scale:()=>T,set:()=>E,str:()=>O,sub:()=>N,subtract:()=>F,transpose:()=>A});var i={};n.r(i),n.d(i,{add:()=>ue,clone:()=>$,copy:()=>K,create:()=>X,determinant:()=>J,equals:()=>ve,exactEquals:()=>de,frob:()=>ce,fromRotation:()=>ae,fromScaling:()=>ie,fromTranslation:()=>se,fromValues:()=>Q,identity:()=>H,invert:()=>W,mul:()=>me,multiply:()=>ee,multiplyScalar:()=>fe,multiplyScalarAndAdd:()=>he,rotate:()=>te,scale:()=>ne,set:()=>Z,str:()=>oe,sub:()=>Me,subtract:()=>le,translate:()=>re});var s={};n.r(s),n.d(s,{add:()=>Ge,adjoint:()=>Ae,clone:()=>be,copy:()=>ye,create:()=>pe,determinant:()=>ze,equals:()=>Xe,exactEquals:()=>Ne,frob:()=>je,fromMat2d:()=>Oe,fromMat4:()=>ge,fromQuat:()=>_e,fromRotation:()=>Ce,fromScaling:()=>Ue,fromTranslation:()=>Te,fromValues:()=>xe,identity:()=>Pe,invert:()=>Ee,mul:()=>$e,multiply:()=>Ie,multiplyScalar:()=>Ye,multiplyScalarAndAdd:()=>ke,normalFromMat4:()=>De,projection:()=>Re,rotate:()=>Be,scale:()=>Le,set:()=>Se,str:()=>Fe,sub:()=>Ke,subtract:()=>qe,translate:()=>Ve,transpose:()=>we});var o={};n.r(o),n.d(o,{add:()=>Rt,adjoint:()=>rt,clone:()=>Qe,copy:()=>Ze,create:()=>He,determinant:()=>at,equals:()=>Yt,exactEquals:()=>qt,frob:()=>Dt,fromQuat:()=>Et,fromQuat2:()=>bt,fromRotation:()=>vt,fromRotationTranslation:()=>gt,fromRotationTranslationScale:()=>Pt,fromRotationTranslationScaleOrigin:()=>wt,fromScaling:()=>dt,fromTranslation:()=>ht,fromValues:()=>We,fromXRotation:()=>mt,fromYRotation:()=>Mt,fromZRotation:()=>pt,frustum:()=>At,getRotation:()=>St,getScaling:()=>xt,getTranslation:()=>yt,identity:()=>et,invert:()=>nt,lookAt:()=>Ut,mul:()=>kt,multiply:()=>it,multiplyScalar:()=>jt,multiplyScalarAndAdd:()=>Gt,ortho:()=>Tt,orthoNO:()=>Lt,orthoZO:()=>Ct,perspective:()=>It,perspectiveFromFieldOfView:()=>Bt,perspectiveNO:()=>zt,perspectiveZO:()=>Vt,rotate:()=>ct,rotateX:()=>ut,rotateY:()=>lt,rotateZ:()=>ft,scale:()=>ot,set:()=>Je,str:()=>_t,sub:()=>Nt,subtract:()=>Ft,targetTo:()=>Ot,translate:()=>st,transpose:()=>tt});var c={};n.r(c),n.d(c,{add:()=>Wt,angle:()=>In,bezier:()=>yn,ceil:()=>nn,clone:()=>$t,copy:()=>Qt,create:()=>Xt,cross:()=>pn,dist:()=>Dn,distance:()=>ln,div:()=>_n,divide:()=>tn,dot:()=>Mn,equals:()=>Tn,exactEquals:()=>Ln,floor:()=>rn,forEach:()=>Gn,fromValues:()=>Ht,hermite:()=>bn,inverse:()=>vn,len:()=>Fn,length:()=>Kt,lerp:()=>gn,max:()=>sn,min:()=>an,mul:()=>On,multiply:()=>en,negate:()=>dn,normalize:()=>mn,random:()=>xn,rotateX:()=>En,rotateY:()=>An,rotateZ:()=>zn,round:()=>on,scale:()=>cn,scaleAndAdd:()=>un,set:()=>Zt,sqrDist:()=>Rn,sqrLen:()=>jn,squaredDistance:()=>fn,squaredLength:()=>hn,str:()=>Bn,sub:()=>Un,subtract:()=>Jt,transformMat3:()=>Pn,transformMat4:()=>Sn,transformQuat:()=>wn,zero:()=>Vn});var u={};n.r(u),n.d(u,{add:()=>$n,ceil:()=>Zn,clone:()=>Yn,copy:()=>Nn,create:()=>qn,cross:()=>hr,dist:()=>wr,distance:()=>ar,div:()=>Pr,divide:()=>Qn,dot:()=>fr,equals:()=>yr,exactEquals:()=>br,floor:()=>Wn,forEach:()=>Ir,fromValues:()=>kn,inverse:()=>ur,len:()=>Ar,length:()=>sr,lerp:()=>dr,max:()=>er,min:()=>Jn,mul:()=>Sr,multiply:()=>Hn,negate:()=>cr,normalize:()=>lr,random:()=>vr,round:()=>tr,scale:()=>nr,scaleAndAdd:()=>rr,set:()=>Xn,sqrDist:()=>Er,sqrLen:()=>zr,squaredDistance:()=>ir,squaredLength:()=>or,str:()=>gr,sub:()=>xr,subtract:()=>Kn,transformMat4:()=>mr,transformQuat:()=>Mr,zero:()=>pr});var l={};n.r(l),n.d(l,{add:()=>ia,calculateW:()=>Rr,clone:()=>ta,conjugate:()=>Nr,copy:()=>ra,create:()=>Vr,dot:()=>ca,equals:()=>Ma,exactEquals:()=>ma,exp:()=>Fr,fromEuler:()=>$r,fromMat3:()=>Xr,fromValues:()=>na,getAngle:()=>Cr,getAxisAngle:()=>Tr,identity:()=>Br,invert:()=>kr,len:()=>fa,length:()=>la,lerp:()=>ua,ln:()=>jr,mul:()=>sa,multiply:()=>Ur,normalize:()=>va,pow:()=>Gr,random:()=>Yr,rotateX:()=>Or,rotateY:()=>_r,rotateZ:()=>Dr,rotationTo:()=>pa,scale:()=>oa,set:()=>aa,setAxes:()=>ba,setAxisAngle:()=>Lr,slerp:()=>qr,sqlerp:()=>ga,sqrLen:()=>da,squaredLength:()=>ha,str:()=>Kr});var f={};n.r(f),n.d(f,{add:()=>Ya,clone:()=>xa,conjugate:()=>Qa,copy:()=>Ia,create:()=>ya,dot:()=>$a,equals:()=>ai,exactEquals:()=>ri,fromMat4:()=>za,fromRotation:()=>Aa,fromRotationTranslation:()=>wa,fromRotationTranslationValues:()=>Pa,fromTranslation:()=>Ea,fromValues:()=>Sa,getDual:()=>Ta,getReal:()=>La,getTranslation:()=>Oa,identity:()=>Va,invert:()=>Ha,len:()=>Wa,length:()=>Za,lerp:()=>Ka,mul:()=>Na,multiply:()=>ka,normalize:()=>ti,rotateAroundAxis:()=>qa,rotateByQuatAppend:()=>ja,rotateByQuatPrepend:()=>Ga,rotateX:()=>Da,rotateY:()=>Ra,rotateZ:()=>Fa,scale:()=>Xa,set:()=>Ba,setDual:()=>Ua,setReal:()=>Ca,sqrLen:()=>ei,squaredLength:()=>Ja,str:()=>ni,translate:()=>_a});var h={};n.r(h),n.d(h,{add:()=>li,angle:()=>Di,ceil:()=>vi,clone:()=>si,copy:()=>ci,create:()=>ii,cross:()=>Vi,dist:()=>Xi,distance:()=>xi,div:()=>Ni,divide:()=>di,dot:()=>Ii,equals:()=>Gi,exactEquals:()=>ji,floor:()=>mi,forEach:()=>Hi,fromValues:()=>oi,inverse:()=>Ai,len:()=>qi,length:()=>Pi,lerp:()=>Bi,max:()=>pi,min:()=>Mi,mul:()=>ki,multiply:()=>hi,negate:()=>Ei,normalize:()=>zi,random:()=>Li,rotate:()=>_i,round:()=>gi,scale:()=>bi,scaleAndAdd:()=>yi,set:()=>ui,sqrDist:()=>$i,sqrLen:()=>Ki,squaredDistance:()=>Si,squaredLength:()=>wi,str:()=>Fi,sub:()=>Yi,subtract:()=>fi,transformMat2:()=>Ti,transformMat2d:()=>Ci,transformMat3:()=>Ui,transformMat4:()=>Oi,zero:()=>Ri});var d=1e-6,v="undefined"!=typeof Float32Array?Float32Array:Array,m=Math.random;function M(e){v=e}var p=Math.PI/180;function g(e){return e*p}function b(e,t){return Math.abs(e-t)<=d*Math.max(1,Math.abs(e),Math.abs(t))}function y(){var e=new v(4);return v!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function x(e){var t=new v(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function S(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function P(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function w(e,t,n,r){var a=new v(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=r,a}function E(e,t,n,r,a){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e}function A(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function z(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],s=n*i-a*r;return s?(s=1/s,e[0]=i*s,e[1]=-r*s,e[2]=-a*s,e[3]=n*s,e):null}function I(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e}function V(e){return e[0]*e[3]-e[2]*e[1]}function B(e,t,n){var r=t[0],a=t[1],i=t[2],s=t[3],o=n[0],c=n[1],u=n[2],l=n[3];return e[0]=r*o+i*c,e[1]=a*o+s*c,e[2]=r*u+i*l,e[3]=a*u+s*l,e}function L(e,t,n){var r=t[0],a=t[1],i=t[2],s=t[3],o=Math.sin(n),c=Math.cos(n);return e[0]=r*c+i*o,e[1]=a*c+s*o,e[2]=r*-o+i*c,e[3]=a*-o+s*c,e}function T(e,t,n){var r=t[0],a=t[1],i=t[2],s=t[3],o=n[0],c=n[1];return e[0]=r*o,e[1]=a*o,e[2]=i*c,e[3]=s*c,e}function C(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e}function U(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function O(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function _(e){return Math.hypot(e[0],e[1],e[2],e[3])}function D(e,t,n,r){return e[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-e[2]*n[1],[e,t,n]}function R(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function F(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function j(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function G(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],s=t[0],o=t[1],c=t[2],u=t[3];return Math.abs(n-s)<=d*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-o)<=d*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(a-c)<=d*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(i-u)<=d*Math.max(1,Math.abs(i),Math.abs(u))}function q(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function Y(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var k=B,N=F;function X(){var e=new v(6);return v!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e}function $(e){var t=new v(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function K(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function H(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function Q(e,t,n,r,a,i){var s=new v(6);return s[0]=e,s[1]=t,s[2]=n,s[3]=r,s[4]=a,s[5]=i,s}function Z(e,t,n,r,a,i,s){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=i,e[5]=s,e}function W(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],s=t[4],o=t[5],c=n*i-r*a;return c?(c=1/c,e[0]=i*c,e[1]=-r*c,e[2]=-a*c,e[3]=n*c,e[4]=(a*o-i*s)*c,e[5]=(r*s-n*o)*c,e):null}function J(e){return e[0]*e[3]-e[1]*e[2]}function ee(e,t,n){var r=t[0],a=t[1],i=t[2],s=t[3],o=t[4],c=t[5],u=n[0],l=n[1],f=n[2],h=n[3],d=n[4],v=n[5];return e[0]=r*u+i*l,e[1]=a*u+s*l,e[2]=r*f+i*h,e[3]=a*f+s*h,e[4]=r*d+i*v+o,e[5]=a*d+s*v+c,e}function te(e,t,n){var r=t[0],a=t[1],i=t[2],s=t[3],o=t[4],c=t[5],u=Math.sin(n),l=Math.cos(n);return e[0]=r*l+i*u,e[1]=a*l+s*u,e[2]=r*-u+i*l,e[3]=a*-u+s*l,e[4]=o,e[5]=c,e}function ne(e,t,n){var r=t[0],a=t[1],i=t[2],s=t[3],o=t[4],c=t[5],u=n[0],l=n[1];return e[0]=r*u,e[1]=a*u,e[2]=i*l,e[3]=s*l,e[4]=o,e[5]=c,e}function re(e,t,n){var r=t[0],a=t[1],i=t[2],s=t[3],o=t[4],c=t[5],u=n[0],l=n[1];return e[0]=r,e[1]=a,e[2]=i,e[3]=s,e[4]=r*u+i*l+o,e[5]=a*u+s*l+c,e}function ae(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e[4]=0,e[5]=0,e}function ie(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function se(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function oe(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function ce(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function ue(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e}function le(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}function fe(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e}function he(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e}function de(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function ve(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],s=e[4],o=e[5],c=t[0],u=t[1],l=t[2],f=t[3],h=t[4],v=t[5];return Math.abs(n-c)<=d*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-u)<=d*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(a-l)<=d*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(i-f)<=d*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(s-h)<=d*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(o-v)<=d*Math.max(1,Math.abs(o),Math.abs(v))}var me=ee,Me=le;function pe(){var e=new v(9);return v!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function ge(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function be(e){var t=new v(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function ye(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function xe(e,t,n,r,a,i,s,o,c){var u=new v(9);return u[0]=e,u[1]=t,u[2]=n,u[3]=r,u[4]=a,u[5]=i,u[6]=s,u[7]=o,u[8]=c,u}function Se(e,t,n,r,a,i,s,o,c,u){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=i,e[5]=s,e[6]=o,e[7]=c,e[8]=u,e}function Pe(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function we(e,t){if(e===t){var n=t[1],r=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function Ee(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],s=t[4],o=t[5],c=t[6],u=t[7],l=t[8],f=l*s-o*u,h=-l*i+o*c,d=u*i-s*c,v=n*f+r*h+a*d;return v?(v=1/v,e[0]=f*v,e[1]=(-l*r+a*u)*v,e[2]=(o*r-a*s)*v,e[3]=h*v,e[4]=(l*n-a*c)*v,e[5]=(-o*n+a*i)*v,e[6]=d*v,e[7]=(-u*n+r*c)*v,e[8]=(s*n-r*i)*v,e):null}function Ae(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],s=t[4],o=t[5],c=t[6],u=t[7],l=t[8];return e[0]=s*l-o*u,e[1]=a*u-r*l,e[2]=r*o-a*s,e[3]=o*c-i*l,e[4]=n*l-a*c,e[5]=a*i-n*o,e[6]=i*u-s*c,e[7]=r*c-n*u,e[8]=n*s-r*i,e}function ze(e){var t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],s=e[5],o=e[6],c=e[7],u=e[8];return t*(u*i-s*c)+n*(-u*a+s*o)+r*(c*a-i*o)}function Ie(e,t,n){var r=t[0],a=t[1],i=t[2],s=t[3],o=t[4],c=t[5],u=t[6],l=t[7],f=t[8],h=n[0],d=n[1],v=n[2],m=n[3],M=n[4],p=n[5],g=n[6],b=n[7],y=n[8];return e[0]=h*r+d*s+v*u,e[1]=h*a+d*o+v*l,e[2]=h*i+d*c+v*f,e[3]=m*r+M*s+p*u,e[4]=m*a+M*o+p*l,e[5]=m*i+M*c+p*f,e[6]=g*r+b*s+y*u,e[7]=g*a+b*o+y*l,e[8]=g*i+b*c+y*f,e}function Ve(e,t,n){var r=t[0],a=t[1],i=t[2],s=t[3],o=t[4],c=t[5],u=t[6],l=t[7],f=t[8],h=n[0],d=n[1];return e[0]=r,e[1]=a,e[2]=i,e[3]=s,e[4]=o,e[5]=c,e[6]=h*r+d*s+u,e[7]=h*a+d*o+l,e[8]=h*i+d*c+f,e}function Be(e,t,n){var r=t[0],a=t[1],i=t[2],s=t[3],o=t[4],c=t[5],u=t[6],l=t[7],f=t[8],h=Math.sin(n),d=Math.cos(n);return e[0]=d*r+h*s,e[1]=d*a+h*o,e[2]=d*i+h*c,e[3]=d*s-h*r,e[4]=d*o-h*a,e[5]=d*c-h*i,e[6]=u,e[7]=l,e[8]=f,e}function Le(e,t,n){var r=n[0],a=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Te(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function Ce(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Ue(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Oe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function _e(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],s=n+n,o=r+r,c=a+a,u=n*s,l=r*s,f=r*o,h=a*s,d=a*o,v=a*c,m=i*s,M=i*o,p=i*c;return e[0]=1-f-v,e[3]=l-p,e[6]=h+M,e[1]=l+p,e[4]=1-u-v,e[7]=d-m,e[2]=h-M,e[5]=d+m,e[8]=1-u-f,e}function De(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],s=t[4],o=t[5],c=t[6],u=t[7],l=t[8],f=t[9],h=t[10],d=t[11],v=t[12],m=t[13],M=t[14],p=t[15],g=n*o-r*s,b=n*c-a*s,y=n*u-i*s,x=r*c-a*o,S=r*u-i*o,P=a*u-i*c,w=l*m-f*v,E=l*M-h*v,A=l*p-d*v,z=f*M-h*m,I=f*p-d*m,V=h*p-d*M,B=g*V-b*I+y*z+x*A-S*E+P*w;return B?(B=1/B,e[0]=(o*V-c*I+u*z)*B,e[1]=(c*A-s*V-u*E)*B,e[2]=(s*I-o*A+u*w)*B,e[3]=(a*I-r*V-i*z)*B,e[4]=(n*V-a*A+i*E)*B,e[5]=(r*A-n*I-i*w)*B,e[6]=(m*P-M*S+p*x)*B,e[7]=(M*y-v*P-p*b)*B,e[8]=(v*S-m*y+p*g)*B,e):null}function Re(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function Fe(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function je(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function Ge(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e}function qe(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}function Ye(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e}function ke(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e}function Ne(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function Xe(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],s=e[4],o=e[5],c=e[6],u=e[7],l=e[8],f=t[0],h=t[1],v=t[2],m=t[3],M=t[4],p=t[5],g=t[6],b=t[7],y=t[8];return Math.abs(n-f)<=d*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-h)<=d*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(a-v)<=d*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(i-m)<=d*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(s-M)<=d*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(o-p)<=d*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(c-g)<=d*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(u-b)<=d*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(l-y)<=d*Math.max(1,Math.abs(l),Math.abs(y))}var $e=Ie,Ke=qe;function He(){var e=new v(16);return v!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Qe(e){var t=new v(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ze(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function We(e,t,n,r,a,i,s,o,c,u,l,f,h,d,m,M){var p=new v(16);return p[0]=e,p[1]=t,p[2]=n,p[3]=r,p[4]=a,p[5]=i,p[6]=s,p[7]=o,p[8]=c,p[9]=u,p[10]=l,p[11]=f,p[12]=h,p[13]=d,p[14]=m,p[15]=M,p}function Je(e,t,n,r,a,i,s,o,c,u,l,f,h,d,v,m,M){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=i,e[5]=s,e[6]=o,e[7]=c,e[8]=u,e[9]=l,e[10]=f,e[11]=h,e[12]=d,e[13]=v,e[14]=m,e[15]=M,e}function et(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function tt(e,t){if(e===t){var n=t[1],r=t[2],a=t[3],i=t[6],s=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=i,e[11]=t[14],e[12]=a,e[13]=s,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function nt(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],s=t[4],o=t[5],c=t[6],u=t[7],l=t[8],f=t[9],h=t[10],d=t[11],v=t[12],m=t[13],M=t[14],p=t[15],g=n*o-r*s,b=n*c-a*s,y=n*u-i*s,x=r*c-a*o,S=r*u-i*o,P=a*u-i*c,w=l*m-f*v,E=l*M-h*v,A=l*p-d*v,z=f*M-h*m,I=f*p-d*m,V=h*p-d*M,B=g*V-b*I+y*z+x*A-S*E+P*w;return B?(B=1/B,e[0]=(o*V-c*I+u*z)*B,e[1]=(a*I-r*V-i*z)*B,e[2]=(m*P-M*S+p*x)*B,e[3]=(h*S-f*P-d*x)*B,e[4]=(c*A-s*V-u*E)*B,e[5]=(n*V-a*A+i*E)*B,e[6]=(M*y-v*P-p*b)*B,e[7]=(l*P-h*y+d*b)*B,e[8]=(s*I-o*A+u*w)*B,e[9]=(r*A-n*I-i*w)*B,e[10]=(v*S-m*y+p*g)*B,e[11]=(f*y-l*S-d*g)*B,e[12]=(o*E-s*z-c*w)*B,e[13]=(n*z-r*E+a*w)*B,e[14]=(m*b-v*x-M*g)*B,e[15]=(l*x-f*b+h*g)*B,e):null}function rt(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],s=t[4],o=t[5],c=t[6],u=t[7],l=t[8],f=t[9],h=t[10],d=t[11],v=t[12],m=t[13],M=t[14],p=t[15];return e[0]=o*(h*p-d*M)-f*(c*p-u*M)+m*(c*d-u*h),e[1]=-(r*(h*p-d*M)-f*(a*p-i*M)+m*(a*d-i*h)),e[2]=r*(c*p-u*M)-o*(a*p-i*M)+m*(a*u-i*c),e[3]=-(r*(c*d-u*h)-o*(a*d-i*h)+f*(a*u-i*c)),e[4]=-(s*(h*p-d*M)-l*(c*p-u*M)+v*(c*d-u*h)),e[5]=n*(h*p-d*M)-l*(a*p-i*M)+v*(a*d-i*h),e[6]=-(n*(c*p-u*M)-s*(a*p-i*M)+v*(a*u-i*c)),e[7]=n*(c*d-u*h)-s*(a*d-i*h)+l*(a*u-i*c),e[8]=s*(f*p-d*m)-l*(o*p-u*m)+v*(o*d-u*f),e[9]=-(n*(f*p-d*m)-l*(r*p-i*m)+v*(r*d-i*f)),e[10]=n*(o*p-u*m)-s*(r*p-i*m)+v*(r*u-i*o),e[11]=-(n*(o*d-u*f)-s*(r*d-i*f)+l*(r*u-i*o)),e[12]=-(s*(f*M-h*m)-l*(o*M-c*m)+v*(o*h-c*f)),e[13]=n*(f*M-h*m)-l*(r*M-a*m)+v*(r*h-a*f),e[14]=-(n*(o*M-c*m)-s*(r*M-a*m)+v*(r*c-a*o)),e[15]=n*(o*h-c*f)-s*(r*h-a*f)+l*(r*c-a*o),e}function at(e){var t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],s=e[5],o=e[6],c=e[7],u=e[8],l=e[9],f=e[10],h=e[11],d=e[12],v=e[13],m=e[14],M=e[15];return(t*s-n*i)*(f*M-h*m)-(t*o-r*i)*(l*M-h*v)+(t*c-a*i)*(l*m-f*v)+(n*o-r*s)*(u*M-h*d)-(n*c-a*s)*(u*m-f*d)+(r*c-a*o)*(u*v-l*d)}function it(e,t,n){var r=t[0],a=t[1],i=t[2],s=t[3],o=t[4],c=t[5],u=t[6],l=t[7],f=t[8],h=t[9],d=t[10],v=t[11],m=t[12],M=t[13],p=t[14],g=t[15],b=n[0],y=n[1],x=n[2],S=n[3];return e[0]=b*r+y*o+x*f+S*m,e[1]=b*a+y*c+x*h+S*M,e[2]=b*i+y*u+x*d+S*p,e[3]=b*s+y*l+x*v+S*g,b=n[4],y=n[5],x=n[6],S=n[7],e[4]=b*r+y*o+x*f+S*m,e[5]=b*a+y*c+x*h+S*M,e[6]=b*i+y*u+x*d+S*p,e[7]=b*s+y*l+x*v+S*g,b=n[8],y=n[9],x=n[10],S=n[11],e[8]=b*r+y*o+x*f+S*m,e[9]=b*a+y*c+x*h+S*M,e[10]=b*i+y*u+x*d+S*p,e[11]=b*s+y*l+x*v+S*g,b=n[12],y=n[13],x=n[14],S=n[15],e[12]=b*r+y*o+x*f+S*m,e[13]=b*a+y*c+x*h+S*M,e[14]=b*i+y*u+x*d+S*p,e[15]=b*s+y*l+x*v+S*g,e}function st(e,t,n){var r,a,i,s,o,c,u,l,f,h,d,v,m=n[0],M=n[1],p=n[2];return t===e?(e[12]=t[0]*m+t[4]*M+t[8]*p+t[12],e[13]=t[1]*m+t[5]*M+t[9]*p+t[13],e[14]=t[2]*m+t[6]*M+t[10]*p+t[14],e[15]=t[3]*m+t[7]*M+t[11]*p+t[15]):(r=t[0],a=t[1],i=t[2],s=t[3],o=t[4],c=t[5],u=t[6],l=t[7],f=t[8],h=t[9],d=t[10],v=t[11],e[0]=r,e[1]=a,e[2]=i,e[3]=s,e[4]=o,e[5]=c,e[6]=u,e[7]=l,e[8]=f,e[9]=h,e[10]=d,e[11]=v,e[12]=r*m+o*M+f*p+t[12],e[13]=a*m+c*M+h*p+t[13],e[14]=i*m+u*M+d*p+t[14],e[15]=s*m+l*M+v*p+t[15]),e}function ot(e,t,n){var r=n[0],a=n[1],i=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ct(e,t,n,r){var a,i,s,o,c,u,l,f,h,v,m,M,p,g,b,y,x,S,P,w,E,A,z,I,V=r[0],B=r[1],L=r[2],T=Math.hypot(V,B,L);return T<d?null:(V*=T=1/T,B*=T,L*=T,a=Math.sin(n),s=1-(i=Math.cos(n)),o=t[0],c=t[1],u=t[2],l=t[3],f=t[4],h=t[5],v=t[6],m=t[7],M=t[8],p=t[9],g=t[10],b=t[11],y=V*V*s+i,x=B*V*s+L*a,S=L*V*s-B*a,P=V*B*s-L*a,w=B*B*s+i,E=L*B*s+V*a,A=V*L*s+B*a,z=B*L*s-V*a,I=L*L*s+i,e[0]=o*y+f*x+M*S,e[1]=c*y+h*x+p*S,e[2]=u*y+v*x+g*S,e[3]=l*y+m*x+b*S,e[4]=o*P+f*w+M*E,e[5]=c*P+h*w+p*E,e[6]=u*P+v*w+g*E,e[7]=l*P+m*w+b*E,e[8]=o*A+f*z+M*I,e[9]=c*A+h*z+p*I,e[10]=u*A+v*z+g*I,e[11]=l*A+m*z+b*I,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function ut(e,t,n){var r=Math.sin(n),a=Math.cos(n),i=t[4],s=t[5],o=t[6],c=t[7],u=t[8],l=t[9],f=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*a+u*r,e[5]=s*a+l*r,e[6]=o*a+f*r,e[7]=c*a+h*r,e[8]=u*a-i*r,e[9]=l*a-s*r,e[10]=f*a-o*r,e[11]=h*a-c*r,e}function lt(e,t,n){var r=Math.sin(n),a=Math.cos(n),i=t[0],s=t[1],o=t[2],c=t[3],u=t[8],l=t[9],f=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*a-u*r,e[1]=s*a-l*r,e[2]=o*a-f*r,e[3]=c*a-h*r,e[8]=i*r+u*a,e[9]=s*r+l*a,e[10]=o*r+f*a,e[11]=c*r+h*a,e}function ft(e,t,n){var r=Math.sin(n),a=Math.cos(n),i=t[0],s=t[1],o=t[2],c=t[3],u=t[4],l=t[5],f=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*a+u*r,e[1]=s*a+l*r,e[2]=o*a+f*r,e[3]=c*a+h*r,e[4]=u*a-i*r,e[5]=l*a-s*r,e[6]=f*a-o*r,e[7]=h*a-c*r,e}function ht(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function dt(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function vt(e,t,n){var r,a,i,s=n[0],o=n[1],c=n[2],u=Math.hypot(s,o,c);return u<d?null:(s*=u=1/u,o*=u,c*=u,r=Math.sin(t),i=1-(a=Math.cos(t)),e[0]=s*s*i+a,e[1]=o*s*i+c*r,e[2]=c*s*i-o*r,e[3]=0,e[4]=s*o*i-c*r,e[5]=o*o*i+a,e[6]=c*o*i+s*r,e[7]=0,e[8]=s*c*i+o*r,e[9]=o*c*i-s*r,e[10]=c*c*i+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function mt(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Mt(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pt(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function gt(e,t,n){var r=t[0],a=t[1],i=t[2],s=t[3],o=r+r,c=a+a,u=i+i,l=r*o,f=r*c,h=r*u,d=a*c,v=a*u,m=i*u,M=s*o,p=s*c,g=s*u;return e[0]=1-(d+m),e[1]=f+g,e[2]=h-p,e[3]=0,e[4]=f-g,e[5]=1-(l+m),e[6]=v+M,e[7]=0,e[8]=h+p,e[9]=v-M,e[10]=1-(l+d),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function bt(e,t){var n=new v(3),r=-t[0],a=-t[1],i=-t[2],s=t[3],o=t[4],c=t[5],u=t[6],l=t[7],f=r*r+a*a+i*i+s*s;return f>0?(n[0]=2*(o*s+l*r+c*i-u*a)/f,n[1]=2*(c*s+l*a+u*r-o*i)/f,n[2]=2*(u*s+l*i+o*a-c*r)/f):(n[0]=2*(o*s+l*r+c*i-u*a),n[1]=2*(c*s+l*a+u*r-o*i),n[2]=2*(u*s+l*i+o*a-c*r)),gt(e,t,n),e}function yt(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function xt(e,t){var n=t[0],r=t[1],a=t[2],i=t[4],s=t[5],o=t[6],c=t[8],u=t[9],l=t[10];return e[0]=Math.hypot(n,r,a),e[1]=Math.hypot(i,s,o),e[2]=Math.hypot(c,u,l),e}function St(e,t){var n=new v(3);xt(n,t);var r=1/n[0],a=1/n[1],i=1/n[2],s=t[0]*r,o=t[1]*a,c=t[2]*i,u=t[4]*r,l=t[5]*a,f=t[6]*i,h=t[8]*r,d=t[9]*a,m=t[10]*i,M=s+l+m,p=0;return M>0?(p=2*Math.sqrt(M+1),e[3]=.25*p,e[0]=(f-d)/p,e[1]=(h-c)/p,e[2]=(o-u)/p):s>l&&s>m?(p=2*Math.sqrt(1+s-l-m),e[3]=(f-d)/p,e[0]=.25*p,e[1]=(o+u)/p,e[2]=(h+c)/p):l>m?(p=2*Math.sqrt(1+l-s-m),e[3]=(h-c)/p,e[0]=(o+u)/p,e[1]=.25*p,e[2]=(f+d)/p):(p=2*Math.sqrt(1+m-s-l),e[3]=(o-u)/p,e[0]=(h+c)/p,e[1]=(f+d)/p,e[2]=.25*p),e}function Pt(e,t,n,r){var a=t[0],i=t[1],s=t[2],o=t[3],c=a+a,u=i+i,l=s+s,f=a*c,h=a*u,d=a*l,v=i*u,m=i*l,M=s*l,p=o*c,g=o*u,b=o*l,y=r[0],x=r[1],S=r[2];return e[0]=(1-(v+M))*y,e[1]=(h+b)*y,e[2]=(d-g)*y,e[3]=0,e[4]=(h-b)*x,e[5]=(1-(f+M))*x,e[6]=(m+p)*x,e[7]=0,e[8]=(d+g)*S,e[9]=(m-p)*S,e[10]=(1-(f+v))*S,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function wt(e,t,n,r,a){var i=t[0],s=t[1],o=t[2],c=t[3],u=i+i,l=s+s,f=o+o,h=i*u,d=i*l,v=i*f,m=s*l,M=s*f,p=o*f,g=c*u,b=c*l,y=c*f,x=r[0],S=r[1],P=r[2],w=a[0],E=a[1],A=a[2],z=(1-(m+p))*x,I=(d+y)*x,V=(v-b)*x,B=(d-y)*S,L=(1-(h+p))*S,T=(M+g)*S,C=(v+b)*P,U=(M-g)*P,O=(1-(h+m))*P;return e[0]=z,e[1]=I,e[2]=V,e[3]=0,e[4]=B,e[5]=L,e[6]=T,e[7]=0,e[8]=C,e[9]=U,e[10]=O,e[11]=0,e[12]=n[0]+w-(z*w+B*E+C*A),e[13]=n[1]+E-(I*w+L*E+U*A),e[14]=n[2]+A-(V*w+T*E+O*A),e[15]=1,e}function Et(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],s=n+n,o=r+r,c=a+a,u=n*s,l=r*s,f=r*o,h=a*s,d=a*o,v=a*c,m=i*s,M=i*o,p=i*c;return e[0]=1-f-v,e[1]=l+p,e[2]=h-M,e[3]=0,e[4]=l-p,e[5]=1-u-v,e[6]=d+m,e[7]=0,e[8]=h+M,e[9]=d-m,e[10]=1-u-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function At(e,t,n,r,a,i,s){var o=1/(n-t),c=1/(a-r),u=1/(i-s);return e[0]=2*i*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*i*c,e[6]=0,e[7]=0,e[8]=(n+t)*o,e[9]=(a+r)*c,e[10]=(s+i)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*i*2*u,e[15]=0,e}function zt(e,t,n,r,a){var i,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(i=1/(r-a),e[10]=(a+r)*i,e[14]=2*a*r*i):(e[10]=-1,e[14]=-2*r),e}var It=zt;function Vt(e,t,n,r,a){var i,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(i=1/(r-a),e[10]=a*i,e[14]=a*r*i):(e[10]=-1,e[14]=-r),e}function Bt(e,t,n,r){var a=Math.tan(t.upDegrees*Math.PI/180),i=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),c=2/(s+o),u=2/(a+i);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-(s-o)*c*.5,e[9]=(a-i)*u*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function Lt(e,t,n,r,a,i,s){var o=1/(t-n),c=1/(r-a),u=1/(i-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+n)*o,e[13]=(a+r)*c,e[14]=(s+i)*u,e[15]=1,e}var Tt=Lt;function Ct(e,t,n,r,a,i,s){var o=1/(t-n),c=1/(r-a),u=1/(i-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=u,e[11]=0,e[12]=(t+n)*o,e[13]=(a+r)*c,e[14]=i*u,e[15]=1,e}function Ut(e,t,n,r){var a,i,s,o,c,u,l,f,h,v,m=t[0],M=t[1],p=t[2],g=r[0],b=r[1],y=r[2],x=n[0],S=n[1],P=n[2];return Math.abs(m-x)<d&&Math.abs(M-S)<d&&Math.abs(p-P)<d?et(e):(l=m-x,f=M-S,h=p-P,a=b*(h*=v=1/Math.hypot(l,f,h))-y*(f*=v),i=y*(l*=v)-g*h,s=g*f-b*l,(v=Math.hypot(a,i,s))?(a*=v=1/v,i*=v,s*=v):(a=0,i=0,s=0),o=f*s-h*i,c=h*a-l*s,u=l*i-f*a,(v=Math.hypot(o,c,u))?(o*=v=1/v,c*=v,u*=v):(o=0,c=0,u=0),e[0]=a,e[1]=o,e[2]=l,e[3]=0,e[4]=i,e[5]=c,e[6]=f,e[7]=0,e[8]=s,e[9]=u,e[10]=h,e[11]=0,e[12]=-(a*m+i*M+s*p),e[13]=-(o*m+c*M+u*p),e[14]=-(l*m+f*M+h*p),e[15]=1,e)}function Ot(e,t,n,r){var a=t[0],i=t[1],s=t[2],o=r[0],c=r[1],u=r[2],l=a-n[0],f=i-n[1],h=s-n[2],d=l*l+f*f+h*h;d>0&&(l*=d=1/Math.sqrt(d),f*=d,h*=d);var v=c*h-u*f,m=u*l-o*h,M=o*f-c*l;return(d=v*v+m*m+M*M)>0&&(v*=d=1/Math.sqrt(d),m*=d,M*=d),e[0]=v,e[1]=m,e[2]=M,e[3]=0,e[4]=f*M-h*m,e[5]=h*v-l*M,e[6]=l*m-f*v,e[7]=0,e[8]=l,e[9]=f,e[10]=h,e[11]=0,e[12]=a,e[13]=i,e[14]=s,e[15]=1,e}function _t(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Dt(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Rt(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function Ft(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function jt(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function Gt(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function qt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Yt(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],s=e[4],o=e[5],c=e[6],u=e[7],l=e[8],f=e[9],h=e[10],v=e[11],m=e[12],M=e[13],p=e[14],g=e[15],b=t[0],y=t[1],x=t[2],S=t[3],P=t[4],w=t[5],E=t[6],A=t[7],z=t[8],I=t[9],V=t[10],B=t[11],L=t[12],T=t[13],C=t[14],U=t[15];return Math.abs(n-b)<=d*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(r-y)<=d*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(a-x)<=d*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(i-S)<=d*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(s-P)<=d*Math.max(1,Math.abs(s),Math.abs(P))&&Math.abs(o-w)<=d*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(c-E)<=d*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(u-A)<=d*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(l-z)<=d*Math.max(1,Math.abs(l),Math.abs(z))&&Math.abs(f-I)<=d*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(h-V)<=d*Math.max(1,Math.abs(h),Math.abs(V))&&Math.abs(v-B)<=d*Math.max(1,Math.abs(v),Math.abs(B))&&Math.abs(m-L)<=d*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(M-T)<=d*Math.max(1,Math.abs(M),Math.abs(T))&&Math.abs(p-C)<=d*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(g-U)<=d*Math.max(1,Math.abs(g),Math.abs(U))}var kt=it,Nt=Ft;function Xt(){var e=new v(3);return v!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function $t(e){var t=new v(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Kt(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function Ht(e,t,n){var r=new v(3);return r[0]=e,r[1]=t,r[2]=n,r}function Qt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Zt(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function Wt(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function Jt(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function en(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function tn(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function nn(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function rn(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function an(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function sn(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function on(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function cn(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function un(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function ln(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return Math.hypot(n,r,a)}function fn(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return n*n+r*r+a*a}function hn(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function dn(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function vn(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function mn(e,t){var n=t[0],r=t[1],a=t[2],i=n*n+r*r+a*a;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function Mn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function pn(e,t,n){var r=t[0],a=t[1],i=t[2],s=n[0],o=n[1],c=n[2];return e[0]=a*c-i*o,e[1]=i*s-r*c,e[2]=r*o-a*s,e}function gn(e,t,n,r){var a=t[0],i=t[1],s=t[2];return e[0]=a+r*(n[0]-a),e[1]=i+r*(n[1]-i),e[2]=s+r*(n[2]-s),e}function bn(e,t,n,r,a,i){var s=i*i,o=s*(2*i-3)+1,c=s*(i-2)+i,u=s*(i-1),l=s*(3-2*i);return e[0]=t[0]*o+n[0]*c+r[0]*u+a[0]*l,e[1]=t[1]*o+n[1]*c+r[1]*u+a[1]*l,e[2]=t[2]*o+n[2]*c+r[2]*u+a[2]*l,e}function yn(e,t,n,r,a,i){var s=1-i,o=s*s,c=i*i,u=o*s,l=3*i*o,f=3*c*s,h=c*i;return e[0]=t[0]*u+n[0]*l+r[0]*f+a[0]*h,e[1]=t[1]*u+n[1]*l+r[1]*f+a[1]*h,e[2]=t[2]*u+n[2]*l+r[2]*f+a[2]*h,e}function xn(e,t){t=t||1;var n=2*m()*Math.PI,r=2*m()-1,a=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*a,e[1]=Math.sin(n)*a,e[2]=r*t,e}function Sn(e,t,n){var r=t[0],a=t[1],i=t[2],s=n[3]*r+n[7]*a+n[11]*i+n[15];return s=s||1,e[0]=(n[0]*r+n[4]*a+n[8]*i+n[12])/s,e[1]=(n[1]*r+n[5]*a+n[9]*i+n[13])/s,e[2]=(n[2]*r+n[6]*a+n[10]*i+n[14])/s,e}function Pn(e,t,n){var r=t[0],a=t[1],i=t[2];return e[0]=r*n[0]+a*n[3]+i*n[6],e[1]=r*n[1]+a*n[4]+i*n[7],e[2]=r*n[2]+a*n[5]+i*n[8],e}function wn(e,t,n){var r=n[0],a=n[1],i=n[2],s=n[3],o=t[0],c=t[1],u=t[2],l=a*u-i*c,f=i*o-r*u,h=r*c-a*o,d=a*h-i*f,v=i*l-r*h,m=r*f-a*l,M=2*s;return l*=M,f*=M,h*=M,d*=2,v*=2,m*=2,e[0]=o+l+d,e[1]=c+f+v,e[2]=u+h+m,e}function En(e,t,n,r){var a=[],i=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],i[0]=a[0],i[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),i[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function An(e,t,n,r){var a=[],i=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],i[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),i[1]=a[1],i[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function zn(e,t,n,r){var a=[],i=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],i[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),i[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),i[2]=a[2],e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function In(e,t){var n=e[0],r=e[1],a=e[2],i=t[0],s=t[1],o=t[2],c=Math.sqrt(n*n+r*r+a*a)*Math.sqrt(i*i+s*s+o*o),u=c&&Mn(e,t)/c;return Math.acos(Math.min(Math.max(u,-1),1))}function Vn(e){return e[0]=0,e[1]=0,e[2]=0,e}function Bn(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Ln(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Tn(e,t){var n=e[0],r=e[1],a=e[2],i=t[0],s=t[1],o=t[2];return Math.abs(n-i)<=d*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-s)<=d*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-o)<=d*Math.max(1,Math.abs(a),Math.abs(o))}var Cn,Un=Jt,On=en,_n=tn,Dn=ln,Rn=fn,Fn=Kt,jn=hn,Gn=(Cn=Xt(),function(e,t,n,r,a,i){var s,o;for(t||(t=3),n||(n=0),o=r?Math.min(r*t+n,e.length):e.length,s=n;s<o;s+=t)Cn[0]=e[s],Cn[1]=e[s+1],Cn[2]=e[s+2],a(Cn,Cn,i),e[s]=Cn[0],e[s+1]=Cn[1],e[s+2]=Cn[2];return e});function qn(){var e=new v(4);return v!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Yn(e){var t=new v(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function kn(e,t,n,r){var a=new v(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=r,a}function Nn(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Xn(e,t,n,r,a){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e}function $n(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function Kn(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function Hn(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function Qn(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function Zn(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function Wn(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Jn(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e}function er(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e}function tr(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function nr(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function rr(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e}function ar(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2],i=t[3]-e[3];return Math.hypot(n,r,a,i)}function ir(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2],i=t[3]-e[3];return n*n+r*r+a*a+i*i}function sr(e){var t=e[0],n=e[1],r=e[2],a=e[3];return Math.hypot(t,n,r,a)}function or(e){var t=e[0],n=e[1],r=e[2],a=e[3];return t*t+n*n+r*r+a*a}function cr(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function ur(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function lr(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],s=n*n+r*r+a*a+i*i;return s>0&&(s=1/Math.sqrt(s)),e[0]=n*s,e[1]=r*s,e[2]=a*s,e[3]=i*s,e}function fr(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function hr(e,t,n,r){var a=n[0]*r[1]-n[1]*r[0],i=n[0]*r[2]-n[2]*r[0],s=n[0]*r[3]-n[3]*r[0],o=n[1]*r[2]-n[2]*r[1],c=n[1]*r[3]-n[3]*r[1],u=n[2]*r[3]-n[3]*r[2],l=t[0],f=t[1],h=t[2],d=t[3];return e[0]=f*u-h*c+d*o,e[1]=-l*u+h*s-d*i,e[2]=l*c-f*s+d*a,e[3]=-l*o+f*i-h*a,e}function dr(e,t,n,r){var a=t[0],i=t[1],s=t[2],o=t[3];return e[0]=a+r*(n[0]-a),e[1]=i+r*(n[1]-i),e[2]=s+r*(n[2]-s),e[3]=o+r*(n[3]-o),e}function vr(e,t){var n,r,a,i,s,o;t=t||1;do{s=(n=2*m()-1)*n+(r=2*m()-1)*r}while(s>=1);do{o=(a=2*m()-1)*a+(i=2*m()-1)*i}while(o>=1);var c=Math.sqrt((1-s)/o);return e[0]=t*n,e[1]=t*r,e[2]=t*a*c,e[3]=t*i*c,e}function mr(e,t,n){var r=t[0],a=t[1],i=t[2],s=t[3];return e[0]=n[0]*r+n[4]*a+n[8]*i+n[12]*s,e[1]=n[1]*r+n[5]*a+n[9]*i+n[13]*s,e[2]=n[2]*r+n[6]*a+n[10]*i+n[14]*s,e[3]=n[3]*r+n[7]*a+n[11]*i+n[15]*s,e}function Mr(e,t,n){var r=t[0],a=t[1],i=t[2],s=n[0],o=n[1],c=n[2],u=n[3],l=u*r+o*i-c*a,f=u*a+c*r-s*i,h=u*i+s*a-o*r,d=-s*r-o*a-c*i;return e[0]=l*u+d*-s+f*-c-h*-o,e[1]=f*u+d*-o+h*-s-l*-c,e[2]=h*u+d*-c+l*-o-f*-s,e[3]=t[3],e}function pr(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function gr(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function br(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function yr(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],s=t[0],o=t[1],c=t[2],u=t[3];return Math.abs(n-s)<=d*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-o)<=d*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(a-c)<=d*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(i-u)<=d*Math.max(1,Math.abs(i),Math.abs(u))}var xr=Kn,Sr=Hn,Pr=Qn,wr=ar,Er=ir,Ar=sr,zr=or,Ir=function(){var e=qn();return function(t,n,r,a,i,s){var o,c;for(n||(n=4),r||(r=0),c=a?Math.min(a*n+r,t.length):t.length,o=r;o<c;o+=n)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],i(e,e,s),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}}();function Vr(){var e=new v(4);return v!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Br(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Lr(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function Tr(e,t){var n=2*Math.acos(t[3]),r=Math.sin(n/2);return r>d?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n}function Cr(e,t){var n=ca(e,t);return Math.acos(2*n*n-1)}function Ur(e,t,n){var r=t[0],a=t[1],i=t[2],s=t[3],o=n[0],c=n[1],u=n[2],l=n[3];return e[0]=r*l+s*o+a*u-i*c,e[1]=a*l+s*c+i*o-r*u,e[2]=i*l+s*u+r*c-a*o,e[3]=s*l-r*o-a*c-i*u,e}function Or(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],s=t[3],o=Math.sin(n),c=Math.cos(n);return e[0]=r*c+s*o,e[1]=a*c+i*o,e[2]=i*c-a*o,e[3]=s*c-r*o,e}function _r(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],s=t[3],o=Math.sin(n),c=Math.cos(n);return e[0]=r*c-i*o,e[1]=a*c+s*o,e[2]=i*c+r*o,e[3]=s*c-a*o,e}function Dr(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],s=t[3],o=Math.sin(n),c=Math.cos(n);return e[0]=r*c+a*o,e[1]=a*c-r*o,e[2]=i*c+s*o,e[3]=s*c-i*o,e}function Rr(e,t){var n=t[0],r=t[1],a=t[2];return e[0]=n,e[1]=r,e[2]=a,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-a*a)),e}function Fr(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],s=Math.sqrt(n*n+r*r+a*a),o=Math.exp(i),c=s>0?o*Math.sin(s)/s:0;return e[0]=n*c,e[1]=r*c,e[2]=a*c,e[3]=o*Math.cos(s),e}function jr(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],s=Math.sqrt(n*n+r*r+a*a),o=s>0?Math.atan2(s,i)/s:0;return e[0]=n*o,e[1]=r*o,e[2]=a*o,e[3]=.5*Math.log(n*n+r*r+a*a+i*i),e}function Gr(e,t,n){return jr(e,t),oa(e,e,n),Fr(e,e),e}function qr(e,t,n,r){var a,i,s,o,c,u=t[0],l=t[1],f=t[2],h=t[3],v=n[0],m=n[1],M=n[2],p=n[3];return(i=u*v+l*m+f*M+h*p)<0&&(i=-i,v=-v,m=-m,M=-M,p=-p),1-i>d?(a=Math.acos(i),s=Math.sin(a),o=Math.sin((1-r)*a)/s,c=Math.sin(r*a)/s):(o=1-r,c=r),e[0]=o*u+c*v,e[1]=o*l+c*m,e[2]=o*f+c*M,e[3]=o*h+c*p,e}function Yr(e){var t=m(),n=m(),r=m(),a=Math.sqrt(1-t),i=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*n),e[1]=a*Math.cos(2*Math.PI*n),e[2]=i*Math.sin(2*Math.PI*r),e[3]=i*Math.cos(2*Math.PI*r),e}function kr(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],s=n*n+r*r+a*a+i*i,o=s?1/s:0;return e[0]=-n*o,e[1]=-r*o,e[2]=-a*o,e[3]=i*o,e}function Nr(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Xr(e,t){var n,r=t[0]+t[4]+t[8];if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var i=(a+1)%3,s=(a+2)%3;n=Math.sqrt(t[3*a+a]-t[3*i+i]-t[3*s+s]+1),e[a]=.5*n,n=.5/n,e[3]=(t[3*i+s]-t[3*s+i])*n,e[i]=(t[3*i+a]+t[3*a+i])*n,e[s]=(t[3*s+a]+t[3*a+s])*n}return e}function $r(e,t,n,r){var a=.5*Math.PI/180;t*=a,n*=a,r*=a;var i=Math.sin(t),s=Math.cos(t),o=Math.sin(n),c=Math.cos(n),u=Math.sin(r),l=Math.cos(r);return e[0]=i*c*l-s*o*u,e[1]=s*o*l+i*c*u,e[2]=s*c*u-i*o*l,e[3]=s*c*l+i*o*u,e}function Kr(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var Hr,Qr,Zr,Wr,Jr,ea,ta=Yn,na=kn,ra=Nn,aa=Xn,ia=$n,sa=Ur,oa=nr,ca=fr,ua=dr,la=sr,fa=la,ha=or,da=ha,va=lr,ma=br,Ma=yr,pa=(Hr=Xt(),Qr=Ht(1,0,0),Zr=Ht(0,1,0),function(e,t,n){var r=Mn(t,n);return r<-.999999?(pn(Hr,Qr,t),Fn(Hr)<1e-6&&pn(Hr,Zr,t),mn(Hr,Hr),Lr(e,Hr,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(pn(Hr,t,n),e[0]=Hr[0],e[1]=Hr[1],e[2]=Hr[2],e[3]=1+r,va(e,e))}),ga=(Wr=Vr(),Jr=Vr(),function(e,t,n,r,a,i){return qr(Wr,t,a,i),qr(Jr,n,r,i),qr(e,Wr,Jr,2*i*(1-i)),e}),ba=(ea=pe(),function(e,t,n,r){return ea[0]=n[0],ea[3]=n[1],ea[6]=n[2],ea[1]=r[0],ea[4]=r[1],ea[7]=r[2],ea[2]=-t[0],ea[5]=-t[1],ea[8]=-t[2],va(e,Xr(e,ea))});function ya(){var e=new v(8);return v!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e}function xa(e){var t=new v(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Sa(e,t,n,r,a,i,s,o){var c=new v(8);return c[0]=e,c[1]=t,c[2]=n,c[3]=r,c[4]=a,c[5]=i,c[6]=s,c[7]=o,c}function Pa(e,t,n,r,a,i,s){var o=new v(8);o[0]=e,o[1]=t,o[2]=n,o[3]=r;var c=.5*a,u=.5*i,l=.5*s;return o[4]=c*r+u*n-l*t,o[5]=u*r+l*e-c*n,o[6]=l*r+c*t-u*e,o[7]=-c*e-u*t-l*n,o}function wa(e,t,n){var r=.5*n[0],a=.5*n[1],i=.5*n[2],s=t[0],o=t[1],c=t[2],u=t[3];return e[0]=s,e[1]=o,e[2]=c,e[3]=u,e[4]=r*u+a*c-i*o,e[5]=a*u+i*s-r*c,e[6]=i*u+r*o-a*s,e[7]=-r*s-a*o-i*c,e}function Ea(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e}function Aa(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function za(e,t){var n=Vr();St(n,t);var r=new v(3);return yt(r,t),wa(e,n,r),e}function Ia(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function Va(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function Ba(e,t,n,r,a,i,s,o,c){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=i,e[5]=s,e[6]=o,e[7]=c,e}var La=ra;function Ta(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e}var Ca=ra;function Ua(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e}function Oa(e,t){var n=t[4],r=t[5],a=t[6],i=t[7],s=-t[0],o=-t[1],c=-t[2],u=t[3];return e[0]=2*(n*u+i*s+r*c-a*o),e[1]=2*(r*u+i*o+a*s-n*c),e[2]=2*(a*u+i*c+n*o-r*s),e}function _a(e,t,n){var r=t[0],a=t[1],i=t[2],s=t[3],o=.5*n[0],c=.5*n[1],u=.5*n[2],l=t[4],f=t[5],h=t[6],d=t[7];return e[0]=r,e[1]=a,e[2]=i,e[3]=s,e[4]=s*o+a*u-i*c+l,e[5]=s*c+i*o-r*u+f,e[6]=s*u+r*c-a*o+h,e[7]=-r*o-a*c-i*u+d,e}function Da(e,t,n){var r=-t[0],a=-t[1],i=-t[2],s=t[3],o=t[4],c=t[5],u=t[6],l=t[7],f=o*s+l*r+c*i-u*a,h=c*s+l*a+u*r-o*i,d=u*s+l*i+o*a-c*r,v=l*s-o*r-c*a-u*i;return Or(e,t,n),r=e[0],a=e[1],i=e[2],s=e[3],e[4]=f*s+v*r+h*i-d*a,e[5]=h*s+v*a+d*r-f*i,e[6]=d*s+v*i+f*a-h*r,e[7]=v*s-f*r-h*a-d*i,e}function Ra(e,t,n){var r=-t[0],a=-t[1],i=-t[2],s=t[3],o=t[4],c=t[5],u=t[6],l=t[7],f=o*s+l*r+c*i-u*a,h=c*s+l*a+u*r-o*i,d=u*s+l*i+o*a-c*r,v=l*s-o*r-c*a-u*i;return _r(e,t,n),r=e[0],a=e[1],i=e[2],s=e[3],e[4]=f*s+v*r+h*i-d*a,e[5]=h*s+v*a+d*r-f*i,e[6]=d*s+v*i+f*a-h*r,e[7]=v*s-f*r-h*a-d*i,e}function Fa(e,t,n){var r=-t[0],a=-t[1],i=-t[2],s=t[3],o=t[4],c=t[5],u=t[6],l=t[7],f=o*s+l*r+c*i-u*a,h=c*s+l*a+u*r-o*i,d=u*s+l*i+o*a-c*r,v=l*s-o*r-c*a-u*i;return Dr(e,t,n),r=e[0],a=e[1],i=e[2],s=e[3],e[4]=f*s+v*r+h*i-d*a,e[5]=h*s+v*a+d*r-f*i,e[6]=d*s+v*i+f*a-h*r,e[7]=v*s-f*r-h*a-d*i,e}function ja(e,t,n){var r=n[0],a=n[1],i=n[2],s=n[3],o=t[0],c=t[1],u=t[2],l=t[3];return e[0]=o*s+l*r+c*i-u*a,e[1]=c*s+l*a+u*r-o*i,e[2]=u*s+l*i+o*a-c*r,e[3]=l*s-o*r-c*a-u*i,o=t[4],c=t[5],u=t[6],l=t[7],e[4]=o*s+l*r+c*i-u*a,e[5]=c*s+l*a+u*r-o*i,e[6]=u*s+l*i+o*a-c*r,e[7]=l*s-o*r-c*a-u*i,e}function Ga(e,t,n){var r=t[0],a=t[1],i=t[2],s=t[3],o=n[0],c=n[1],u=n[2],l=n[3];return e[0]=r*l+s*o+a*u-i*c,e[1]=a*l+s*c+i*o-r*u,e[2]=i*l+s*u+r*c-a*o,e[3]=s*l-r*o-a*c-i*u,o=n[4],c=n[5],u=n[6],l=n[7],e[4]=r*l+s*o+a*u-i*c,e[5]=a*l+s*c+i*o-r*u,e[6]=i*l+s*u+r*c-a*o,e[7]=s*l-r*o-a*c-i*u,e}function qa(e,t,n,r){if(Math.abs(r)<d)return Ia(e,t);var a=Math.hypot(n[0],n[1],n[2]);r*=.5;var i=Math.sin(r),s=i*n[0]/a,o=i*n[1]/a,c=i*n[2]/a,u=Math.cos(r),l=t[0],f=t[1],h=t[2],v=t[3];e[0]=l*u+v*s+f*c-h*o,e[1]=f*u+v*o+h*s-l*c,e[2]=h*u+v*c+l*o-f*s,e[3]=v*u-l*s-f*o-h*c;var m=t[4],M=t[5],p=t[6],g=t[7];return e[4]=m*u+g*s+M*c-p*o,e[5]=M*u+g*o+p*s-m*c,e[6]=p*u+g*c+m*o-M*s,e[7]=g*u-m*s-M*o-p*c,e}function Ya(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e}function ka(e,t,n){var r=t[0],a=t[1],i=t[2],s=t[3],o=n[4],c=n[5],u=n[6],l=n[7],f=t[4],h=t[5],d=t[6],v=t[7],m=n[0],M=n[1],p=n[2],g=n[3];return e[0]=r*g+s*m+a*p-i*M,e[1]=a*g+s*M+i*m-r*p,e[2]=i*g+s*p+r*M-a*m,e[3]=s*g-r*m-a*M-i*p,e[4]=r*l+s*o+a*u-i*c+f*g+v*m+h*p-d*M,e[5]=a*l+s*c+i*o-r*u+h*g+v*M+d*m-f*p,e[6]=i*l+s*u+r*c-a*o+d*g+v*p+f*M-h*m,e[7]=s*l-r*o-a*c-i*u+v*g-f*m-h*M-d*p,e}var Na=ka;function Xa(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e}var $a=ca;function Ka(e,t,n,r){var a=1-r;return $a(t,n)<0&&(r=-r),e[0]=t[0]*a+n[0]*r,e[1]=t[1]*a+n[1]*r,e[2]=t[2]*a+n[2]*r,e[3]=t[3]*a+n[3]*r,e[4]=t[4]*a+n[4]*r,e[5]=t[5]*a+n[5]*r,e[6]=t[6]*a+n[6]*r,e[7]=t[7]*a+n[7]*r,e}function Ha(e,t){var n=Ja(t);return e[0]=-t[0]/n,e[1]=-t[1]/n,e[2]=-t[2]/n,e[3]=t[3]/n,e[4]=-t[4]/n,e[5]=-t[5]/n,e[6]=-t[6]/n,e[7]=t[7]/n,e}function Qa(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e}var Za=la,Wa=Za,Ja=ha,ei=Ja;function ti(e,t){var n=Ja(t);if(n>0){n=Math.sqrt(n);var r=t[0]/n,a=t[1]/n,i=t[2]/n,s=t[3]/n,o=t[4],c=t[5],u=t[6],l=t[7],f=r*o+a*c+i*u+s*l;e[0]=r,e[1]=a,e[2]=i,e[3]=s,e[4]=(o-r*f)/n,e[5]=(c-a*f)/n,e[6]=(u-i*f)/n,e[7]=(l-s*f)/n}return e}function ni(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function ri(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function ai(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],s=e[4],o=e[5],c=e[6],u=e[7],l=t[0],f=t[1],h=t[2],v=t[3],m=t[4],M=t[5],p=t[6],g=t[7];return Math.abs(n-l)<=d*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-f)<=d*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(a-h)<=d*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(i-v)<=d*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(s-m)<=d*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(o-M)<=d*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(c-p)<=d*Math.max(1,Math.abs(c),Math.abs(p))&&Math.abs(u-g)<=d*Math.max(1,Math.abs(u),Math.abs(g))}function ii(){var e=new v(2);return v!=Float32Array&&(e[0]=0,e[1]=0),e}function si(e){var t=new v(2);return t[0]=e[0],t[1]=e[1],t}function oi(e,t){var n=new v(2);return n[0]=e,n[1]=t,n}function ci(e,t){return e[0]=t[0],e[1]=t[1],e}function ui(e,t,n){return e[0]=t,e[1]=n,e}function li(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function fi(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function hi(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function di(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function vi(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function mi(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function Mi(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}function pi(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}function gi(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function bi(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function yi(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e}function xi(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.hypot(n,r)}function Si(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function Pi(e){var t=e[0],n=e[1];return Math.hypot(t,n)}function wi(e){var t=e[0],n=e[1];return t*t+n*n}function Ei(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Ai(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function zi(e,t){var n=t[0],r=t[1],a=n*n+r*r;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e}function Ii(e,t){return e[0]*t[0]+e[1]*t[1]}function Vi(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e}function Bi(e,t,n,r){var a=t[0],i=t[1];return e[0]=a+r*(n[0]-a),e[1]=i+r*(n[1]-i),e}function Li(e,t){t=t||1;var n=2*m()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e}function Ti(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[2]*a,e[1]=n[1]*r+n[3]*a,e}function Ci(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[2]*a+n[4],e[1]=n[1]*r+n[3]*a+n[5],e}function Ui(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[3]*a+n[6],e[1]=n[1]*r+n[4]*a+n[7],e}function Oi(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[4]*a+n[12],e[1]=n[1]*r+n[5]*a+n[13],e}function _i(e,t,n,r){var a=t[0]-n[0],i=t[1]-n[1],s=Math.sin(r),o=Math.cos(r);return e[0]=a*o-i*s+n[0],e[1]=a*s+i*o+n[1],e}function Di(e,t){var n=e[0],r=e[1],a=t[0],i=t[1],s=Math.sqrt(n*n+r*r)*Math.sqrt(a*a+i*i),o=s&&(n*a+r*i)/s;return Math.acos(Math.min(Math.max(o,-1),1))}function Ri(e){return e[0]=0,e[1]=0,e}function Fi(e){return"vec2("+e[0]+", "+e[1]+")"}function ji(e,t){return e[0]===t[0]&&e[1]===t[1]}function Gi(e,t){var n=e[0],r=e[1],a=t[0],i=t[1];return Math.abs(n-a)<=d*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-i)<=d*Math.max(1,Math.abs(r),Math.abs(i))}var qi=Pi,Yi=fi,ki=hi,Ni=di,Xi=xi,$i=Si,Ki=wi,Hi=function(){var e=ii();return function(t,n,r,a,i,s){var o,c;for(n||(n=2),r||(r=0),c=a?Math.min(a*n+r,t.length):t.length,o=r;o<c;o+=n)e[0]=t[o],e[1]=t[o+1],i(e,e,s),t[o]=e[0],t[o+1]=e[1];return t}}()},187:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AddCircleCommand=void 0;const r=n(887),a=n(934),i=n(68),s=n(627),o=n(230);class c extends i.Command{constructor(e,t){super(e,t),this.centerFound=!1,this.center=r.vec2.fromValues(0,0),this.lastMousePos=r.vec2.fromValues(0,0)}onMouseUp(e){const t=a.SceneManager.getInstance().getScene();if(!1===this.centerFound)this.centerFound=!0,this.center=r.vec2.fromValues(e.clientX,e.clientY);else{const n=r.vec2.fromValues(e.clientX,e.clientY),a=Math.max(1,r.vec2.dist(this.center,n));t&&(o.UndoRedoManager.getInstance().preModifyScene(),t.addObject({type:"circle",position:this.center,radius:a,rotation:0,scale:r.vec2.fromValues(1,1)}),this.reset())}}onMouseMove(e){this.lastMousePos=r.vec2.fromValues(e.clientX,e.clientY)}tick(e){if(this.centerFound){const e=r.vec3.fromValues(.7,.7,.7),t=Math.max(1,r.vec2.dist(this.center,this.lastMousePos)),n=r.mat3.create();r.mat3.fromTranslation(n,this.center),s.ImmediateDraw.getInstance().drawCircle(t,e,!0,n),s.ImmediateDraw.getInstance().drawLine(this.center,this.lastMousePos,r.vec3.fromValues(.9,.9,.9),!0)}}reset(){this.centerFound=!1,this.center=r.vec2.fromValues(0,0)}}t.AddCircleCommand=c},295:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AddLightCommand=void 0;const r=n(887),a=n(934),i=n(68),s=n(230);class o extends i.Command{constructor(e,t){super(e,t)}onMouseUp(e){const t=a.SceneManager.getInstance().getScene();t&&(s.UndoRedoManager.getInstance().preModifyScene(),t.addObject({type:"light",color:r.vec4.fromValues(5*Math.random()+1,5*Math.random()+1,5*Math.random()+1,1),position:r.vec2.fromValues(e.clientX,e.clientY),rotation:0,scale:r.vec2.fromValues(1,1)}))}}t.AddLightCommand=o},674:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AddRectCommand=void 0;const r=n(887),a=n(934),i=n(68),s=n(627),o=n(230);class c extends i.Command{constructor(e,t){super(e,t),this.firstPointFound=!1,this.firstPoint=r.vec2.fromValues(0,0),this.lastMousePos=r.vec2.fromValues(0,0)}onMouseUp(e){const t=a.SceneManager.getInstance().getScene();if(!1===this.firstPointFound)this.firstPointFound=!0,this.firstPoint=r.vec2.fromValues(e.clientX,e.clientY);else{const n=r.vec2.fromValues(e.clientX,e.clientY),a=r.vec2.create();r.vec2.add(a,this.firstPoint,n),r.vec2.divide(a,a,r.vec2.fromValues(2,2));let i=r.vec2.create();r.vec2.sub(i,this.firstPoint,n),i=r.vec2.fromValues(Math.abs(i[0]),Math.abs(i[1])),t&&i[0]>1&&i[1]>1&&(o.UndoRedoManager.getInstance().preModifyScene(),t.addObject({type:"rect",position:a,size:i,rotation:0,scale:r.vec2.fromValues(1,1)}),this.reset())}}onMouseMove(e){this.lastMousePos=r.vec2.fromValues(e.clientX,e.clientY)}tick(e){if(!this.firstPointFound)return;const t=r.vec3.fromValues(.7,.7,.7);s.ImmediateDraw.getInstance().drawRect(this.firstPoint,this.lastMousePos,t,!0,r.mat3.create())}reset(){this.firstPointFound=!1,this.firstPoint=r.vec2.fromValues(0,0)}}t.AddRectCommand=c},68:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Command=void 0,t.Command=class{constructor(e,t){this.manager=e,this.button=t}init(){this.button&&this.button.classList.add("selected")}teardown(){this.button&&this.button.classList.remove("selected")}reset(){}onMouseDown(e){}onMouseUp(e){}getIcon(){return null}tick(e){}onMouseMove(e){}onKeyDown(e){}}},795:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CommandManager=void 0;const r=n(187),a=n(295),i=n(674),s=n(78);class o{static getInstance(){return null==o.instance&&(o.instance=new o),this.instance}setCommand(e){null!=this.currentCommand&&this.currentCommand.teardown(),this.currentCommand=e,this.currentCommand.init()}newLight(e){const t=new a.AddLightCommand(this,e);this.setCommand(t)}newCircle(e){const t=new r.AddCircleCommand(this,e);this.setCommand(t)}newRect(e){const t=new i.AddRectCommand(this,e);this.setCommand(t)}select(e){const t=new s.SelectCommand(this,e);this.setCommand(t)}onMouseDown(e){this.currentCommand?.onMouseDown(e)}onMouseUp(e){this.currentCommand?.onMouseUp(e)}onMouseMove(e){this.currentCommand?.onMouseMove(e)}tick(e){this.currentCommand?.tick(e)}onKeyDown(e){this.currentCommand?.onKeyDown(e),"Escape"===e.key&&this.currentCommand?.reset()}}t.CommandManager=o},822:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RotateGizmo=void 0;const r=n(887),a=n(934),i=n(627),s=n(230);t.RotateGizmo=class{constructor(e,t=60){this.sceneObj=e,this.radius=t,this.isEditing=!1,this.isHover=!1,this.initialObjectRot=0,this.initialClickRot=0}tick(e,t){const n=r.vec2.distance(t,this.sceneObj.position);this.isHover=n<this.radius+10&&n>this.radius-10;const s=this.isEditing||this.isHover,o=i.ImmediateDraw.getInstance(),c=(0,a.getTransform)(this.sceneObj,!1);o.drawCircle(this.radius,s?r.vec3.fromValues(0,1,1):r.vec3.fromValues(0,.3,.3),!0,c);const u=e=>{const t=r.vec2.create();return r.vec2.transformMat3(t,e,c),t};if(o.drawLine(u(r.vec2.fromValues(0,0)),u(r.vec2.fromValues(this.radius,0)),s?r.vec3.fromValues(1,0,0):r.vec3.fromValues(.3,0,0),!0),o.drawLine(u(r.vec2.fromValues(0,0)),u(r.vec2.fromValues(0,this.radius)),s?r.vec3.fromValues(0,1,0):r.vec3.fromValues(0,.3,0),!0),this.isEditing){const e=Math.atan2(t[1]-this.sceneObj.position[1],t[0]-this.sceneObj.position[0]);this.sceneObj.rotation=this.initialObjectRot+180*(e-this.initialClickRot)/Math.PI}}onMouseDown(e){this.isHover&&(s.UndoRedoManager.getInstance().preModifyScene(),this.isEditing=!0,this.initialObjectRot=this.sceneObj.rotation,this.initialClickRot=Math.atan2(e.clientY-this.sceneObj.position[1],e.clientX-this.sceneObj.position[0]))}onMouseUp(e){const t=this.isEditing;return this.isEditing=!1,t&&a.SceneManager.getInstance().getScene()?.setDirty(!0),t}}},852:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScaleGizmo=void 0;const r=n(887),a=n(934),i=n(627),s=n(522);class o extends s.XYAxisGizmo{constructor(e,t=100){super(e,t),this.initialScale=r.vec2.clone(this.getSceneObject().scale)}apply(e,t){let n=r.vec2.create();if("xy"===e){let e=Math.sign(r.vec2.dot(this.getOffsetToObject(),t));n=r.vec2.fromValues(-e*r.vec2.len(t),-e*r.vec2.len(t))}if("x"===e||"y"===e){const e=r.mat3.create();r.mat3.invert(e,(0,a.getTransform)(this.getSceneObject(),!1,!1)),n=r.vec2.transformMat3(t,t,e)}r.vec2.div(n,n,r.vec2.fromValues(100,100)),r.vec2.add(this.getSceneObject().scale,this.initialScale,n)}onMouseDown(e){const t=super.onMouseDown(e);return this.initialScale=r.vec2.clone(this.getSceneObject().scale),t}drawControls(e,t,n){const s=i.ImmediateDraw.getInstance(),o=r.vec2.fromValues(0,6),c=r.vec2.fromValues(12,-6),u=r.vec2.fromValues(6,0),l=r.vec2.fromValues(-6,12),f=r.mat3.create();r.mat3.fromTranslation(f,r.vec2.fromValues(this.segmentLength,0)),r.mat3.mul(f,(0,a.getTransform)(this.getSceneObject(),!1),f);const h=r.mat3.create();r.mat3.fromTranslation(h,r.vec2.fromValues(0,this.segmentLength)),r.mat3.mul(h,(0,a.getTransform)(this.getSceneObject(),!1),h),s.drawRect(o,c,e,!0,f),s.drawRect(u,l,t,!0,h)}}t.ScaleGizmo=o},78:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectCommand=void 0;const r=n(887),a=n(934),i=n(68),s=n(627),o=n(636),c=n(852),u=n(822),l=n(230);class f extends i.Command{constructor(e,t){super(e,t),this.lastMousePos=r.vec2.fromValues(0,0),this.selected=null,this.gizmo=null,this.btnsIds=["btn-translate","btn-rotate","btn-scale"],this.selectedGizmoBtnId="none",this.selectGizmoCallback=e=>{this.onGizmoSelected(e.currentTarget)},document.getElementById("transform-tools")?.classList.remove("invisible");for(let e of this.btnsIds){const t=document.getElementById(e);t?.addEventListener("click",this.selectGizmoCallback),t?.classList.contains("selected")&&(this.selectedGizmoBtnId=e)}l.UndoRedoManager.getInstance().addListener(this)}teardown(){l.UndoRedoManager.getInstance().removeListener(this),super.teardown();for(let e of this.btnsIds){const t=document.getElementById(e);t?.removeEventListener("click",this.selectGizmoCallback)}document.getElementById("transform-tools")?.classList.add("invisible")}onUndoRedo(){if(null==this.selected)return;const e=this.selected.id;this.reset();const t=a.SceneManager.getInstance().getScene()?.getObjectById(e);null!=t&&(this.selected=t,this.createGizmo())}onGizmoSelected(e){null!=e?(document.getElementById(this.selectedGizmoBtnId)?.classList.remove("selected"),this.selectedGizmoBtnId=e.id,document.getElementById(this.selectedGizmoBtnId)?.classList.add("selected"),this.createGizmo()):console.warn("null sender")}createGizmo(){this.selected&&("btn-translate"===this.selectedGizmoBtnId?this.gizmo=new o.TranslateGizmo(this.selected):"btn-scale"===this.selectedGizmoBtnId?this.gizmo=new c.ScaleGizmo(this.selected):"btn-rotate"===this.selectedGizmoBtnId&&(this.gizmo=new u.RotateGizmo(this.selected)))}getObjectUnderCursor(e){const t=a.SceneManager.getInstance().getScene();let n={obj:null};const i=(t,n=!0)=>{const i=r.vec2.create();return r.vec2.transformMat3(i,e,(0,a.getInvTransform)(t,n)),i};return t?.forEachByType("rect",(e=>{const t=e,r=i(e),a=t.size[0]/2,s=t.size[1]/2;r[0]>-a&&r[0]<a&&r[1]>-s&&r[1]<s&&(n.obj=t)})),t?.forEachByType("circle",(e=>{const t=e,a=i(e);Math.sqrt(r.vec2.dot(a,a))<t.radius&&(n.obj=t)})),t?.forEachByType("light",(e=>{const t=e,a=i(e,!1);Math.sqrt(r.vec2.dot(a,a))<20&&(n.obj=t)})),n.obj}onMouseDown(e){this.gizmo?.onMouseDown(e)}onMouseUp(e){a.SceneManager.getInstance().getScene();const t=this.gizmo?.onMouseUp(e);t||(this.selected=this.getObjectUnderCursor(r.vec2.fromValues(e.clientX,e.clientY)),this.gizmo=null,this.createGizmo())}onMouseMove(e){this.lastMousePos=r.vec2.fromValues(e.clientX,e.clientY)}tick(e){const t=a.SceneManager.getInstance().getScene(),n=s.ImmediateDraw.getInstance(),i=this.getObjectUnderCursor(this.lastMousePos),o=e=>{let t=r.vec3.fromValues(.7,.7,.7);return e===this.selected?t=r.vec3.fromValues(1,.85,0):e===i&&(t=r.vec3.fromValues(1,.5,.2)),t};t?.forEachByType("rect",(e=>{const t=e,i=r.vec2.create();r.vec2.div(i,t.size,r.vec2.fromValues(2,2));const s=r.vec2.create(),c=r.vec2.create();r.vec2.sub(s,r.vec2.create(),i),r.vec2.add(c,r.vec2.create(),i),n.drawRect(s,c,o(t),!1,(0,a.getTransform)(t,!0))})),t?.forEachByType("circle",(e=>{const t=e;n.drawCircle(t.radius,o(t),!1,(0,a.getTransform)(t,!0))})),t?.forEachByType("light",(e=>{const t=e;n.drawLight(t.position,o(t),!0)})),this.gizmo&&this.gizmo.tick(e,this.lastMousePos)}reset(){this.selected=null,this.gizmo=null}onKeyDown(e){if(("Delete"===e.key||"Backspace"===e.key)&&null!=this.selected){l.UndoRedoManager.getInstance().preModifyScene();const e=a.SceneManager.getInstance().getScene();e?.removeObject(this.selected),this.gizmo=null}let t;"w"===e.key?t=this.btnsIds[0]:"e"===e.key?t=this.btnsIds[1]:"r"===e.key&&(t=this.btnsIds[2]),t&&this.onGizmoSelected(document.getElementById(t))}}t.SelectCommand=f},636:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TranslateGizmo=void 0;const r=n(887),a=n(627),i=n(522);class s extends i.XYAxisGizmo{constructor(e,t=100){super(e,t)}apply(e,t){"xy"===e&&r.vec2.add(this.getSceneObject().position,t,this.getInitialPosition()),"x"!==e&&"y"!==e||r.vec2.add(this.getSceneObject().position,t,this.getInitialPosition())}drawControls(e,t,n){const i=a.ImmediateDraw.getInstance();i.drawLine(n(r.vec2.fromValues(this.segmentLength,0)),n(r.vec2.fromValues(this.segmentLength-6,5)),e,!0),i.drawLine(n(r.vec2.fromValues(this.segmentLength,0)),n(r.vec2.fromValues(this.segmentLength-6,-5)),e,!0),i.drawLine(n(r.vec2.fromValues(0,this.segmentLength)),n(r.vec2.fromValues(-5,this.segmentLength-6)),t,!0),i.drawLine(n(r.vec2.fromValues(0,this.segmentLength)),n(r.vec2.fromValues(5,this.segmentLength-6)),t,!0)}}t.TranslateGizmo=s},482:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setupUI=void 0;const r=n(795),a=n(230);t.setupUI=function(e){const t=r.CommandManager.getInstance();document.getElementById("btn-light")?.addEventListener("click",(e=>{t.newLight(e.currentTarget)})),document.getElementById("btn-circle")?.addEventListener("click",(e=>{t.newCircle(e.currentTarget)})),document.getElementById("btn-rect")?.addEventListener("click",(e=>{t.newRect(e.currentTarget)})),document.getElementById("btn-select")?.addEventListener("click",(e=>{t.select(e.currentTarget)})),e.addEventListener("mousedown",(e=>{t.onMouseDown(e)})),e.addEventListener("mouseup",(e=>{t.onMouseUp(e)})),e.addEventListener("mousemove",(e=>{t.onMouseMove(e)})),window.addEventListener("keydown",(e=>{t.onKeyDown(e),"z"===e.key&&e.ctrlKey?a.UndoRedoManager.getInstance().undo():"y"===e.key&&e.ctrlKey&&a.UndoRedoManager.getInstance().redo()}))}},230:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UndoRedoManager=void 0;const r=n(934);class a{constructor(){this.undoStack=[],this.redoStack=[],this.listeners=[]}static getInstance(){return null==a.instance&&(this.instance=new a),this.instance}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}preModifyScene(){this.redoStack=[],this.undoStack.push(r.SceneManager.getInstance().getScene().serialize())}undo(){const e=this.undoStack.pop();e&&(this.redoStack.push(r.SceneManager.getInstance().getScene().serialize()),r.SceneManager.getInstance().getScene()?.deserialize(e));for(let e of this.listeners)e.onUndoRedo()}redo(){const e=this.redoStack.pop();e&&(this.undoStack.push(r.SceneManager.getInstance().getScene().serialize()),r.SceneManager.getInstance().getScene()?.deserialize(e));for(let e of this.listeners)e.onUndoRedo()}}t.UndoRedoManager=a},522:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.XYAxisGizmo=void 0;const r=n(887),a=n(934),i=n(627),s=n(230);t.XYAxisGizmo=class{constructor(e,t=100){this.activateDistance=20,this.editingAxis="none",this.offset=r.vec2.fromValues(0,0),this.initialPos=r.vec2.fromValues(0,0),this.initialInvTransform=r.mat3.create(),this.sceneObj=e,this.segmentLength=t}getInitialPosition(){return r.vec2.clone(this.initialPos)}getOffsetToObject(){return r.vec2.clone(this.offset)}getSceneObject(){return this.sceneObj}getInitialClickPosition(){const e=r.vec2.create();return r.vec2.sub(e,this.initialPos,this.offset),e}getEditAxis(e){const t=(0,a.getInvTransform)(this.sceneObj,!1),n=r.vec2.create();r.vec2.transformMat3(n,e,t);let i=!1,s=!1;return n[0]>0&&n[0]<this.segmentLength&&Math.abs(n[1])<this.activateDistance&&(i=!0),n[1]>0&&n[1]<this.segmentLength&&Math.abs(n[0])<this.activateDistance&&(s=!0),i&&s?"xy":i?"x":s?"y":"none"}tick(e,t){const n=i.ImmediateDraw.getInstance(),s=(0,a.getTransform)(this.sceneObj,!1),o=e=>{const t=r.vec2.create();return r.vec2.transformMat3(t,e,s),t},c=this.getEditAxis(t),u=e=>e===c&&"none"===this.editingAxis||this.editingAxis===e;let l=r.vec3.fromValues(.3,0,0);u("x")&&(l=r.vec3.fromValues(1,0,0)),n.drawLine(o(r.vec2.fromValues(0,0)),o(r.vec2.fromValues(this.segmentLength,0)),l,!0);let f=r.vec3.fromValues(0,.3,0);u("y")&&(f=r.vec3.fromValues(0,1,0)),n.drawLine(o(r.vec2.fromValues(0,0)),o(r.vec2.fromValues(0,this.segmentLength)),f,!0);let h=r.vec3.fromValues(.3,.3,0);if(u("xy")&&(h=r.vec3.fromValues(1,1,0)),n.drawLine(o(r.vec2.fromValues(0,this.activateDistance)),o(r.vec2.fromValues(this.activateDistance,this.activateDistance)),h,!0),n.drawLine(o(r.vec2.fromValues(this.activateDistance,0)),o(r.vec2.fromValues(this.activateDistance,this.activateDistance)),h,!0),this.drawControls(l,f,o),"xy"===this.editingAxis){const e=r.vec2.create();r.vec2.sub(e,this.initialPos,this.offset);const n=r.vec2.create();r.vec2.sub(n,t,e),this.apply(this.editingAxis,n)}if("x"===this.editingAxis||"y"===this.editingAxis){const e=r.vec2.create();r.vec2.transformMat3(e,t,this.initialInvTransform);const n=r.vec2.create();r.vec2.sub(n,this.initialPos,this.offset),r.vec2.transformMat3(n,n,this.initialInvTransform);const a=r.vec2.create();r.vec2.sub(a,e,n);let i=r.vec3.create();"x"===this.editingAxis&&(i=r.vec3.fromValues(a[0],0,0)),"y"===this.editingAxis&&(i=r.vec3.fromValues(0,a[1],0)),r.vec3.transformMat3(i,i,s),this.apply(this.editingAxis,r.vec2.fromValues(i[0],i[1]))}}apply(e,t){}drawControls(e,t,n){}onMouseDown(e){const t=this.getEditAxis(r.vec2.fromValues(e.clientX,e.clientY));return this.editingAxis=t,this.initialPos=r.vec2.clone(this.sceneObj.position),this.initialInvTransform=(0,a.getInvTransform)(this.sceneObj,!1),this.offset=r.vec2.fromValues(this.sceneObj.position[0]-e.clientX,this.sceneObj.position[1]-e.clientY),"none"!==t&&s.UndoRedoManager.getInstance().preModifyScene(),"none"!=t}onMouseUp(e){const t="none"!==this.editingAxis;return this.editingAxis="none",a.SceneManager.getInstance().getScene()?.setDirty(!0),t}}},527:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.preprocess=void 0,t.preprocess=function(e,t={},n={}){const r=/#if (?<condition>.+)/,a=/#else/,i=/#endif/,s=/#elseif (?<condition>.+)/,o=e.split("\n");let c="",u=[!1],l=[!1];for(const e of o){let t=e.match(r);if(null===t)if(t=e.match(s),null===t||null==t.groups)if(t=e.match(a),null===t)if(t=e.match(i),null===t)!1===u[u.length-1]&&(c+=e+"\n");else{if(u.length<2)throw new Error("#if / #endif mismatch!");u.pop(),l.pop()}else{if(u.length<2)throw new Error("#if / #else mismatch!");!1===l[l.length-1]?u[u.length-1]=!1:u[u.length-1]=!0}else{if(u.length<2)throw new Error("#if / #else / #endif mismatch!");if(!1===l[l.length-1]){const e=!(!0===n[t.groups.condition.trim()]);u[u.length-1]=e,l[l.length-1]=!e}else u[u.length-1]=!0}else{if(null==t.groups)throw new Error("Found #if without condition");{const e=!(!0===n[t.groups.condition.trim()]);u.push(e),l.push(!e)}}}if(1!==u.length)throw new Error("#if / #else / #endif mismatch!");const f=c.matchAll(/##(?<name>[^=]+)(=(?<default>.+))?##/g);if(null!=f)for(let e of f)if(null!=e.groups){const n=e.groups.name,r=t[n]??e.groups.default;if(null==r)throw new Error(`no define value or default value for '${n}'`);c=c.replace(e[0],r)}return c}},627:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ImmediateDraw=void 0;const a=n(887),i=r(n(323));class s{constructor(){this.linesBufferCapacity=-1,this.linesBufferCapacity=-1,this.linesBufferCPU=new Float32Array(0),this.addedLines=0}static getInstance(){return null==s.instance&&(s.instance=new s),s.instance}createDrawLinesPipeline(e,t){const n=e.createShaderModule({code:i.default});this.linesPipeline=e.createRenderPipeline({layout:"auto",vertex:{module:n,entryPoint:"lineVert",buffers:[{arrayStride:8*Float32Array.BYTES_PER_ELEMENT,stepMode:"instance",attributes:[{shaderLocation:0,offset:0,format:"float32x4"},{shaderLocation:1,offset:4*Float32Array.BYTES_PER_ELEMENT,format:"float32x4"}]}]},fragment:{module:n,entryPoint:"lineFrag",targets:[{format:t,blend:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"dst-alpha"}}}]},primitive:{topology:"triangle-list"}}),this.canvasSizeBuffer=e.createBuffer({size:2*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM,label:"canvas size buffer"}),this.canvasSizeBindGroup=e.createBindGroup({layout:this.linesPipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.canvasSizeBuffer}}]})}createOrUpdateLinesBuffer(e,t){t>0&&t>this.linesBufferCapacity&&(null!=this.linesBufferGPU&&this.linesBufferGPU.destroy(),this.linesBufferCapacity=t,this.linesBufferGPU=e.createBuffer({size:8*t*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,label:"lines buffer"}))}drawLines(e,t,n,r){if(0===this.addedLines)return;null==this.linesPipeline&&this.createDrawLinesPipeline(t,r),this.createOrUpdateLinesBuffer(t,this.addedLines),t.queue.writeBuffer(this.linesBufferGPU,0,this.linesBufferCPU);const a=e.beginRenderPass({colorAttachments:[{view:n,clearValue:[1,1,1,1],loadOp:"load",storeOp:"store"}]});a.setPipeline(this.linesPipeline),a.setBindGroup(0,this.canvasSizeBindGroup),a.setVertexBuffer(0,this.linesBufferGPU),a.draw(6,this.addedLines,0,0),a.end()}drawLine(e,t,n,r){r&&this.drawLine(a.vec2.fromValues(e[0]+1,e[1]+1),a.vec2.fromValues(t[0]+1,t[1]+1),a.vec3.fromValues(.05,.05,.05),!1),this.addedLines>=this.linesBufferCPU.length/s.floatsPerLine&&(this.linesBufferCPU=new Float32Array((this.addedLines+1)*s.floatsPerLine)),this.linesBufferCPU.set([...e,...t,...n],this.addedLines*s.floatsPerLine),this.addedLines+=1}drawCircle(e,t,n,r,i=100){const s=2*Math.PI/i,o=(a.vec2.fromValues(r[6],r[7]),a.vec2.len(a.vec2.fromValues(r[0],r[1])),a.vec2.len(a.vec2.fromValues(r[3],r[4])),e=>{const t=a.vec2.create();return a.vec2.transformMat3(t,e,r),t});for(let t=1;t<=i&&n;t++){let n=a.vec2.create(),r=a.vec2.create();r=o(a.vec2.fromValues(Math.cos(t*s)*e,Math.sin(t*s)*e)),n=o(a.vec2.fromValues(Math.cos((t-1)*s)*e,Math.sin((t-1)*s)*e)),a.vec2.add(r,r,a.vec2.fromValues(1,1)),a.vec2.add(n,n,a.vec2.fromValues(1,1)),this.drawLine(n,r,a.vec3.fromValues(.05,.05,.05),!1)}for(let n=1;n<=i;n++){let r=a.vec2.create(),i=a.vec2.create();i=o(a.vec2.fromValues(Math.cos(n*s)*e,Math.sin(n*s)*e)),r=o(a.vec2.fromValues(Math.cos((n-1)*s)*e,Math.sin((n-1)*s)*e)),this.drawLine(r,i,t,!1)}}drawRect(e,t,n,r,i){const s=e=>{const t=a.vec2.create();return a.vec2.transformMat3(t,e,i),t},o=(e,t,n)=>{this.drawLine(s(e),s(a.vec2.fromValues(t[0],e[1])),n,!1),this.drawLine(s(e),s(a.vec2.fromValues(e[0],t[1])),n,!1),this.drawLine(s(a.vec2.fromValues(t[0],e[1])),s(t),n,!1),this.drawLine(s(a.vec2.fromValues(e[0],t[1])),s(t),n,!1)};r&&o(a.vec2.fromValues(e[0]+1,e[1]+1),a.vec2.fromValues(t[0]+1,t[1]+1),a.vec3.fromValues(.1,.1,.1)),o(e,t,n)}drawLight(e,t,n){const r=a.vec2.create();a.vec2.add(r,e,a.vec2.fromValues(0,-10));const i=a.mat3.create();a.mat3.fromTranslation(i,r),this.drawCircle(10,t,n,i),this.drawLine(a.vec2.fromValues(e[0]-3,e[1]),a.vec2.fromValues(e[0]-3,e[1]+7),t,n),this.drawLine(a.vec2.fromValues(e[0]+3,e[1]),a.vec2.fromValues(e[0]+3,e[1]+7),t,n),this.drawLine(a.vec2.fromValues(e[0]-3,e[1]+7),a.vec2.fromValues(e[0]+3,e[1]+7),t,n)}draw(e,t,n,r,a){const i=e.createCommandEncoder({label:"draw immediate command encoder"});return null!=this.canvasSizeBuffer&&e.queue.writeBuffer(this.canvasSizeBuffer,0,new Float32Array([r,a])),this.drawLines(i,e,t,n),this.addedLines=0,i}}t.ImmediateDraw=s,s.floatsPerLine=8},947:function(e,t,n){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.run=void 0;const a=r(n(529)),i=r(n(22)),s=r(n(203)),o=n(934),c=n(583),u=n(482),l=n(887),f=n(627),h=n(795),d=n(527);function v(e){return[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0]}function m(e,t){const n=t?window.devicePixelRatio??1:1;return[e.clientWidth*n,e.clientHeight*n]}function M(e,t,n){const r=e.device.createBindGroupLayout({label:"full screen bind group layout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),a=e.device.createShaderModule({code:i.default}),s=e.device.createRenderPipeline({label:"full screen pipeline",layout:e.device.createPipelineLayout({bindGroupLayouts:[r]}),vertex:{module:a,entryPoint:"fullScreenVert"},fragment:{module:a,entryPoint:"fullScreenFrag",targets:[{format:e.presentationFormat}]},primitive:{topology:"triangle-list"}}),o=e.device.createBindGroup({layout:r,entries:[{binding:0,resource:{buffer:n}},{binding:1,resource:{buffer:t}}]});return{addPresentPass:(e,t)=>{const n=t.beginRenderPass({colorAttachments:[{view:e.context.getCurrentTexture().createView(),clearValue:[1,1,1,1],loadOp:"clear",storeOp:"store"}]});n.setPipeline(s),n.setBindGroup(0,o),n.draw(6,1,0,0),n.end()}}}function p(e){const t=e.presentationSize[0],n=e.presentationSize[1],r=Float32Array.BYTES_PER_ELEMENT*(t*n),i=e.device.createBuffer({label:"sdf buffer",size:r,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC}),s=2*Uint32Array.BYTES_PER_ELEMENT,u=e.device.createBuffer({label:"uniform buffer",size:s,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Uint32Array(u.getMappedRange()).set([t,n]),u.unmap();const l=(0,c.typedStructInfo)({name:"Rect",fields:{invTransform:{type:"mat3x3<f32>"},size:{type:"vec2<f32>"}}}),f=128*l.structSize*Float32Array.BYTES_PER_ELEMENT,h=e.device.createBuffer({label:"rects buffer",size:f,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),m=e.device.createBuffer({label:"num rects buffer",size:Uint32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),M=(0,c.typedStructInfo)({name:"Rect",fields:{invTransform:{type:"mat3x3<f32>"},radius:{type:"f32"}}}),p=128*M.structSize*Float32Array.BYTES_PER_ELEMENT,g=e.device.createBuffer({label:"circles buffer",size:f,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),b=e.device.createBuffer({label:"num circles buffer",size:Uint32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),y=e.device.createComputePipeline({label:"sdf draw pipeline",compute:{module:e.device.createShaderModule({code:(0,d.preprocess)(a.default,{},{SCALE_SHAPES:!0})}),entryPoint:"clear"},layout:"auto"}),x=e.device.createBindGroup({layout:y.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:i}},{binding:1,resource:{buffer:u}},{binding:2,resource:{buffer:h}},{binding:3,resource:{buffer:m}},{binding:4,resource:{buffer:g}},{binding:5,resource:{buffer:b}}]});return{addDrawSDFPass:(t,n)=>{{const t=new Float32Array(f/Float32Array.BYTES_PER_ELEMENT);let r=0;n.forEachByType("rect",((e,n)=>{t.set([...v((0,o.getInvTransform)(e)),...e.size],n*l.structSize/4),r+=1})),e.device.queue.writeBuffer(h,0,t),e.device.queue.writeBuffer(m,0,new Uint32Array([r]))}{const t=new Float32Array(p/Float32Array.BYTES_PER_ELEMENT);let r=0;n.forEachByType("circle",((e,n)=>{t.set([...v((0,o.getInvTransform)(e)),e.radius],n*M.structSize/4),r+=1})),e.device.queue.writeBuffer(g,0,t),e.device.queue.writeBuffer(b,0,new Uint32Array([r]))}const r=t.beginComputePass();r.setPipeline(y),r.setBindGroup(0,x),r.dispatchWorkgroups(Math.ceil(e.presentationSize[0]/8),Math.ceil(e.presentationSize[1]/8)),r.end()},sdfBuffer:i,UBOBuffer:u}}function g(e,t,n){const r=e.presentationSize[0],a=e.presentationSize[1],i=4*Float32Array.BYTES_PER_ELEMENT*(r*a),o=e.device.createBuffer({label:"color buffer",size:i,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC}),u=(0,c.typedStructInfo)({name:"Light",fields:{color:{type:"vec4<f32>"},position:{type:"vec2<f32>"}}}),f=128*u.structSize*Float32Array.BYTES_PER_ELEMENT,h=e.device.createBuffer({label:"lights buffer",size:f,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),d=e.device.createBuffer({label:"num lights buffer",size:Uint32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),v=e.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:4,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]}),m=e.device.createBindGroup({layout:v,entries:[{binding:0,resource:{buffer:t}},{binding:1,resource:{buffer:o}},{binding:2,resource:{buffer:n}},{binding:3,resource:{buffer:h}},{binding:4,resource:{buffer:d}}]}),M=e.device.createComputePipeline({label:"lighting",compute:{module:e.device.createShaderModule({code:s.default}),entryPoint:"lighting"},layout:e.device.createPipelineLayout({bindGroupLayouts:[v]})});return{addLightingPass:(t,n)=>{const r=new Float32Array(f/Float32Array.BYTES_PER_ELEMENT);let a=0;n.forEachByType("light",((e,t)=>{const n=l.vec4.clone(e.color),i=Math.max(e.scale[0],e.scale[1]);l.vec4.mul(n,n,l.vec4.fromValues(i,i,i,1)),r.set([...n,...e.position],t*u.structSize/4),a+=1})),e.device.queue.writeBuffer(h,0,r),e.device.queue.writeBuffer(d,0,new Uint32Array([a]));const i=t.beginComputePass();i.setPipeline(M),i.setBindGroup(0,m),i.dispatchWorkgroups(Math.ceil(e.presentationSize[0]/16),Math.ceil(e.presentationSize[1]/16)),i.end()},colorBuffer:o}}t.run=async function(){if(!("gpu"in navigator))return!1;let e=null;try{e=await async function(e,t){const n=document.getElementById("canvas-wegbpu"),r=n.getContext("webgpu"),a=await navigator.gpu.requestAdapter(),i=await a.requestDevice(),s=m(n,false);n.width=s[0],n.height=s[1];const o=navigator.gpu.getPreferredCanvasFormat();return console.log(o),r?.configure({device:i,format:o,alphaMode:"opaque",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),{device:i,canvas:n,context:r,presentationSize:s,presentationFormat:o}}()}catch{return!1}const t=e,n=new o.Scene([]);o.SceneManager.getInstance().setScene(n),(0,u.setupUI)(t.canvas),n.addObject({type:"light",color:l.vec4.fromValues(2*Math.random()+1,2*Math.random()+1,2*Math.random()+1,1),position:l.vec2.fromValues(90,90),rotation:0,scale:l.vec2.fromValues(1,1)}),n.addObject({type:"light",color:l.vec4.fromValues(5*Math.random()+1,5*Math.random()+1,5*Math.random()+1,1),position:l.vec2.fromValues(t.presentationSize[0]-90,90),rotation:0,scale:l.vec2.fromValues(1,1)}),n.addObject({type:"light",color:l.vec4.fromValues(5*Math.random()+1,5*Math.random()+1,5*Math.random()+1,1),position:l.vec2.fromValues(t.presentationSize[0]-90,t.presentationSize[1]-90),rotation:0,scale:l.vec2.fromValues(1,1)}),n.addObject({type:"light",color:l.vec4.fromValues(5*Math.random()+1,5*Math.random()+1,5*Math.random()+1,1),position:l.vec2.fromValues(90,t.presentationSize[1]-90),rotation:0,scale:l.vec2.fromValues(1,1)});let{addDrawSDFPass:r,sdfBuffer:a,UBOBuffer:i}=p(t),{addLightingPass:s,colorBuffer:c}=g(t,a,i),{addPresentPass:d}=M(t,c,i);return requestAnimationFrame((function e(){h.CommandManager.getInstance().tick(0);const o=t.device.createCommandEncoder(),u=m(t.canvas,false);let l=!1;t.presentationSize[0]==u[0]&&t.presentationSize[1]==u[1]||(console.log(`${t.presentationSize} ${u}`),t.presentationSize=u,t.canvas.width=t.presentationSize[0],t.canvas.height=t.presentationSize[1],({addDrawSDFPass:r,sdfBuffer:a,UBOBuffer:i}=p(t)),({addLightingPass:s,colorBuffer:c}=g(t,a,i)),({addPresentPass:d}=M(t,c,i)),l=!0),(n.isDirty()||l)&&(r(o,n),s(o,n),n.setDirty(!1)),d(t,o);const v=f.ImmediateDraw.getInstance().draw(t.device,t.context.getCurrentTexture().createView(),t.presentationFormat,t.presentationSize[0],t.presentationSize[1]);t.device.queue.submit([o.finish(),v.finish()]),requestAnimationFrame(e)})),!0}},583:(e,t)=>{function n(e){const t={entries:new Map,structSize:0,structAlignment:0};let n=0,r=0;for(let a of e){const e=a[0],i=a[1],s=a[2];n=Math.max(n,i),r%i!=0&&(r=Math.ceil(r/i)*i),null!=s&&t.entries.set(s,{offset:r,size:e}),r+=e}return t.structSize=Math.ceil(r/n)*n,t.structAlignment=n,t}function r(e){e=e.trim();const t=/([^<]+)<(.+)>$/.exec(e);if(null==t)throw new Error(`Invalid type ${e}`);const n=t[2].split(",").map((e=>e.trim()));return{type:t[1],templateParams:n}}function a(e){const{type:t,templateParams:n}=r(e);let a=0,i=0;return"vec2"===t?a=i=8:"vec3"===t?(a=12,i=16):"vec4"===t&&(a=16,i=16),"f16"===n[0]&&(a/=2,i/=2),{size:a,align:i}}function i(e,t,n){const{type:a,templateParams:i}=r(e);if(i.length<2)throw new Error(`invalid type '${e}' for v${t}'`);const s=i[0],c=parseInt(i[1]),u=o(s,t,n);return{size:c*Math.ceil(u.size/u.align)*u.align,align:u.align}}Object.defineProperty(t,"__esModule",{value:!0}),t.typedStructInfo=t.typeInfo=t.structInfo=void 0,t.structInfo=n;const s=[{regex:/^(i32|u32|f32|f16)$/,typeInfoSolver:function(e){return"f16"===e?{size:2,align:2}:{size:4,align:4}}},{regex:/^atomic<.+>$/,typeInfoSolver:function(){return{size:4,align:4}}},{regex:/^vec\d<.+>$/,typeInfoSolver:a},{regex:/^mat\dx\d<.+>$/,typeInfoSolver:function(e,t){const{type:n,templateParams:s}=r(e),o=/mat(\d)x(\d).*/.exec(n);if(null==o||o.length<3)throw new Error(`invalid type '${e}' for '${t}'`);const c=o[1],u=`vec${o[2]}<${s[0]}>`,l=a(u).align;return{size:i(`array<${u}, ${c}>`,`__${t}_inner_array__`,[]).size,align:l}}},{regex:/^array<.+>$/,typeInfoSolver:i}];function o(e,t,n){e=e.trim();for(let{regex:r,typeInfoSolver:a}of s)if(r.test(e))return a(e,t,n);for(let t of n)if(t.name.trim()===e){const e=c(t,n);return{size:e.structSize,align:e.structAlignment}}throw new Error(`invalid type '${e}' for '${t}'`)}function c(e,t=[]){return n(Object.keys(e.fields).map((n=>{const r=e.name+"::"+n,a=e.fields[n],i=o(a.type,r,t);return[a.size??i.size,a.align??i.align,r]})))}t.typeInfo=o,t.typedStructInfo=c},934:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SceneManager=t.Scene=t.getInvTransform=t.getTransform=void 0;const r=n(887);function a(e,t=!0,n=!0){const a=r.mat3.create();return n&&r.mat3.translate(a,a,e.position),r.mat3.rotate(a,a,r.glMatrix.toRadian(e.rotation)),t&&r.mat3.scale(a,a,e.scale),a}t.getTransform=a,t.getInvTransform=function(e,t=!0){const n=a(e,t);return r.mat3.invert(n,n),n},t.Scene=class{constructor(e){this.dirty=!1,this.nextId=0,this.objects=e,this.dirty=!0}forEachByType(e,t){let n=0;for(let r of this.objects)r.type===e&&(t(r,n),n+=1)}setDirty(e){this.dirty=e}isDirty(){return this.dirty}addObject(e){null==e.id&&(e.id=this.nextId,this.nextId++),this.objects.push(e),this.setDirty(!0)}hasObject(e){return null!=e.id&&null!=this.objects.find((t=>t.id===e.id))}getObjectById(e){return this.objects.find((t=>t.id===e))}removeObject(e){this.objects.splice(this.objects.indexOf(e),1),this.setDirty(!0)}serialize(){return JSON.stringify({nextId:this.nextId,objects:this.objects})}deserialize(e){const t=JSON.parse(e,((e,t)=>"position"===e||"scale"===e||"size"===e?r.vec2.fromValues(parseFloat(t[0]),parseFloat(t[1])):"color"===e?r.vec4.fromValues(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])):t));this.nextId=t.nextId,this.objects=t.objects,this.setDirty(!0)}};class i{static getInstance(){return null==i.instance&&(i.instance=new i),i.instance}setScene(e){this.scene=e}getScene(){return this.scene}}t.SceneManager=i},529:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});const r="struct Rect {\r\n    invTransform: mat3x3f,\r\n    size: vec2f,\r\n}\r\n\r\nstruct Circle {\r\n    invTransform: mat3x3f,\r\n    radius: f32,\r\n}\r\n\r\n@group(0)\r\n@binding(0)\r\nvar<storage, read_write> sdfBuffer: array<f32>;\r\n\r\n@group(0)\r\n@binding(1)\r\nvar<uniform> uniforms: UniformData;\r\n\r\n@group(0)\r\n@binding(2)\r\nvar<uniform> rects: array<Rect, 128>;\r\n\r\n@group(0)\r\n@binding(3)\r\nvar<uniform> numRects: u32;\r\n\r\n@group(0)\r\n@binding(4)\r\nvar<uniform> circles: array<Circle, 128>;\r\n\r\n@group(0)\r\n@binding(5)\r\nvar<uniform> numCircles: u32;\r\n\r\nfn getMinScale(inv: mat3x3f) -> f32 {\r\n    let sx = length(inv[0].xy);\r\n    let sy = length(inv[1].xy);\r\n    return 1.0 / min(sx, sy);\r\n}\r\n\r\nfn removeScale(inv: mat3x3f, outInvScale: ptr<function, vec2f>) -> mat3x3f {\r\n    let invScale = vec2f(length(vec2f(inv[0][0], inv[1][0])), length(vec2f(inv[0][1], inv[1][1])));\r\n    *outInvScale = invScale;\r\n    var res = inv;\r\n    res[0][0] = inv[0][0] / invScale.x;\r\n    res[1][0] = inv[1][0] / invScale.x;\r\n    res[2][0] = inv[2][0] / invScale.x;\r\n\r\n    res[0][1] = inv[0][1] / invScale.y;\r\n    res[1][1] = inv[1][1] / invScale.y;\r\n    res[2][1] = inv[2][1] / invScale.y;    \r\n\r\n    return res;\r\n}\r\n\r\n@compute\r\n@workgroup_size(8, 8, 1)\r\nfn clear(@builtin(global_invocation_id) id: vec3<u32>) {\r\n    if (id.x >= uniforms.width || id.y >= uniforms.height) {\r\n        return;\r\n    }\r\n\r\n    let pixelCoord = vec2f(f32(id.x), f32(id.y));\r\n\r\n    var sdf = 10000.0;\r\n    for (var i = 0u; i < numRects; i = i + 1u) {\r\n#if SCALE_SHAPES \r\n        var invScale = vec2f();\r\n        let inv = removeScale(rects[i].invTransform, &invScale);\r\n        let local = inv * vec3f(pixelCoord, 1.0);\r\n        let rectSDF = rect(local.xy, rects[i].size / invScale);\r\n#else\r\n        let local = rects[i].invTransform * vec3f(pixelCoord, 1.0);\r\n        let rectSDF = rect(local.xy, rects[i].size) * getMinScale(rects[i].invTransform);\r\n#endif\r\n        sdf = min(sdf, rectSDF);\r\n    }\r\n\r\n    for (var i = 0u; i < numCircles; i = i + 1u) {\r\n#if SCALE_SHAPES\r\n        var invScale = vec2f();\r\n        let inv = removeScale(circles[i].invTransform, &invScale);\r\n        var ellipseSDF = 0.0;\r\n        if (abs(invScale.x - invScale.y) > 0.05) {\r\n            // ellipses are slower and less accurate, use only when scale is not uniform\r\n            let local = inv * vec3f(pixelCoord, 1.0);\r\n            ellipseSDF = ellipse(local.xy, vec2f(circles[i].radius) / invScale);\r\n        }\r\n        else {\r\n            let local = circles[i].invTransform * vec3f(pixelCoord, 1.0);\r\n            ellipseSDF = circle(local.xy, circles[i].radius) * getMinScale(circles[i].invTransform);\r\n        }\r\n#else\r\n        let local = circles[i].invTransform * vec3f(pixelCoord, 1.0);\r\n        let ellipseSDF = circle(local.xy, circles[i].radius) * getMinScale(circles[i].invTransform);\r\n#endif\r\n        sdf = min(sdf, ellipseSDF);\r\n    }\r\n\r\n    var index = id.x + id.y * u32(uniforms.width);\r\n\r\n    sdfBuffer[index] = sdf;\r\n}\r\n\r\n//////////////////////////////\r\n////////// COMMON ////////////\r\n//////////////////////////////\r\n\r\nfn saturate(v: f32) -> f32 {\r\n    return clamp(v, 0.0, 1.0);\r\n}\r\n\r\nfn cross2d(v1: vec2f, v2: vec2f) -> f32 {\r\n    return v1.x * v2.y - v2.x * v1.y;\r\n}\r\n\r\nfn dist2(p: vec2f, p1: vec2f) -> f32 {\r\n    let a = (p1 - p);\r\n    return dot(a, a);\r\n}\r\n\r\nfn hash(p: vec2f) -> f32 {\r\n    var p3 = fract(vec3f(p.xyx) * 0.13);\r\n    p3 += dot(p3, p3.yzx + vec3f(3.333));\r\n    return fract((p3.x + p3.y) * p3.z); \r\n}\r\n\r\n\r\n//////////////////////////////\r\n//////////// SDF /////////////\r\n//////////////////////////////\r\n\r\nfn signedDistnce_p2l(p: vec2f, s: vec2f, e: vec2f) -> f32 {\r\n    return cross2d(p - s, e - s) / distance(s, e); // area / base = height\r\n}\r\n\r\nfn projNormalized(p: vec2f, s: vec2f, e: vec2f) -> f32 {\r\n    let dir = e - s;\r\n    let dist2 = dot(dir, dir); // distance ^ 2\r\n    return dot(p - s, e - s) / dist2;\r\n}\r\n\r\nfn distance_p2e(p: vec2f, s: vec2f, e: vec2f) -> f32 {\r\n    let a = projNormalized(p, s, e);\r\n    if (a > 1.0) {\r\n        return distance(p, e);\r\n    }\r\n    else if (a < 0.0) {\r\n        return distance(p, s);\r\n    }\r\n\r\n    return abs( signedDistnce_p2l(p, s, e) );\r\n}\r\n\r\nfn rect(p: vec2f, s: vec2f) -> f32 {\r\n    let minP = -abs(s) / 2.0;\r\n    let maxP = abs(s) / 2.0;\r\n    let inside = p.x > minP.x && p.x < maxP.x && p.y > minP.y && p.y < maxP.y;\r\n    let d1 = distance_p2e(p, vec2f(minP.x, minP.y), vec2f(minP.x, maxP.y)); // left\r\n    let d2 = distance_p2e(p, vec2f(maxP.x, minP.y), vec2f(maxP.x, maxP.y)); // right\r\n    let d3 = distance_p2e(p, vec2f(minP.x, minP.y), vec2f(maxP.x, minP.y)); // top\r\n    let d4 = distance_p2e(p, vec2f(minP.x, maxP.y), vec2f(maxP.x, maxP.y)); // bottom\r\n    let minV = min(d1, min(d2, min(d3, d4)));\r\n    if (inside) {\r\n        return -minV;\r\n    }\r\n\r\n    return minV;\r\n}\r\n\r\nfn circle(p: vec2f, r: f32) -> f32 {\r\n    return sqrt(dot(p, p)) - r;\r\n}\r\n\r\n// from https://www.shadertoy.com/view/tt3yz7\r\nfn ellipse( inp: vec2f, ine: vec2f ) -> f32\r\n{\r\n    var e = ine;\r\n    var pAbs = abs(inp);\r\n    var ei = 1.0 / e;\r\n    var e2 = e*e;\r\n    var ve = ei * vec2(e2.x - e2.y, e2.y - e2.x);\r\n    \r\n    var t = vec2f(0.70710678118654752, 0.70710678118654752);\r\n    for (var i = 0; i < 3; i++) {\r\n        var v = ve*t*t*t;\r\n        var u = normalize(pAbs - v) * length(t * e - v);\r\n        var w = ei * (v + u);\r\n        t = normalize(clamp(w, vec2f(0.0), vec2f(1.0)));\r\n    }\r\n    \r\n    var nearestAbs = t * e;\r\n    let dist = length(pAbs - nearestAbs);\r\n    return select(dist, -dist, dot(pAbs, pAbs) < dot(nearestAbs, nearestAbs));\r\n}\r\nstruct UniformData {\r\n    width: u32,\r\n    height: u32,\r\n};\r\n"},203:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});const r="@group(0)\r\n@binding(0)\r\nvar<storage> sdfBuffer: array<f32>;\r\n\r\n@group(0)\r\n@binding(1)\r\nvar<storage, read_write> colorBuffer: array<vec4f>;\r\n\r\n@group(0)\r\n@binding(2)\r\nvar<uniform> uniforms: UniformData;\r\n\r\nstruct Light {\r\n    color: vec4f,\r\n    position: vec2f,\r\n};\r\n\r\n@group(0)\r\n@binding(3)\r\nvar<uniform> lights: array<Light, 128>;\r\n\r\n@group(0)\r\n@binding(4)\r\nvar<uniform> numLights: u32;\r\n\r\nconst MAX_DISTANCE = 10000.0;\r\n\r\nfn sampleSceneSDF(p: vec2f) -> f32 {\r\n    let pixel = vec2<u32>(u32(p.x), u32(p.y));\r\n    if (pixel.x < 0u || pixel.y < 0u || pixel.x >= uniforms.width || pixel.y >= uniforms.height) {\r\n        return MAX_DISTANCE;\r\n    }\r\n\r\n    let index = pixel.x + pixel.y * uniforms.width;\r\n    return sdfBuffer[index];\r\n}\r\n\r\n// ported from https://iquilezles.org/articles/rmshadows/\r\nfn softshadow(ro: vec2f, rd: vec2f, mint: f32, maxt: f32, k:f32) -> f32 {\r\n    var res = 1.0;\r\n    var t = mint;\r\n    for (var i = 0; i < 128 && t < maxt; i = i + 1) {\r\n        let h = sampleSceneSDF(ro + rd*t);\r\n        if (h < 0.001) {\r\n            return 0.0;\r\n        }\r\n        res = min( res, k*h/t );\r\n        t += h * mix(0.65, 0.95, hash(ro + rd * t));\r\n    }\r\n    return res;\r\n}\r\n\r\nconst Kc = 1.0;\r\nconst Kl = \t0.009;\r\nconst Kq = \t0.0004;\r\nconst ambientLight = 0.005;\r\n\r\nfn getShadowAttenuation(pixel: vec2f, light: vec2f, color: vec4f) -> f32 {\r\n    // return 0 if the pixel is inside a shape or very close to a shape\r\n    let distToLight = distance(pixel, light);\r\n    let attenuation = 1.0 / (Kc + Kl * distToLight + Kq * distToLight * distToLight);\r\n    // let maxChannel = max(color.r, max(color.g, color.b));\r\n    // if (maxChannel * attenuation < 0.005) {\r\n    //     return ambientLight;\r\n    // }\r\n\r\n    let shadow = softshadow(pixel, normalize(light - pixel), 1, distance(pixel, light), 12.0);\r\n    let shadowAndAttenuation = mix(ambientLight, 1.0, shadow * attenuation);\r\n\r\n    return saturate(shadowAndAttenuation + hash(pixel) * 0.0005);\r\n}\r\n\r\nconst exposure = 1.0;\r\n\r\n@compute\r\n@workgroup_size(16, 16, 1)\r\nfn lighting(@builtin(global_invocation_id) id: vec3<u32>) {\r\n    if (id.x >= uniforms.width || id.y >= uniforms.height) {\r\n        return;\r\n    }\r\n\r\n    let index = id.x + id.y * u32(uniforms.width);\r\n    var pixelCoord = vec2f(f32(id.x), f32(id.y));\r\n    var finalColor = vec3f(0.0);\r\n    var shadow = 0.0;\r\n    for (var i = 0u; i < numLights; i = i + 1u) {\r\n        // for (var x = -1; x <= 1; x = x + 1) {\r\n        //     for (var y = -1; y <= 1; y = y + 1) {\r\n        //         shadow += getShadowAttenuation(pixelCoord + vec2f(f32(x), f32(y)) * 0.5, lights[i].position);\r\n        //     }\r\n        // }\r\n        shadow = getShadowAttenuation(pixelCoord, lights[i].position, lights[i].color);\r\n\r\n        finalColor = finalColor + lights[i].color.rgb * (shadow);\r\n    }\r\n    \r\n    let pixelSDF = sampleSceneSDF(pixelCoord);\r\n    var toneMappedAA = vec3f(1.0) - exp(-finalColor * exposure);\r\n    toneMappedAA = mix(vec3f(0.0), toneMappedAA, saturate(pixelSDF / 1.1));\r\n\r\n    //debug\r\n    // let d = fract(pixelSDF / 10.0);\r\n    // var debugColor = select(vec4f(0.5, 0.1, 0.1, 1.0), vec4f(0.1, 0.1, 0.5, 1.0), pixelSDF < 0.0);\r\n    // if (d >= 0.8) {\r\n    //     debugColor = select(vec4f(1, 0.1, 0.1, 1.0), vec4f(0.1, 0.1, 1.0, 1.0), pixelSDF < 0.0);\r\n    // }\r\n    //~~~\r\n\r\n    colorBuffer[index] = vec4f(toneMappedAA, 1.0);\r\n}\r\n\r\n\r\nstruct UniformData {\r\n    width: u32,\r\n    height: u32,\r\n};\r\n\r\n//////////////////////////////\r\n////////// COMMON ////////////\r\n//////////////////////////////\r\n\r\nfn saturate(v: f32) -> f32 {\r\n    return clamp(v, 0.0, 1.0);\r\n}\r\n\r\nfn cross2d(v1: vec2f, v2: vec2f) -> f32 {\r\n    return v1.x * v2.y - v2.x * v1.y;\r\n}\r\n\r\nfn dist2(p: vec2f, p1: vec2f) -> f32 {\r\n    let a = (p1 - p);\r\n    return dot(a, a);\r\n}\r\n\r\nfn hash(p: vec2f) -> f32 {\r\n    var p3 = fract(vec3f(p.xyx) * 0.13);\r\n    p3 += dot(p3, p3.yzx + vec3f(3.333));\r\n    return fract((p3.x + p3.y) * p3.z); \r\n}\r\n\r\n\r\n//////////////////////////////\r\n//////////// SDF /////////////\r\n//////////////////////////////\r\n\r\nfn signedDistnce_p2l(p: vec2f, s: vec2f, e: vec2f) -> f32 {\r\n    return cross2d(p - s, e - s) / distance(s, e); // area / base = height\r\n}\r\n\r\nfn projNormalized(p: vec2f, s: vec2f, e: vec2f) -> f32 {\r\n    let dir = e - s;\r\n    let dist2 = dot(dir, dir); // distance ^ 2\r\n    return dot(p - s, e - s) / dist2;\r\n}\r\n\r\nfn distance_p2e(p: vec2f, s: vec2f, e: vec2f) -> f32 {\r\n    let a = projNormalized(p, s, e);\r\n    if (a > 1.0) {\r\n        return distance(p, e);\r\n    }\r\n    else if (a < 0.0) {\r\n        return distance(p, s);\r\n    }\r\n\r\n    return abs( signedDistnce_p2l(p, s, e) );\r\n}\r\n\r\nfn rect(p: vec2f, s: vec2f) -> f32 {\r\n    let minP = -abs(s) / 2.0;\r\n    let maxP = abs(s) / 2.0;\r\n    let inside = p.x > minP.x && p.x < maxP.x && p.y > minP.y && p.y < maxP.y;\r\n    let d1 = distance_p2e(p, vec2f(minP.x, minP.y), vec2f(minP.x, maxP.y)); // left\r\n    let d2 = distance_p2e(p, vec2f(maxP.x, minP.y), vec2f(maxP.x, maxP.y)); // right\r\n    let d3 = distance_p2e(p, vec2f(minP.x, minP.y), vec2f(maxP.x, minP.y)); // top\r\n    let d4 = distance_p2e(p, vec2f(minP.x, maxP.y), vec2f(maxP.x, maxP.y)); // bottom\r\n    let minV = min(d1, min(d2, min(d3, d4)));\r\n    if (inside) {\r\n        return -minV;\r\n    }\r\n\r\n    return minV;\r\n}\r\n\r\nfn circle(p: vec2f, r: f32) -> f32 {\r\n    return sqrt(dot(p, p)) - r;\r\n}\r\n\r\n// from https://www.shadertoy.com/view/tt3yz7\r\nfn ellipse( inp: vec2f, ine: vec2f ) -> f32\r\n{\r\n    var e = ine;\r\n    var pAbs = abs(inp);\r\n    var ei = 1.0 / e;\r\n    var e2 = e*e;\r\n    var ve = ei * vec2(e2.x - e2.y, e2.y - e2.x);\r\n    \r\n    var t = vec2f(0.70710678118654752, 0.70710678118654752);\r\n    for (var i = 0; i < 3; i++) {\r\n        var v = ve*t*t*t;\r\n        var u = normalize(pAbs - v) * length(t * e - v);\r\n        var w = ei * (v + u);\r\n        t = normalize(clamp(w, vec2f(0.0), vec2f(1.0)));\r\n    }\r\n    \r\n    var nearestAbs = t * e;\r\n    let dist = length(pAbs - nearestAbs);\r\n    return select(dist, -dist, dot(pAbs, pAbs) < dot(nearestAbs, nearestAbs));\r\n}"},323:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});const r="struct CanvasSize {\r\n    width: f32,\r\n    height: f32,\r\n};\r\n\r\nstruct VertexOut {\r\n    @builtin(position) pos: vec4f,\r\n    @location(0) color: vec4f,\r\n    @location(1) val: f32,\r\n};\r\n\r\n@group(0)\r\n@binding(0)\r\nvar<uniform> canvasSize: CanvasSize;\r\n\r\n@vertex\r\nfn lineVert(@builtin(vertex_index) index: u32, @location(0) startEnd: vec4f, @location(1) color: vec4f) -> VertexOut {\r\n    var pos = array<vec2<f32>, 6>(\r\n      vec2<f32>( 1.0,  1.0),\r\n      vec2<f32>( 1.0, -1.0),\r\n      vec2<f32>(-1.0, -1.0),\r\n      vec2<f32>( 1.0,  1.0),\r\n      vec2<f32>(-1.0, -1.0),\r\n      vec2<f32>(-1.0,  1.0));\r\n    \r\n    let vPosition = pos[index];\r\n\r\n    // read the start position of the edge\r\n    let start = startEnd.xy;\r\n\r\n    // read the start position of the edge\r\n    let end = startEnd.zw;\r\n\r\n    // compute the angle between start and end\r\n    let delta = end - start;\r\n    let angle = atan2(delta.y, delta.x);\r\n\r\n    // create the rotation matrix\r\n    let rotation = mat2x2f(cos(angle), sin(angle),\r\n                        -sin(angle), cos(angle));\r\n\r\n    // create the scale matrix so that the length of the line\r\n    // matches the distance between start and end point and its width\r\n    // is equal to lineWidth\r\n    let scale = mat2x2f(length(delta) / 2.0, 0.0,\r\n                     0.0, 1.5);\r\n\r\n    // transform the rect (perform as many operations as possible with 2d matrix)\r\n    let transformedPosition2D = (start + end) / 2.0 + rotation * scale * vPosition;\r\n\r\n    var t = transformedPosition2D / vec2f(canvasSize.width, canvasSize.height);\r\n    t = vec2f(t.x, 1.0 - t.y);\r\n    t = t * 2.0 - vec2f(1.0);\r\n\r\n    var out: VertexOut;\r\n    out.pos = vec4f(t, 0.0, 1.0);\r\n    out.color = color;\r\n    out.val = vPosition.y;\r\n    return out;\r\n}\r\n\r\n@fragment\r\nfn lineFrag(data: VertexOut) -> @location(0) vec4<f32> {\r\n    let color = data.color.rgb;\r\n    let alpha = min(smoothstep(-1.0, -0.1, data.val),\r\n         1.0 - smoothstep(0.1, 1.0, data.val));\r\n    return vec4f(color, alpha);\r\n}"},22:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});const r="@group(0)\r\n@binding(0)\r\nvar<uniform> uniformsFS: UniformData;\r\n\r\n@group(0)\r\n@binding(1)\r\nvar<storage> finalColorBufferFS: array<vec4f>;\r\n\r\n@vertex\r\nfn fullScreenVert(@builtin(vertex_index) index: u32) -> @builtin(position) vec4<f32> {\r\n    var pos = array<vec2<f32>, 6>(\r\n      vec2<f32>( 1.0,  1.0),\r\n      vec2<f32>( 1.0, -1.0),\r\n      vec2<f32>(-1.0, -1.0),\r\n      vec2<f32>( 1.0,  1.0),\r\n      vec2<f32>(-1.0, -1.0),\r\n      vec2<f32>(-1.0,  1.0));\r\n    \r\n    return vec4<f32>(pos[index], 0.0, 1.0);\r\n}\r\n\r\n@fragment\r\nfn fullScreenFrag(@builtin(position) coord: vec4<f32>) -> @location(0) vec4<f32> {\r\n    let X = u32(coord.x);\r\n    let Y = u32(coord.y);\r\n    let index = u32(X + Y * uniformsFS.width);\r\n\r\n    let color = finalColorBufferFS[index].rgb;\r\n\r\n    return vec4f(color, 1.0);\r\n}\r\n\r\nstruct UniformData {\r\n    width: u32,\r\n    height: u32,\r\n};\r\n"}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(0,n(947).run)().then((e=>{e||(document.getElementById("webgpu-available").innerText="Looks like webgpu is not available :(")}))})();
//# sourceMappingURL=main.bundle.js.map